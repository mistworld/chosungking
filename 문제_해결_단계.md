# ğŸš¨ í˜„ì¬ ë¬¸ì œ ë° í•´ê²° ë°©ë²•

## ğŸ“Š ë¬¸ì œ ì§„ë‹¨

### 1. CORS ì—ëŸ¬ (ë¸Œë¼ìš°ì €)
```
Access to fetch at 'https://steep-moon-7816.sucksuck1114.workers.dev/api/create-room' 
from origin 'https://chosungking.vercel.app' has been blocked by CORS policy: 
No 'Access-Control-Allow-Origin' header is present on the requested resource.
```

### 2. Error Code 1101 (ì§ì ‘ API í˜¸ì¶œ)
```
Invoke-RestMethod : error code: 1101
```

**ì—ëŸ¬ 1101 ì˜ë¯¸:** Cloudflare Workersê°€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘ì— ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

---

## ğŸ” ì›ì¸ ë¶„ì„

### ê°€ëŠ¥í•œ ì›ì¸:

1. **Worker ì½”ë“œì— ëŸ°íƒ€ì„ ì—ëŸ¬**
   - `handleCreateRoom` í•¨ìˆ˜ì—ì„œ ì—ëŸ¬ ë°œìƒ
   - KV Namespace ì ‘ê·¼ ì‹¤íŒ¨
   - JSON íŒŒì‹± ì‹¤íŒ¨

2. **ë°”ì¸ë”© ë¬¸ì œ**
   - `ROOM_LIST` KVê°€ ì œëŒ€ë¡œ ë°”ì¸ë”©ë˜ì§€ ì•ŠìŒ
   - ê¶Œí•œ ë¬¸ì œ

3. **íƒ€ì„ì•„ì›ƒ**
   - Worker ì‹¤í–‰ ì‹œê°„ ì´ˆê³¼ (CPU ì‹œê°„ ì œí•œ)

---

## âœ… í•´ê²° ë°©ë²•

### 1ë‹¨ê³„: Cloudflare Dashboardì—ì„œ ë¡œê·¸ í™•ì¸

**ì¤‘ìš”!** Cloudflare Dashboardì—ì„œ ì‹¤ì‹œê°„ ë¡œê·¸ë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

1. https://dash.cloudflare.com ë¡œê·¸ì¸
2. **Workers & Pages** í´ë¦­
3. **steep-moon-7816** í´ë¦­
4. **Logs** íƒ­ í´ë¦­ (ë˜ëŠ” **Real-time Logs** ë²„íŠ¼)
5. ë°© ìƒì„± APIë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•˜ë©´ì„œ ë¡œê·¸ í™•ì¸

**ë¡œê·¸ì—ì„œ í™•ì¸í•  ë‚´ìš©:**
- ì—ëŸ¬ ë©”ì‹œì§€
- ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤
- ì–´ëŠ ì¤„ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ì§€

---

### 2ë‹¨ê³„: ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ Worker ë°°í¬

ë¬¸ì œë¥¼ ê²©ë¦¬í•˜ê¸° ìœ„í•´ ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.

**í…ŒìŠ¤íŠ¸ 1: ê¸°ë³¸ CORS í…ŒìŠ¤íŠ¸**

`src/worker.js` íŒŒì¼ì˜ `handleCreateRoom` í•¨ìˆ˜ë¥¼ ì„ì‹œë¡œ ê°„ë‹¨í•˜ê²Œ ìˆ˜ì •:

```javascript
async function handleCreateRoom(request, env) {
    try {
        console.log('[create-room] ì‹œì‘');
        
        // ê°„ë‹¨í•œ ì‘ë‹µ í…ŒìŠ¤íŠ¸
        return jsonResponse({ 
            success: true, 
            roomId: 'TEST123',
            message: 'Test response'
        });
    } catch (error) {
        console.error('[create-room] ì—ëŸ¬:', error);
        return jsonResponse({ 
            error: error.message,
            stack: error.stack
        }, 500);
    }
}
```

ì´ë ‡ê²Œ ìˆ˜ì •í•œ í›„ ì¬ë°°í¬í•˜ë©´:
- CORS í—¤ë”ê°€ ì œëŒ€ë¡œ ì„¤ì •ë˜ëŠ”ì§€ í™•ì¸ ê°€ëŠ¥
- ê¸°ë³¸ì ì¸ ì‘ë‹µì´ ì˜¤ëŠ”ì§€ í™•ì¸ ê°€ëŠ¥

---

### 3ë‹¨ê³„: KV ì ‘ê·¼ í…ŒìŠ¤íŠ¸

KVê°€ ë¬¸ì œì¸ì§€ í™•ì¸:

```javascript
async function handleCreateRoom(request, env) {
    try {
        console.log('[create-room] ì‹œì‘');
        
        // KV ì ‘ê·¼ í…ŒìŠ¤íŠ¸
        if (!env.ROOM_LIST) {
            throw new Error('ROOM_LIST KVê°€ ë°”ì¸ë”©ë˜ì§€ ì•ŠìŒ');
        }
        
        // ê°„ë‹¨í•œ KV ì“°ê¸° í…ŒìŠ¤íŠ¸
        await env.ROOM_LIST.put('test_key', 'test_value');
        console.log('[create-room] KV ì“°ê¸° ì„±ê³µ');
        
        return jsonResponse({ 
            success: true, 
            roomId: 'TEST123',
            message: 'KV test passed'
        });
    } catch (error) {
        console.error('[create-room] ì—ëŸ¬:', error);
        return jsonResponse({ 
            error: error.message,
            stack: error.stack
        }, 500);
    }
}
```

---

### 4ë‹¨ê³„: ì „ì²´ í•¨ìˆ˜ ë””ë²„ê¹…

ì›ë˜ `handleCreateRoom` í•¨ìˆ˜ì— try-catchì™€ ë¡œê·¸ ì¶”ê°€:

```javascript
async function handleCreateRoom(request, env) {
    try {
        console.log('[create-room] ìš”ì²­ ë°›ìŒ');
        
        const body = await request.json().catch(() => ({}));
        console.log('[create-room] body:', JSON.stringify(body));
        
        const { title, gameMode, playerId, playerName } = body;
        const now = Date.now();
        
        console.log('[create-room] roomNumber ê³„ì‚° ì‹œì‘');
        let roomNumber = 1;
        try {
            const existing = await env.ROOM_LIST.list({ limit: 1000 });
            console.log('[create-room] ê¸°ì¡´ ë°© ê°œìˆ˜:', existing.keys.length);
            
            let maxNum = 0;
            for (const key of existing.keys) {
                const meta = key.metadata;
                if (meta && typeof meta.roomNumber === 'number' && meta.roomNumber > maxNum) {
                    maxNum = meta.roomNumber;
                }
            }
            roomNumber = maxNum + 1;
            console.log('[create-room] ìƒˆ roomNumber:', roomNumber);
        } catch (e) {
            console.error('[create-room] roomNumber ê³„ì‚° ì‹¤íŒ¨:', e);
            roomNumber = 1;
        }
        
        const roomId = generateRoomCode();
        console.log('[create-room] roomId ìƒì„±:', roomId);
        
        // ... ë‚˜ë¨¸ì§€ ì½”ë“œ ...
        
        console.log('[create-room] ì„±ê³µ');
        return jsonResponse({ roomId });
        
    } catch (error) {
        console.error('[create-room] ì „ì²´ ì—ëŸ¬:', error);
        return jsonResponse({ 
            error: error.message,
            stack: error.stack
        }, 500);
    }
}
```

---

## ğŸ¯ ì¦‰ì‹œ í•´ì•¼ í•  ì¼

### ì˜µì…˜ A: Dashboard ë¡œê·¸ í™•ì¸ (ì¶”ì²œ)

1. Cloudflare Dashboard â†’ Workers & Pages â†’ steep-moon-7816 â†’ Logs
2. ì‹¤ì‹œê°„ ë¡œê·¸ ì¼œê¸°
3. ë¸Œë¼ìš°ì €ì—ì„œ ë°© ìƒì„± ì‹œë„
4. ë¡œê·¸ì—ì„œ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸

**ì´ê²ƒì´ ê°€ì¥ ë¹ ë¥¸ ë°©ë²•ì…ë‹ˆë‹¤!**

---

### ì˜µì…˜ B: ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ì‹œì‘

1. `src/worker.js`ì˜ `handleCreateRoom` í•¨ìˆ˜ë¥¼ ìœ„ì˜ "í…ŒìŠ¤íŠ¸ 1" ì½”ë“œë¡œ êµì²´
2. ì¬ë°°í¬: `wrangler deploy`
3. ë¸Œë¼ìš°ì €ì—ì„œ ë°© ìƒì„± í…ŒìŠ¤íŠ¸
4. CORS ì—ëŸ¬ê°€ ì‚¬ë¼ì§€ëŠ”ì§€ í™•ì¸

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë¬¸ì œ ì§„ë‹¨:
- [ ] Cloudflare Dashboard ë¡œê·¸ í™•ì¸
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ ë° ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ í™•ì¸
- [ ] KV ë°”ì¸ë”© ìƒíƒœ í™•ì¸ (Settings â†’ Variables)
- [ ] Worker ë°°í¬ ìƒíƒœ í™•ì¸ (ìµœì‹  ë²„ì „ì¸ì§€)

í…ŒìŠ¤íŠ¸:
- [ ] ê°„ë‹¨í•œ ì‘ë‹µ í…ŒìŠ¤íŠ¸ (CORS í™•ì¸)
- [ ] KV ì ‘ê·¼ í…ŒìŠ¤íŠ¸
- [ ] ì „ì²´ í•¨ìˆ˜ ë””ë²„ê¹…

---

## ğŸ’¡ ì°¸ê³ 

**Cloudflare Workers ì—ëŸ¬ ì½”ë“œ:**
- **1101**: Worker ì‹¤í–‰ ì¤‘ ì˜ˆì™¸ ë°œìƒ
- **1102**: Worker CPU ì‹œê°„ ì´ˆê³¼
- **1015**: Rate limit ì´ˆê³¼

**ì¼ë°˜ì ì¸ ì›ì¸:**
1. `await`ë¥¼ ë¹¼ë¨¹ìŒ
2. JSON íŒŒì‹± ì‹¤íŒ¨
3. KV/DO ë°”ì¸ë”© ë¬¸ì œ
4. ë¬´í•œ ë£¨í”„ ë˜ëŠ” ê³¼ë„í•œ ì—°ì‚°

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. **Cloudflare Dashboardì—ì„œ ë¡œê·¸ í™•ì¸** â† ì§€ê¸ˆ ë°”ë¡œ!
2. ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
3. í•„ìš”ì‹œ ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ë¬¸ì œ ê²©ë¦¬
4. ìˆ˜ì • í›„ ì¬ë°°í¬

**ê±±ì •í•˜ì§€ ë§ˆì„¸ìš”!** ë¡œê·¸ë§Œ í™•ì¸í•˜ë©´ ì •í™•í•œ ì›ì¸ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ğŸ™‚


