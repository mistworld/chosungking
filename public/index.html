<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì´ˆì„±ì™•</title>
    <!-- Force deploy: 2024-12-01-16-00 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
            overscroll-behavior: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 50%, #fab1a0 100%);
            color: #2d3436;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }

        body.time-warning {
            animation: urgentBlink 1s ease-in-out infinite;
        }

        @keyframes urgentBlink {
            0%, 100% { background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 50%, #fab1a0 100%); }
            50% { background: linear-gradient(135deg, #ff7675 0%, #fd79a8 50%, #fab1a0 100%); }
        }

        /* ===== PC ë²„ì „ (ê¸°ë³¸ - ì›ë³¸ ë””ìì¸) ===== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 600px;
            padding: 15px 20px;
            background: white;
            border-radius: 25px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .logo {
            font-size: 1.8em;
            font-weight: bold;
            color: #fd79a8;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 6px;
        }

        .audio-btn {
            padding: 6px 10px;
            background: #f5f5f5;
            border: 2px solid #dfe6e9;
            border-radius: 15px;
            color: #636e72;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .audio-btn.active {
            background: #ffeaa7;
            border-color: #fdcb6e;
            color: #2d3436;
        }

        .multiplayer-header-btn {
            padding: 6px 12px;
            background: #ffeaa7;
            border: 2px solid #fdcb6e;
            border-radius: 15px;
            color: #2d3436;
            font-size: 0.7em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .multiplayer-header-btn:hover {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            transform: scale(1.05);
        }

        .header-mp-dropdown {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 15px;
            padding: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            min-width: 200px;
        }

        .header-mp-dropdown.hidden {
            display: none;
        }

        .header-mp-btn {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            background: #f8f9fa;
            border: 2px solid #dfe6e9;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .header-mp-btn:hover {
            background: #ffeaa7;
            border-color: #fdcb6e;
            transform: translateX(5px);
        }

        .container {
            max-width: 600px;
            width: 100%;
            background: white;
            border-radius: 25px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        /* ê²Œì„ ì‹œì‘ í™”ë©´ */
        .game-start-section {
            text-align: center;
            padding: 30px 20px;
        }

        .start-crown {
            font-size: 4em;
            margin-bottom: 10px;
            animation: crownBounce 2s ease-in-out infinite;
        }

        @keyframes crownBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .start-title {
            font-family: 'Do Hyeon', sans-serif;
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #fd79a8;
            text-shadow: 3px 3px 0px rgba(253, 203, 110, 0.5);
        }

        .start-instruction {
            font-family: 'Do Hyeon', sans-serif;
            font-size: 1.3em;
            color: #636e72;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .score-guide {
            background: #fffacd;
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 25px;
            border: 3px solid #ffeaa7;
        }

        .score-guide-compact {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .score-item {
            font-size: 1.1em;
            margin: 8px 0;
            color: #2d3436;
            font-weight: bold;
        }

        .special-score {
            font-size: 1em;
            color: #e91e63;
            font-weight: bold;
            margin-top: 12px;
            grid-column: 1 / -1;
            text-align: center;
        }

        .special-score-detail {
            font-size: 0.9em;
            color: #e91e63;
            font-weight: bold;
            grid-column: 1 / -1;
            text-align: center;
        }

        .best-score-display {
            font-size: 1.3em;
            font-weight: bold;
            color: #fd79a8;
            margin-bottom: 15px;
        }

        /* ===== ì‹œê°„ì œ ëª¨ë“œ: ì‹œì‘ í™”ë©´ ë‚´ë¶€ ì—¬ë°± ì‚´ì§ ì¤„ì—¬ì„œ ì™¼ìª½ ìŠ¬ë¡¯ê³¼ ìˆ˜í‰ ë§ì¶”ê¸° ===== */
        body:not(.turn-mode) .game-start-section {
            padding-top: 24px;
            padding-bottom: 20px;
        }

        body:not(.turn-mode) .start-title {
            margin-bottom: 16px;
        }

        body:not(.turn-mode) .start-instruction {
            margin-bottom: 16px;
        }

        body:not(.turn-mode) .score-guide {
            padding: 16px;
            margin-bottom: 20px;
        }

        body:not(.turn-mode) .best-score-display {
            margin-bottom: 10px;
        }
        
        /* ì´ë¦„ ë³€ê²½ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ (ì‹œì‘ ë²„íŠ¼ ìœ„ ê°€ìš´ë°) */
        .change-name-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: -10px;
            margin-bottom: 10px;
            gap: 5px;
        }
        
        .change-name-btn {
            width: 40px;
            height: 40px;
            font-size: 1.2em;
            font-weight: bold;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(116, 185, 255, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .change-name-btn:hover {
            transform: translateY(-2px) scale(1.1);
            box-shadow: 0 5px 15px rgba(116, 185, 255, 0.5);
        }
        
        .change-name-btn:active {
            transform: scale(0.95);
        }
        
        /* ì´ë¦„ ë³€ê²½ íŒíŠ¸ (ì—°í•„ ì•„ì´ì½˜ ë°‘ì— ì‘ê²Œ) */
        .change-name-hint {
            font-size: 0.75em;
            color: #636e72;
            text-align: center;
            padding: 4px 8px;
            background: #f8f9fa;
            border-radius: 8px;
            max-width: 200px;
            word-break: keep-all;
            line-height: 1.3;
        }
        
        /* ì´ë¦„ ì…ë ¥ ëª¨ë‹¬ ê°œì„  */
        .mp-name-modal {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 25px;
            padding: 35px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            border: 3px solid #fd79a8;
        }
        
        .mp-name-title {
            font-family: 'Do Hyeon', sans-serif;
            font-size: 1.8em;
            font-weight: bold;
            color: #fd79a8;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .mp-name-hint {
            font-size: 0.9em;
            color: #636e72;
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background: #fffacd;
            border-radius: 10px;
        }
        
        .mp-name-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 3px solid #dfe6e9;
            border-radius: 15px;
            margin-bottom: 15px;
            text-align: center;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .mp-name-input:focus {
            outline: none;
            border-color: #fd79a8;
            box-shadow: 0 0 0 3px rgba(253, 121, 168, 0.2);
        }
        
        /* ğŸš€ ì´ë¦„ ì…ë ¥ ëª¨ë‹¬ ë©”ì‹œì§€ ì˜ì—­ (ì…ë ¥ì°½ ì•„ë˜, ë²„íŠ¼ ìœ„) */
        .mp-name-message {
            font-size: 0.95em;
            color: #636e72;
            text-align: center;
            margin-bottom: 15px;
            padding: 12px 15px;
            background: #fffacd;
            border-radius: 10px;
            border: 2px solid #fdcb6e;
            min-height: 20px;
            line-height: 1.5;
            transition: all 0.3s ease;
            white-space: pre-line; /* ğŸš€ ì¤„ë°”ê¿ˆ í—ˆìš© */
            word-break: keep-all; /* ğŸš€ ë‹¨ì–´ ë‹¨ìœ„ë¡œ ì¤„ë°”ê¿ˆ */
        }
        
        .mp-name-message.error {
            background: #ffe5e5;
            border-color: #ff7675;
            color: #d63031;
        }
        
        .mp-name-message.info {
            background: #e8f5e9;
            border-color: #55efc4;
            color: #00b894;
        }
        
        .mp-name-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .mp-name-confirm,
        .mp-name-cancel {
            flex: 1;
            padding: 15px 25px;
            font-size: 1.1em;
            font-weight: bold;
            font-family: 'Do Hyeon', sans-serif;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mp-name-confirm {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
            box-shadow: 0 4px 15px rgba(253, 121, 168, 0.3);
        }
        
        .mp-name-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(253, 121, 168, 0.4);
        }
        
        .mp-name-cancel {
            background: #dfe6e9;
            color: #2d3436;
        }
        
        .mp-name-cancel:hover {
            background: #b2bec3;
            transform: translateY(-2px);
        }

        .game-start-btn {
            padding: 18px 60px;
            font-size: 1.5em;
            font-weight: bold;
            font-family: 'Do Hyeon', sans-serif;
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(253, 121, 168, 0.4);
            transition: all 0.3s ease;
        }

        .game-start-btn:active {
            transform: scale(0.95);
        }

        /* ê²Œì„ ëª¨ë“œ ì„ íƒ ë²„íŠ¼ */
        .game-mode-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 25px;
        }

        .mode-start-btn {
            padding: 15px 28px;
            font-size: 1.2em;
            font-weight: bold;
            font-family: 'Do Hyeon', sans-serif;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .mode-start-btn.solo {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
        }

        .mode-start-btn.together {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .mode-start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .mode-start-btn:active {
            transform: scale(0.95);
        }

        /* ê²Œì„ ì •ë³´ */
        .game-info {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 15px;
        }

        .info-box {
            background: #ffeaa7;
            padding: 15px;
            border-radius: 15px;
            flex: 1;
            text-align: center;
            box-shadow: 0 2px 6px rgba(253, 203, 110, 0.3);
        }

        .info-box div:first-child {
            font-size: 0.8em;
            color: #636e72;
            margin-bottom: 5px;
        }

        .info-box div:last-child {
            font-size: 1.5em;
            font-weight: bold;
            color: #2d3436;
        }

        /* ì•ˆë‚´ ë¬¸êµ¬ */
        .fixed-guide {
            text-align: center;
            padding: 12px;
            background: #fff5e6;
            border-radius: 20px;
            border: 2px solid #ffeaa7;
            margin-bottom: 15px;
        }

        .fixed-guide-text {
            font-size: 0.9em;
            color: #636e72;
            margin-bottom: 8px;
        }

        .fixed-guide-scores {
            font-size: 0.95em;
            font-weight: bold;
            color: #856404;
        }

        .fixed-guide-special {
            color: #e91e63;
            font-size: 1em;
            font-weight: bold;
            margin-top: 5px;
        }

        /* ì´ˆì„± */
        .consonants {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: nowrap;
            margin: 15px 0;
            padding: 15px;
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            border-radius: 20px;
        }

        .consonant {
            font-size: 2.5em;
            font-weight: bold;
            background: white;
            border-radius: 12px;
            padding: 12px 15px;
            min-width: 55px;
            text-align: center;
            animation: float 3s ease-in-out infinite;
            color: #2d3436;
            border: 3px solid #f5f5f5;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .consonant.special {
            background: linear-gradient(135deg, #fab1a0, #e91e63);
            color: white;
            border-color: #e91e63;
        }

        .consonant:nth-child(1) { animation-delay: 0s; }
        .consonant:nth-child(2) { animation-delay: 0.2s; }
        .consonant:nth-child(3) { animation-delay: 0.4s; }
        .consonant:nth-child(4) { animation-delay: 0.6s; }
        .consonant:nth-child(5) { animation-delay: 0.8s; }
        .consonant:nth-child(6) { animation-delay: 1s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        @keyframes smoothShuffle {
            0% { transform: translateX(0px) rotate(0deg); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-3px) rotate(-1deg); }
            100% { transform: translateX(0px) rotate(0deg); }
        }

        .consonants.shuffling .consonant {
            animation: smoothShuffle 0.6s ease-in-out;
        }

        /* ì´ëª¨í‹°ì½˜ - PC ì „ìš© */
        .emoji-display {
            text-align: center;
            font-size: 4em;
            margin: 15px 0;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .emoji-text {
            font-size: 0.4em;
            font-weight: bold;
            margin-top: 5px;
            color: #2d3436;
        }

        .emoji-score {
            font-size: 0.35em;
            color: #fd79a8;
            font-weight: bold;
            margin-top: 2px;
        }

        /* ì ìˆ˜ë³„ ì´ëª¨í‹°ì½˜ ì• ë‹ˆë©”ì´ì…˜ */
        .emoji-score-10 { animation: gentleBounce 2s ease-in-out infinite; }
        .emoji-score-30 { animation: subtlePulse 1.5s ease-in-out infinite; }
        .emoji-score-50 { animation: smartShake 2s ease-in-out infinite; }
        .emoji-score-100 { animation: starJump 1.8s ease-in-out infinite; }
        .emoji-score-400 { animation: fireBlaze 2s ease-in-out infinite; }
        .emoji-score-500 { animation: crownGlow 2.5s ease-in-out infinite; }

        @keyframes gentleBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes subtlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes smartShake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-3deg); }
            75% { transform: rotate(3deg); }
        }

        @keyframes starJump {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.1); }
        }

        @keyframes fireBlaze {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        @keyframes crownGlow {
            0%, 100% { 
                transform: scale(1);
                filter: brightness(1);
            }
            50% { 
                transform: scale(1.3);
                filter: brightness(1.5);
            }
        }

        /* ëœ» ì˜ì—­ (ê³ ì • ë†’ì´ë¡œ ë ˆì´ì•„ì›ƒ ì•ˆì •í™”) */
        .definition-container {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 20px;
            margin-bottom: 5px;
            height: 60px;
            min-height: 60px;
            max-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
        }

        .definition-text {
            font-size: 1em;
            color: #2d3436;
            line-height: 1.5;
            text-align: center;
        }

        /* ì…ë ¥ì°½ - PCìš© */
        .input-section {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            min-height: 60px !important; /* ê³ ì • ë†’ì´ë¡œ ë ˆì´ì•„ì›ƒ ì•ˆì •í™” */
            max-height: 60px !important;
            height: 60px !important;
        }

        .word-input {
            flex: 1;
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid #fdcb6e;
            border-radius: 15px;
            outline: none;
            text-align: center;
            font-weight: bold;
        }

        .word-input:focus {
            border-color: #fd79a8;
        }
        
        /* í„´ì œ ëª¨ë“œ: ìì‹ ì˜ í„´ì¼ ë•Œ ë‹¨ì–´ ì…ë ¥ì°½ í…Œë‘ë¦¬ ê¹œë¹¡ì„ (PC ë²„ì „) */
        .word-input.my-turn {
            border: 2px solid #6bff6b;
            animation: turnInputPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes turnInputPulse {
            0%, 100% {
                border-color: #6bff6b;
                box-shadow: 0 0 0 0 rgba(107, 255, 107, 0.7);
            }
            50% {
                border-color: #8aff8a;
                box-shadow: 0 0 15px 3px rgba(107, 255, 107, 0.8);
            }
        }

        .submit-btn {
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .submit-btn:active {
            transform: scale(0.95);
        }

        .reset-btn {
            background: #ff7675;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 12px 20px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 118, 117, 0.4);
            transition: all 0.2s ease;
        }

        .reset-btn:active {
            transform: scale(0.95);
        }

        /* ê²Œì„ ì¢…ë£Œ í™”ë©´ */
        .game-end-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .game-end-content {
            background: white;
            border-radius: 18px;
            padding: 25px 20px;
            max-width: 420px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
        }

        .mascot {
            font-size: 3.5em;
            text-align: center;
            margin: 12px 0;
        }

        .game-end-title {
            font-family: 'Do Hyeon', sans-serif;
            font-size: 1.8em;
            font-weight: bold;
            color: #2d3436;
            text-align: center;
            margin-bottom: 8px;
        }

        .final-score {
            font-size: 2.2em;
            font-weight: bold;
            color: #fd79a8;
            text-align: center;
            margin: 12px 0;
        }

        .game-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 18px 0;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.8em;
            color: #636e72;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2d3436;
        }

        .end-buttons {
            display: flex;
            gap: 8px;
            margin-top: 20px;
        }

        .end-btn {
            flex: 1;
            padding: 11px;
            border: none;
            border-radius: 10px;
            font-size: 0.95em;
            font-weight: bold;
            cursor: pointer;
        }

        .end-btn.primary {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
        }

        .end-btn.secondary {
            background: #f5f5f5;
            color: #636e72;
        }

        .study-notes {
            margin-top: 20px;
            padding-top: 18px;
            border-top: 2px solid #f0f0f0;
        }

        .study-notes h3 {
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #2d3436;
        }

        .word-list {
            display: flex;
            flex-direction: column;
            gap: 7px;
            max-height: 250px;
            overflow-y: auto;
        }

        .word-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #ffeaa7;
        }

        .word-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .word-header strong {
            font-size: 1em;
            color: #2d3436;
        }

        .word-header span {
            font-size: 0.9em;
            font-weight: bold;
            color: #fd79a8;
        }

        .word-def {
            font-size: 0.8em;
            color: #636e72;
            line-height: 1.3;
        }

        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ - PCìš© (ì‚¬ìš© ì•ˆí•¨) */
        .toast {
            display: none;
        }

        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ - ëª¨ë°”ì¼ìš© */
        .toast-message {
            position: fixed;
            bottom: 160px; /* ë‹¨ì–´ ì…ë ¥ì°½ ìœ„, ë‹¨ì–´ ìŒ“ì´ëŠ” ì˜ì—­ ì‚´ì§ ì¹¨ë²” ê°€ëŠ¥ */
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 152, 0, 0.95); /* ğŸš€ í•‘í¬ â†’ ì£¼í™©/ì½”ë„ ê³„ì—´ë¡œ ë³€ê²½ */
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: bold;
            z-index: 9999;
            text-align: center;
            animation: toastFade 0.8s ease-in-out;
            pointer-events: none;
            max-width: 90%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        @keyframes toastFade {
            0% { opacity: 0; transform: translateX(-50%) scale(0.8); }
            50% { opacity: 1; transform: translateX(-50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }
        
        /* ë©€í‹°í”Œë ˆì´ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ (PCìš©) */
        .mp-toast {
            position: fixed;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
            padding: 20px 35px;
            border-radius: 20px;
            font-size: 1.2em;
            font-weight: bold;
            font-family: 'Do Hyeon', sans-serif;
            z-index: 10002;
            text-align: center;
            box-shadow: 0 8px 30px rgba(253, 121, 168, 0.4);
            animation: mpToastFade 0.5s ease-out;
            pointer-events: none;
            max-width: 400px;
            word-break: keep-all;
        }
        
        @keyframes mpToastFade {
            0% { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.7) translateY(-20px); 
            }
            50% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1.05) translateY(0); 
            }
            100% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1) translateY(0); 
            }
        }

        .hidden {
            display: none !important;
        }

        /* ===== ë©€í‹°í”Œë ˆì´ ëª¨ë‹¬ CSS ===== */
        .mp-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .mp-modal-content {
            background: white;
            border-radius: 25px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
        }

        .mp-modal-title {
            font-family: 'Do Hyeon', sans-serif;
            font-size: 2em;
            font-weight: bold;
            color: #fd79a8;
            text-align: center;
            margin-bottom: 30px;
        }

        .mp-room-list {
            margin-bottom: 20px;
        }

        .mp-empty-message {
            text-align: center;
            color: #636e72;
            font-size: 1.2em;
            padding: 40px 20px;
            background: #f8f9fa;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .mp-room-item {
            background: #f8f9fa;
            border: 3px solid #dfe6e9;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .mp-room-item:hover {
            border-color: #fd79a8;
            /* ğŸš€ transform ì œê±° - í˜¸ë²„ ì‹œ ì´ë™ íš¨ê³¼ ì—†ìŒ */
            box-shadow: 0 4px 15px rgba(253, 121, 168, 0.2);
        }

        .mp-room-info {
            flex: 1;
        }

        .mp-room-title {
            font-size: 1.2em; /* ğŸ†• 1.3em â†’ 1.2em (ì œëª©ì´ ê¸¸ ìˆ˜ ìˆìœ¼ë¯€ë¡œ) */
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 5px; /* ğŸ†• ê²Œì„ ëª¨ë“œì™€ ê°„ê²© */
        }
        
        .mp-room-mode {
            font-size: 0.9em;
            color: #fd79a8;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .mp-room-players {
            font-size: 0.9em;
            color: #2d3436;
            margin: 5px 0;
            font-weight: normal;
        }

        .mp-room-status {
            font-size: 1em;
            color: #636e72;
        }

        .mp-join-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mp-join-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(9, 132, 227, 0.4);
        }

        .mp-create-solo-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: bold;
            font-family: 'Do Hyeon', sans-serif;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .mp-create-solo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(253, 121, 168, 0.4);
        }

        .mp-close-btn {
            width: 100%;
            padding: 15px;
            background: #dfe6e9;
            color: #2d3436;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mp-close-btn:hover {
            background: #b2bec3;
        }

        @keyframes mascotSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes mascotJump {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }

        @keyframes mascotPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes mascotShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-7px); }
            75% { transform: translateX(7px); }
        }

        .mascot.mascotSpin { animation: mascotSpin 2s ease-in-out infinite; }
        .mascot.mascotJump { animation: mascotJump 1s ease-in-out infinite; }
        .mascot.mascotPulse { animation: mascotPulse 1.5s ease-in-out infinite; }
        .mascot.mascotShake { animation: mascotShake 0.5s ease-in-out infinite; }

        /* ===== ë©€í‹°í”Œë ˆì´ ì¢Œì¸¡ ìŠ¬ë¡¯ + ìš°ì¸¡ ì±„íŒ… ===== */
        
        /* ì¢Œì¸¡ ìŠ¬ë¡¯ ì˜ì—­ (ê¸°ë³¸ - ì‹œê°„ì œ ê¸°ì¤€) */
        .player-slots-left {
            position: fixed;
            left: 20px;
            top: 100px;
            width: 220px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 100;
            height: calc(100vh - 140px); /* ì¤‘ì•™ ì»¨í…Œì´ë„ˆì™€ ìˆ˜í‰/ìˆ˜ì§ ë§ì¶¤ (í„´ì œ ìŠ¤íƒ€ì¼ ì°¸ê³ ) */
        }
        
        /* ë°©ë²ˆí˜¸/ë°©ì œ í‘œì‹œ ë°•ìŠ¤ (ê¸°ë³¸ - ì‹œê°„ì œ ì»¬ëŸ¬í†¤) */
        .turn-room-info {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 50%, #fab1a0 100%);
            border: 2px solid #fdcb6e;
            border-radius: 12px;
            padding: 10px 12px;
            margin-bottom: 5px;
            box-shadow: 0 4px 12px rgba(253, 203, 110, 0.35);
        }
        
        .turn-room-title {
            font-size: 0.95em;
            font-weight: bold;
            color: #d63031;
            margin-bottom: 2px;
            text-align: center;
        }
        
        .turn-room-id {
            font-size: 0.8em;
            color: #6d4c41;
            text-align: center;
        }

        .player-slots-left.hidden {
            display: none;
        }

        /* ê°œë³„ ìŠ¬ë¡¯ */
        .player-slot {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 3px solid #fd79a8;
            border-radius: 18px;
            padding: 18px;
            box-shadow: 0 6px 20px rgba(253, 121, 168, 0.25),
                        0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            transition: all 0.3s ease;
            min-height: 100px;
            overflow: hidden;
        }
        
        .player-slot::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #fd79a8, #fdcb6e, #ffeaa7);
        }

        /* 1ë“± ìŠ¬ë¡¯ - í™”ë ¤í•˜ê²Œ! */
        .player-slot.rank-1 {
            border: 3px solid #fdcb6e;
            box-shadow: 0 8px 25px rgba(253, 203, 110, 0.4),
                        0 2px 10px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, #fff9e6 0%, #fff5d6 100%);
        }
        
        .player-slot.rank-1::before {
            background: linear-gradient(90deg, #fdcb6e, #ffeaa7, #fdcb6e);
            height: 5px;
        }
        
        .player-slot:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(253, 121, 168, 0.35),
                        0 4px 12px rgba(0, 0, 0, 0.15);
        }

        @keyframes rankOnePulse {
            /* ì‚¬ìš© ì•ˆ í•¨ */
        }

        /* í—¤ë” (ì´ë¦„ + ìƒíƒœ) */
        .slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(253, 121, 168, 0.2);
        }

        .slot-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #2d3436;
        }

        .slot-status {
            font-size: 0.9em;
        }

        /* ìŠ¬ë¡¯ ì •ë³´ë“¤ */
        .slot-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .slot-info-row {
            display: flex;
            align-items: center;
            font-size: 1em;
            color: #2d3436;
        }

        .slot-info-row .icon {
            margin-right: 6px;
        }

        /* ì ìˆ˜ - ë” í¼ì§í•˜ê²Œ */
        .slot-score {
            font-size: 2em;
            font-weight: bold;
            color: #2d3436;
        }

        /* ===== ì‹œê°„ì œ ëª¨ë“œ: ì¢Œì¸¡ ìŠ¬ë¡¯ 5ì¹¸ì„ ê· ì¼í•˜ê²Œ ë³´ì´ë„ë¡ í°íŠ¸/ë†’ì´ ì¡°ì • ===== */
        body:not(.turn-mode) .player-slot {
            padding: 8px 10px;
            min-height: 0;
            margin: 0;
            flex: 0 0 calc((100% - 32px) / 5); /* gap 8px * 4 = 32px */
            height: calc((100% - 32px) / 5);
        }

        body:not(.turn-mode) .player-slot.empty {
            flex: 0 0 calc((100% - 32px) / 5);
            height: calc((100% - 32px) / 5);
        }

        body:not(.turn-mode) .slot-header {
            margin-bottom: 6px;
            padding-bottom: 4px;
        }

        body:not(.turn-mode) .slot-name {
            font-size: 0.95em;
        }

        body:not(.turn-mode) .slot-info {
            gap: 4px;
        }

        body:not(.turn-mode) .slot-info-row {
            font-size: 0.8em;
            line-height: 1.2;
        }

        body:not(.turn-mode) .slot-score {
            font-size: 1.3em;
        }

        /* ì ìˆ˜ íŒì—…! - í•‘í¬ìƒ‰ + ë” í¬ê²Œ! */
        .slot-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3.5em;
            font-weight: bold;
            color: #fd79a8;
            text-shadow: 
                3px 3px 6px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(253, 121, 168, 0.8);
            animation: popupBurst 1s ease-out forwards;
            pointer-events: none;
            z-index: 10;
        }

        @keyframes popupBurst {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0.3);
            }
            30% {
                opacity: 1;
                transform: translate(-50%, -70%) scale(1.4);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -110%) scale(1.2);
            }
        }

        /* í„´ì œ ëª¨ë“œ: í˜„ì¬ í„´ í‘œì‹œ */
        .player-slot.current-turn {
            border: 3px solid #fd79a8;
            box-shadow: 0 0 20px rgba(253, 121, 168, 0.5);
            /* ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ ì œê±° */
        }
        
        @keyframes turnPulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.02);
            }
        }
        
        .turn-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #fd79a8;
            border-radius: 50%;
            margin-left: 8px;
            animation: turnPulse 2s ease-in-out infinite; /* ğŸ†• 1ì´ˆ â†’ 2ì´ˆë¡œ ëŠë¦¬ê²Œ */
        }
        
        @keyframes turnPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        
        /* í„´ì œ ëª¨ë“œ: ì—°ì¥ê¶Œ í‘œì‹œ */
        .extension-tickets {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.95em;
            color: #e84393;
            margin-top: 6px;
        }
        
        .extension-ticket-icon {
            font-size: 1.1em;
        }
        
        /* í„´ì œ ëª¨ë“œ: ë§ì¶˜ ë‹¨ì–´ ìˆ˜ */
        .words-matched {
            font-size: 0.9em;
            color: #636e72;
            margin-top: 4px;
        }
        
        /* í„´ì œ ëª¨ë“œ: 5ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸ */
        .turn-timer {
            font-size: 4em;
            font-weight: bold;
            color: #6bff6b;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
            border-radius: 20px;
            margin: 10px 0;
            border: 3px solid #8a8aff;
            box-shadow: 0 4px 15px rgba(138, 138, 255, 0.3);
            animation: timerPulse 1s ease-in-out infinite;
        }
        
        .turn-timer.warning {
            color: #6bff6b;
            border-color: #6bff6b;
            animation: timerUrgent 0.5s ease-in-out infinite;
        }
        
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes timerUrgent {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.9; }
        }
        
        /* í„´ì œ ëª¨ë“œ: ì‚¬ìš©ëœ ë‹¨ì–´ ì˜ì—­ */
        .used-words-turn {
            max-height: 200px !important; /* ê³ ì • ë†’ì´ 200px (ì•½ 6-7ì¤„) */
            height: 200px !important; /* ê³ ì • ë†’ì´ */
            overflow-y: auto;
            padding: 8px 10px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 0.85em;
            line-height: 1.4;
            flex-shrink: 0; /* ì°½ í¬ê¸° ê³ ì • */
        }
        
        .used-words-turn .word-item {
            display: inline-block;
            margin: 2px 4px 2px 0;
            padding: 3px 6px;
            background: white;
            border-radius: 6px;
            border: 1px solid #dfe6e9;
            font-size: 0.9em;
        }
        
        .used-words-turn .word-item.recent {
            color: #6bff6b;
            font-weight: bold;
            background: #f0fff0;
            border-color: #6bff6b;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì„¤ëª… ë¬¸êµ¬ */
        .turn-mode-guide {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #6b6b8a 0%, #8a8a9a 100%);
            border: 2px solid #8a8aff;
            border-radius: 15px;
            margin: 15px 0;
            font-size: 0.95em;
            line-height: 1.6;
            color: #b8b8d0;
        }
        
        .turn-mode-guide .special-bonus {
            color: #6bff6b;
            font-weight: bold;
        }
        
        /* í„´ì œ ëª¨ë“œ: í•˜íŠ¸ ì´ëª¨ì§€ ìƒ‰ìƒ ë³€ê²½ (ì´ëª¨ì§€ëŠ” CSSë¡œ ì§ì ‘ ë³€ê²½ ë¶ˆê°€, filter ì‚¬ìš©) */
        body.turn-mode .special-bonus {
            filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);
        }
        
        /* ===== í„´ì œ ëª¨ë“œ ì „ìš© ë”¥ì‹œí¬ ìƒ‰ìƒ ìŠ¤íƒ€ì¼ ===== */
        /* í„´ì œ ëª¨ë“œ: ì „ì²´ ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ */
        body.turn-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #151520 100%) !important;
        }
        
        /* í„´ì œ ëª¨ë“œ: í”Œë ˆì´ì–´ ìŠ¬ë¡¯ ìƒ‰ìƒ ë³€ê²½ (ê¸°ë³¸ ìŠ¬ë¡¯ì€ ì‹¬í”Œí•˜ê²Œ) */
        body.turn-mode .player-slot {
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
            border: 1px solid #6a6a8a;
            box-shadow: none;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì™¼ìª½ ìŠ¬ë¡¯ ì˜ì—­ - 5ê°œë¥¼ ë™ì¼ ë†’ì´ë¡œ 5ë“±ë¶„, ì²«ë²ˆì§¸ ìŠ¬ë¡¯ê³¼ ì¤‘ì•™í™”ë©´ ìˆ˜í‰ ì •ë ¬ */
        body.turn-mode .player-slots-left {
            top: 100px !important; /* ì¤‘ì•™í™”ë©´ê³¼ ìˆ˜í‰ ì •ë ¬ (header ì•„ë˜) */
            height: calc(100vh - 140px) !important; /* ì¤‘ì•™í™”ë©´ê³¼ ë™ì¼ ë†’ì´ */
            display: flex !important;
            flex-direction: column !important;
            gap: 6px !important; /* ì‚´ì§ ì—¬ë°± ì¶”ê°€ */
            justify-content: flex-start !important;
        }
        
        body.turn-mode .player-slot {
            flex: 0 0 calc((100% - 24px) / 5) !important; /* 5ë“±ë¶„í•˜ë˜ ì—¬ë°±(6px * 4) ê³ ë ¤, ì„¸ë¡œ ê¸¸ì´ ì‚´ì§ ì¤„ì„ */
            min-height: 0 !important;
            margin: 0 !important;
            height: calc((100vh - 140px - 24px) / 5) !important; /* ì—¬ë°± ì œì™¸í•œ ë†’ì´ */
        }
        
        body.turn-mode .player-slot.empty {
            flex: 0 0 calc((100% - 24px) / 5) !important; /* ë¹ˆ ìŠ¬ë¡¯ë„ ë™ì¼ ë†’ì´ */
            height: calc((100vh - 140px - 24px) / 5) !important;
        }
        
        /* ê¸°ë³¸ ìŠ¬ë¡¯ í…Œë‘ë¦¬ ë¼ì¸ì€ ë”, í˜„ì¬ í„´ì—ì„œë§Œ ì‚¬ìš© */
        body.turn-mode .player-slot::before {
            background: none;
        }
        
        body.turn-mode .player-slot.current-turn {
            border: 2px solid #6bff6b;
            box-shadow: 0 0 14px rgba(107, 255, 107, 0.5);
        }
        
        body.turn-mode .slot-name {
            color: #6bff6b;
        }
        
        body.turn-mode .slot-info-row {
            color: #e0e0e0;
        }
        
        body.turn-mode .slot-status {
            color: #b8b8d0;
        }
        
        /* í„´ì œ ëª¨ë“œ: í•˜íŠ¸ ìƒ‰ìƒ - ë¹¨ê°„ í•˜íŠ¸ë¥¼ ì—°ë‘ìƒ‰ìœ¼ë¡œ */
        body.turn-mode .slot-info-row .icon {
            filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);
        }
        
        /* í„´ì œ ëª¨ë“œ: í•˜íŠ¸ê°€ í¬í•¨ëœ í…ìŠ¤íŠ¸ */
        body.turn-mode .slot-info-row:has(.icon) {
            color: #e0e0e0;
        }
        
        /* í„´ì œ ëª¨ë“œ: í•˜íŠ¸ ì´ëª¨ì§€ ìƒ‰ìƒ (ì´ëª¨ì§€ëŠ” CSSë¡œ ì§ì ‘ ë³€ê²½ ë¶ˆê°€, JavaScriptë¡œ ì²˜ë¦¬) */
        body.turn-mode .heart-green {
            color: #6bff6b;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì´ˆì„± ê¸€ì ìƒ‰ìƒ ë³€ê²½ */
        body.turn-mode .consonants {
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
            border: 2px solid #6a6a8a;
        }
        
        body.turn-mode .consonant {
            background: #3a3a5a;
            color: #ffffff;
            border: 3px solid #6a6a8a;
        }
        
        body.turn-mode .consonant.special {
            background: #8a8aff;
            color: #ffffff;
            border: 3px solid #6a6a8a;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì±„íŒ… ì˜ì—­ */
        body.turn-mode .chat-container {
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%) !important;
            border: 2px solid #6a6a8a;
            top: 100px !important; /* ì¤‘ì•™í™”ë©´ê³¼ ìˆ˜í‰ ì •ë ¬ */
        }
        
        body.turn-mode .chat-title {
            color: #b8b8d0;
        }
        
        body.turn-mode .chat-message {
            color: #e0e0e0;
            background: #151520 !important; /* í°ìƒ‰ ë°°ê²½ ì œê±° */
            line-height: 1.1 !important; /* í–‰ê°„ ë” ì¤„ì´ê¸° */
            margin-bottom: 4px !important; /* ë©”ì‹œì§€ ê°„ê²© ë” ì¤„ì´ê¸° */
            padding: 6px 10px !important; /* íŒ¨ë”©ë„ ì¤„ì´ê¸° */
        }
        
        body.turn-mode .chat-messages {
            background: #151520 !important; /* í°ìƒ‰ ë°°ê²½ ì œê±° */
        }
        
        body.turn-mode .chat-input {
            background: #151520 !important; /* í°ìƒ‰ ë°°ê²½ ì œê±° */
            border: 2px solid #6a6a8a;
            color: #ffffff;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì…ë ¥ì°½ */
        body.turn-mode .word-input {
            background: #151520;
            border: 2px solid #6a6a8a;
            color: #ffffff;
        }
        
        body.turn-mode .word-input::placeholder {
            color: #6b6b8a;
        }
        
        body.turn-mode .word-input:focus {
            border-color: #6bff6b;
        }
        
        /* í„´ì œ ëª¨ë“œ: "ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" í…ìŠ¤íŠ¸ */
        body.turn-mode .word-input:not(:disabled)::placeholder {
            color: #6b6b8a;
        }
        
        /* í„´ì œ ëª¨ë“œ: ë‹¨ì–´ ëœ» ì˜ì—­ */
        body.turn-mode .definition-container {
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
            border: 2px solid #6a6a8a;
        }
        
        body.turn-mode .definition-text {
            color: #e0e0e0;
        }
        
        /* í„´ì œ ëª¨ë“œ: "ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ë©´ ëœ»ì´ í‘œì‹œë©ë‹ˆë‹¤" í…ìŠ¤íŠ¸ */
        body.turn-mode .definition-text:empty::before {
            color: #8a8a9a;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì‹œì‘ í™”ë©´ */
        body.turn-mode .start-title {
            color: #6bff6b;
        }
        
        body.turn-mode .start-instruction {
            color: #e0e0e0;
        }
        
        body.turn-mode .score-guide {
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
            border: 3px solid #6a6a8a;
            color: #b8b8d0;
        }
        
        body.turn-mode .score-item {
            color: #6bff6b;
        }
        
        body.turn-mode .special-score {
            color: #b8b8d0;
        }
        
        body.turn-mode .turn-mode-guide {
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
            border: 2px solid #6a6a8a;
            color: #e0e0e0;
        }
        
        /* í„´ì œ ëª¨ë“œ: ìµœê³  ê¸°ë¡ ìˆ¨ê¸°ê¸° */
        body.turn-mode .best-score-display {
            display: none !important;
        }
        
        /* í„´ì œ ëª¨ë“œ: ê²Œì„ ì‹œì‘ ë²„íŠ¼ ìƒ‰ìƒ (ì—°ë‘ìƒ‰ ê³„ì—´) */
        body.turn-mode .mode-start-btn.solo,
        body.turn-mode .mode-start-btn.together {
            background: linear-gradient(135deg, #6bff6b, #8a8aff) !important;
            color: #ffffff;
        }
        
        body.turn-mode .mode-start-btn:hover {
            background: linear-gradient(135deg, #8aff8a, #9a9aff) !important;
        }
        
        /* í„´ì œ ëª¨ë“œ: ë‚˜ê°€ê¸° ë²„íŠ¼ ìƒ‰ìƒ (íšŒìƒ‰ ê³„ì—´) */
        body.turn-mode .reset-btn,
        body.turn-mode #mpLeaveBtn {
            background: #6b6b8a !important;
            color: #e0e0e0 !important;
        }
        
        body.turn-mode .reset-btn:hover,
        body.turn-mode #mpLeaveBtn:hover {
            background: #8a8a9a !important;
        }
        
        /* í„´ì œ ëª¨ë“œ: ë°©ë²ˆí˜¸/ë°©ì œ í‘œì‹œ - ë”¥ì‹œí¬ í†¤ìœ¼ë¡œ override */
        body.turn-mode .turn-room-info {
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
            border: 2px solid #6a6a8a;
        }
        
        body.turn-mode .turn-room-title {
            color: #6bff6b;
        }
        
        body.turn-mode .turn-room-id {
            color: #8a8a9a;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì‚¬ìš©ëœ ë‹¨ì–´ ì˜ì—­ */
        body.turn-mode .used-words-turn {
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
            border: 2px solid #6a6a8a;
        }
        
        body.turn-mode .used-words-turn .word-item {
            color: #6b6b8a !important; /* ë” ì§™ì€ íšŒìƒ‰ìœ¼ë¡œ ë³€ê²½ (ê°€ë…ì„± í–¥ìƒ) */
        }
        
        body.turn-mode .used-words-turn .word-item.recent {
            color: #6bff6b;
            background: rgba(107, 255, 107, 0.1);
            border-color: #6bff6b;
        }
        
        /* í„´ì œ ëª¨ë“œ: "ì•„ì§ ì‚¬ìš©ëœ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤" í…ìŠ¤íŠ¸ */
        body.turn-mode .used-words-turn div[style*="color: #999"] {
            color: #8a8a9a !important;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì¢…ë£Œ ëª¨ë‹¬ */
        body.turn-mode .mp-result-content {
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 50%, #151520 100%);
            border: 3px solid #6a6a8a;
            overflow-y: visible !important;
            max-height: none !important;
        }
        
        body.turn-mode .mp-result-title {
            color: #6bff6b;
        }
        
        body.turn-mode .mp-result-player {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 2px solid #6a6a8a;
        }
        
        body.turn-mode .mp-result-player.rank-1 {
            background: linear-gradient(135deg, #3a3a5a, #6bff6b, #3a3a5a);
            border: 2px solid #6bff6b;
            box-shadow: 0 4px 14px rgba(107, 255, 107, 0.35);
        }
        
        body.turn-mode .mp-result-player-name {
            color: #6bff6b;
        }
        
        body.turn-mode .mp-result-player-stats {
            color: #e0e0e0;
        }
        
        body.turn-mode .mp-result-player-words {
            color: #b8b8d0;
        }
        
        /* í„´ì œ ëª¨ë“œ: í™•ì¸ ë²„íŠ¼ - ë‹¨ì–´ ì…ë ¥ì°½ê³¼ í†µì¼ê° (ì—°ë‘ìƒ‰ í…Œë‘ë¦¬, í°íŠ¸ ìƒ‰ê¹”, ë¹›ë‚˜ëŠ” íš¨ê³¼) */
        body.turn-mode .submit-btn {
            background: #151520 !important;
            border: 2px solid #6bff6b !important;
            color: #6bff6b !important;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(107, 255, 107, 0.5);
            transition: all 0.3s ease;
        }
        
        body.turn-mode .submit-btn:hover {
            border-color: #8aff8a !important;
            color: #8aff8a !important;
            box-shadow: 0 0 15px 3px rgba(107, 255, 107, 0.8);
        }
        
        body.turn-mode .submit-btn:active {
            transform: scale(0.95);
        }
        
        /* í„´ì œ ëª¨ë“œ: ì „ì†¡ ë²„íŠ¼ ìƒ‰ìƒ */
        body.turn-mode .mp-name-btn:not(.secondary) {
            background: linear-gradient(135deg, #6bff6b, #8a8aff);
            color: #ffffff;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì¢…ë£Œí™”ë©´ ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ (ë°©ì¥) - ê·¸ë¼ë°ì´ì…˜ íš¨ê³¼ ë‚®ì¶¤ (ê¸€ì ê°€ë…ì„± í–¥ìƒ) */
        body.turn-mode .mp-result-btn.replay {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #1a1a2e) !important;
            border: 2px solid #6bff6b !important;
            color: #6bff6b !important;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(107, 255, 107, 0.3);
        }
        
        body.turn-mode .mp-result-btn.replay:hover {
            background: linear-gradient(135deg, #2a2a3e, #26314e, #2a2a3e) !important;
            border-color: #8aff8a !important;
            color: #8aff8a !important;
        }
        
        /* í„´ì œ ëª¨ë“œ: ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” ë©”ì‹œì§€ (ì°¸ê°€ì) - ê·¸ë¼ë°ì´ì…˜ íš¨ê³¼ ë‚®ì¶¤ (ê¸€ì ê°€ë…ì„± í–¥ìƒ) */
        body.turn-mode .mp-waiting-message {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #1a1a2e) !important;
            border: 2px solid #6bff6b !important;
            color: #6bff6b !important;
            font-weight: bold;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 6px 20px rgba(107, 255, 107, 0.3);
        }
        
        /* í„´ì œ ëª¨ë“œ: ë°© ë‚˜ê°€ê¸° ë²„íŠ¼ */
        body.turn-mode .mp-result-btn.home {
            background: #6b6b8a !important;
            color: #e0e0e0 !important;
        }
        
        body.turn-mode .mp-result-btn.home:hover {
            background: #8a8a9a !important;
            color: #e0e0e0 !important;
        }
        
        /* í„´ì œ ëª¨ë“œ: ìƒëª…ê¶Œ íšë“ í† ìŠ¤íŠ¸ ìƒ‰ìƒ - ê·¸ë¼ë°ì´ì…˜ íš¨ê³¼ ë‚®ì¶¤ (ê¸€ì ê°€ë…ì„± í–¥ìƒ) */
        body.turn-mode .toast-message {
            background: linear-gradient(135deg, rgba(26, 33, 62, 0.95), rgba(58, 58, 90, 0.95), rgba(26, 33, 62, 0.95)) !important;
            border: 2px solid #6bff6b !important;
            box-shadow: 0 4px 14px rgba(107, 255, 107, 0.3) !important;
        }
        
        body.turn-mode .toast-text {
            color: #6bff6b !important;
            font-weight: bold;
        }
        
        /* í„´ì œ ëª¨ë“œ: ê²Œì„ í™”ë©´ ë°°ê²½ */
        body.turn-mode #gameScreen {
            background: #151520;
            border: 3px solid #151520 !important;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì‹œì‘ í™”ë©´ ì¤‘ì•™ ë°•ìŠ¤ ë°°ê²½ */
        body.turn-mode .game-start-section {
            background: #151520;
            border: 3px solid #151520 !important;
            border-radius: 20px;
            padding: 30px 20px;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì»¨í…Œì´ë„ˆ ë°°ê²½ ë° í…Œë‘ë¦¬ */
        body.turn-mode .container {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
        }
        
        body.turn-mode .container #gameScreen {
            border: 3px solid #151520 !important;
            min-height: calc(100vh - 200px) !important; /* ê³ ì • ë†’ì´ë¡œ ë ˆì´ì•„ì›ƒ ì•ˆì •í™” */
            height: auto !important;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì •ì˜ ì»¨í…Œì´ë„ˆë„ ë™ì¼ ë†’ì´ ìœ ì§€ */
        body.turn-mode .definition-container {
            min-height: 60px !important;
            max-height: 60px !important;
            height: 60px !important;
            overflow-y: auto !important;
        }

        /* í„´ì œ ëª¨ë“œ: ìƒëª…ê¶Œ ìˆ«ì ê°•ì¡° */
        body.turn-mode .lives-count {
            color: #6bff6b;
            font-weight: 700;
            text-shadow: 0 0 8px rgba(107, 255, 107, 0.7);
        }

        /* í„´ì œ ëª¨ë“œ: í˜„ì¬ í„´ì¸ ìŠ¬ë¡¯ ê°•ì¡° (ëª…í™•í•˜ê²Œ êµ¬ë¶„) */
        body.turn-mode .player-slot.current-turn {
            border: 3px solid #6bff6b;
            box-shadow: 0 0 20px rgba(107, 255, 107, 0.7);
            transform: translateY(-3px);
            position: relative;
        }

        /* í˜„ì¬ í„´ ìŠ¬ë¡¯ ìƒë‹¨ì— ë°˜ì§ì´ëŠ” ë¼ì¸ */
        body.turn-mode .player-slot.current-turn::before {
            content: '';
            position: absolute;
            left: -2px;
            right: -2px;
            top: -2px;
            height: 3px;
            background: linear-gradient(90deg, #6a6a8a, #6bff6b, #6a6a8a);
            box-shadow: 0 0 10px rgba(107, 255, 107, 0.8);
        }

        body.turn-mode .player-slot.current-turn .slot-name {
            color: #6bff6b;
            font-weight: 800;
        }
        
        /* í„´ì œ ëª¨ë“œ: í—¤ë” */
        body.turn-mode .header {
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
            border: 2px solid #6a6a8a;
            color: #e0e0e0;
        }
        
        body.turn-mode .logo {
            color: #6bff6b;
        }
        
        body.turn-mode .header button {
            color: #b8b8d0;
        }
        
        body.turn-mode .header button:hover {
            color: #6bff6b;
        }
        
        /* í„´ì œ ëª¨ë“œ: BGM/íš¨ê³¼ìŒ/íƒ€ê±´ìŒ ë²„íŠ¼ */
        body.turn-mode .audio-btn {
            background: #6b6b8a;
            color: #e0e0e0;
            border: 2px solid #6a6a8a;
        }
        
        body.turn-mode .audio-btn:hover {
            background: #8a8a9a;
            color: #e0e0e0;
        }
        
        body.turn-mode .audio-btn.active {
            background: #6b6b8a;
            color: #6bff6b;
        }
        
        /* í„´ì œ ëª¨ë“œ: ê²Œì„ ì •ë³´ (ì ìˆ˜, íƒ€ì´ë¨¸ ë“±) */
        body.turn-mode .game-info {
            color: #e0e0e0;
        }
        
        body.turn-mode #score,
        body.turn-mode #timer,
        body.turn-mode #bestScore {
            color: #e0e0e0;
        }
        
        /* í„´ì œ ëª¨ë“œ: í„´ íƒ€ì´ë¨¸ (ì´ë¯¸ ìœ„ì—ì„œ ì •ì˜ë¨) */
        
        /* í„´ì œ ëª¨ë“œ: ë¹ˆ ìŠ¬ë¡¯ */
        body.turn-mode .player-slot.empty {
            background: linear-gradient(135deg, #151520 0%, #16213e 100%);
            border: 2px dashed #6a6a8a;
            color: #8a8a9a;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì±„íŒ… ì…ë ¥ì°½ */
        body.turn-mode .chat-input {
            background: #151520;
            border: 2px solid #6a6a8a;
            color: #ffffff;
        }
        
        body.turn-mode .chat-input::placeholder {
            color: #6b6b8a;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì±„íŒ… ì…ë ¥ì°½ ë° ì „ì†¡ ë²„íŠ¼ ìˆ¨ê¸°ê¸° */
        body.turn-mode .chat-input-box {
            display: none !important;
        }
        
        /* í„´ì œ ëª¨ë“œ: ëª¨ë“  í…ìŠ¤íŠ¸ ê¸°ë³¸ ìƒ‰ìƒ */
        body.turn-mode {
            color: #e0e0e0;
        }
        
        body.turn-mode .score-item,
        body.turn-mode .special-score {
            color: #b8b8d0;
        }
        
        body.turn-mode .special-score-detail {
            color: #8a8a9a;
        }
        
        /* ë¹ˆ ìŠ¬ë¡¯ */
        .player-slot.empty {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px dashed #b2bec3;
            opacity: 0.7;
            border: 2px solid #b2bec3;
            opacity: 0.7;
        }

        /* ìš°ì¸¡ ì±„íŒ… ì˜ì—­ */
        .chat-container {
            position: fixed;
            right: 20px;
            top: 100px;
            width: 280px;
            height: calc(100vh - 140px);
            max-height: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            padding: 20px;
            display: flex;
            flex-direction: column;
            z-index: 100;
        }

        .chat-container.hidden {
            display: none;
        }

        .chat-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #fd79a8;
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ffeaa7;
        }

        .chat-hint {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            font-size: 0.85em;
            color: #856404;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì±„íŒ… íŒíŠ¸ ë©”ì‹œì§€ - ì§™ì€ íšŒìƒ‰ ë°”íƒ•ì— ì˜…ì€ íšŒìƒ‰ ê¸€ì”¨ */
        body.turn-mode .chat-hint {
            background: #3a3a5a !important;
            border: 2px solid #6a6a8a !important;
            color: #b8b8d0 !important;
        }

        .chat-messages {
            flex: 1;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .chat-message {
            margin-bottom: 10px;
            padding: 8px 12px;
            background: white;
            border-radius: 10px;
            font-size: 0.9em;
            line-height: 1.4;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .chat-message .chat-name {
            font-weight: bold;
            color: #fd79a8;
            margin-right: 5px;
        }

        .chat-message .chat-text {
            color: #2d3436;
        }
        
        /* í„´ì œ ëª¨ë“œ: ì±„íŒ… ë©”ì‹œì§€ ìƒ‰ìƒ */
        body.turn-mode .chat-message .chat-name {
            color: #6bff6b !important; /* ì—°ë‘ìƒ‰ */
        }
        
        body.turn-mode .chat-message .chat-text {
            color: #b8b8d0 !important; /* ì˜…ì€ íšŒìƒ‰ */
        }

        .chat-input-box {
            display: flex;
            gap: 8px;
            height: auto !important; /* ë†’ì´ ê³ ì • */
            min-height: 50px !important; /* ìµœì†Œ ë†’ì´ */
            max-height: 50px !important; /* ìµœëŒ€ ë†’ì´ */
        }

        .chat-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #dfe6e9;
            border-radius: 10px;
            font-size: 0.9em;
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            border-color: #fd79a8;
        }

        .chat-send-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chat-send-btn:hover {
            transform: scale(1.05);
        }

        .chat-send-btn:active {
            transform: scale(0.95);
        }

        /* ë©€í‹°í”Œë ˆì´ ê²°ê³¼ ëª¨ë‹¬ */
        .mp-result-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent; /* ì–´ë‘ì›Œì§€ëŠ” íš¨ê³¼ ì œê±° */
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            pointer-events: none; /* ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ë°©ì§€ */
        }
        
        /* ì±„íŒ…ì°½ì€ ëª¨ë‹¬ ìœ„ì— í‘œì‹œ */
        .chat-container {
            z-index: 10001 !important;
            pointer-events: auto;
        }

        .mp-result-content {
            background: white;
            border: 3px solid #fd79a8; /* ëª¨ë‹¬ í…Œë‘ë¦¬ ì¶”ê°€ */
            border-radius: 25px;
            padding: 20px; /* ğŸ†• 30px â†’ 20pxë¡œ ì¶•ì†Œ */
            max-width: 600px; /* ğŸ†• 500px â†’ 600px (2ì—´ ë ˆì´ì•„ì›ƒì„ ìœ„í•´) */
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            pointer-events: auto; /* ëª¨ë‹¬ ë‚´ë¶€ëŠ” í´ë¦­ ê°€ëŠ¥ */
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); /* ê·¸ë¦¼ì íš¨ê³¼ */
        }

        .mp-result-title {
            font-size: 1.8em; /* ğŸ†• 2em â†’ 1.8em ì¶•ì†Œ */
            font-weight: bold;
            color: #fd79a8;
            text-align: center;
            margin-bottom: 15px; /* ğŸ†• 25px â†’ 15px ì¶•ì†Œ */
        }
        
        /* ğŸ†• í”Œë ˆì´ì–´ ê²°ê³¼ ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ */
        .mp-result-players-grid {
            display: grid;
            gap: 12px; /* ğŸ†• 15px â†’ 12px ì¶•ì†Œ */
            margin-bottom: 15px;
        }
        
        .mp-result-players-grid.single-column {
            grid-template-columns: 1fr;
        }
        
        .mp-result-players-grid.two-column {
            grid-template-columns: 1fr 1fr;
        }
        
        .mp-result-players-grid.hybrid {
            grid-template-columns: 1.2fr 1fr; /* ğŸ†• 1ìœ„ëŠ” ë” ë„“ê²Œ */
        }

        .mp-result-player {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            border-radius: 12px; /* ğŸ†• 15px â†’ 12px ì¶•ì†Œ */
            padding: 12px; /* ğŸ†• 20px â†’ 12px ì¶•ì†Œ */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .mp-result-player.rank-1 {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e, #ffeaa7);
            border: 3px solid #fd79a8;
            box-shadow: 0 6px 20px rgba(253, 121, 168, 0.4);
            grid-row: span 2; /* ğŸ†• 1ìœ„ëŠ” 2í–‰ ì°¨ì§€ (5ëª…ì¼ ë•Œ) */
        }

        .mp-result-player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px; /* ğŸ†• 15px â†’ 8px ì¶•ì†Œ */
        }

        .mp-result-player-name {
            font-size: 1.1em; /* ğŸ†• 1.3em â†’ 1.1em ì¶•ì†Œ */
            font-weight: bold;
            color: #2d3436;
        }

        .mp-result-player-score {
            font-size: 1.3em; /* ğŸ†• 1.5em â†’ 1.3em ì¶•ì†Œ */
            font-weight: bold;
            color: #2d3436;
        }

        .mp-result-player-stats {
            font-size: 0.85em; /* ğŸ†• 1em â†’ 0.85em ì¶•ì†Œ */
            color: #636e72;
            margin-bottom: 6px; /* ğŸ†• 10px â†’ 6px ì¶•ì†Œ */
        }

        .mp-result-player-words {
            font-size: 0.8em; /* ğŸ†• 0.9em â†’ 0.8em ì¶•ì†Œ */
            color: #2d3436;
            line-height: 1.4;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap; /* ğŸ†• í•œ ì¤„ë¡œ í‘œì‹œ */
        }
        
        /* ğŸ†• ëª¨ë°”ì¼ ë°˜ì‘í˜•: 4-5ëª…ì¼ ë•Œë„ 1ì—´ë¡œ í‘œì‹œ */
        @media (max-width: 768px) {
            .mp-result-players-grid.two-column,
            .mp-result-players-grid.hybrid {
                grid-template-columns: 1fr !important;
            }
            
            .mp-result-player.rank-1 {
                grid-row: span 1 !important;
            }
            
            .mp-result-content {
                max-width: 95% !important;
                padding: 15px !important;
            }
            
            .mp-result-banner img {
                width: 300px !important;
                max-width: 300px !important;
                height: 200px !important;
                object-fit: contain !important; /* ğŸ†• cover â†’ containìœ¼ë¡œ ë³€ê²½ (ì˜ë¦¼ ë°©ì§€) */
                background: #f8f9fa !important; /* ğŸ†• ë°°ê²½ìƒ‰ ì¶”ê°€ */
            }
        }

        .mp-result-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px; /* ğŸ†• 25px â†’ 15px ì¶•ì†Œ */
        }
        
        .mp-waiting-message {
            padding: 15px;
            background: #fffacd;
            border: 2px solid #ffeaa7;
            border-radius: 15px;
            color: #636e72;
            font-size: 1em;
            font-weight: bold;
            text-align: center;
            line-height: 1.5;
        }

        .mp-result-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mp-result-btn.replay {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
        }

        .mp-result-btn.home {
            background: #dfe6e9;
            color: #2d3436;
        }

        .mp-result-btn:hover {
            transform: scale(1.05);
        }

        .mp-result-btn:active {
            transform: scale(0.95);
        }
        
        /* ëª¨ë‹¬ ì±„íŒ… ì…ë ¥ì°½ */
        .mp-result-chat {
            margin-top: 12px; /* ğŸ†• 20px â†’ 12px ì¶•ì†Œ */
            border-top: 2px solid rgba(253, 121, 168, 0.2);
            padding-top: 12px; /* ğŸ†• 15px â†’ 12px ì¶•ì†Œ */
        }
        
        .mp-result-chat-input-box {
            display: flex;
            gap: 8px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #dfe6e9;
        }
        
        .mp-result-chat-input {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            background: #f8f9fa;
        }
        
        .mp-result-chat-input:focus {
            outline: none;
            background: white;
        }
        
        .mp-result-chat-send {
            padding: 12px 24px;
            background: #16213e;
            color: white;
            border: 1px solid #6a6a8a;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mp-result-chat-send:hover {
            background: #1f2a4a;
            transform: translateY(-2px);
        }
        

        /* ===== ëª¨ë°”ì¼ ë²„ì „ (ì™„ì „íˆ ë‹¤ë¥¸ ë””ìì¸) ===== */

        /* ì…ì¥ ìš”ì²­ íŒì—… */
        .join-request-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .popup-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 400px;
        }

        .popup-content h3 {
            margin-bottom: 15px;
            color: #2d3436;
        }

        .popup-content p {
            margin-bottom: 20px;
            color: #636e72;
            line-height: 1.5;
        }

        .popup-buttons {
            display: flex;
            gap: 10px;
        }

        .popup-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .popup-btn.yes {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
        }

        .popup-btn.no {
            background: #dfe6e9;
            color: #636e72;
        }

        .popup-btn:hover {
            transform: scale(1.05);
        }

        /* êµ¬ê²½ ëª¨ë“œ í™”ë©´ */
        .spectate-container {
            text-align: center;
            padding: 40px 20px;
        }

        .spectate-container h2 {
            margin-bottom: 20px;
            color: #2d3436;
        }

        .spectate-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
        }

        .spectate-score, .spectate-time {
            font-size: 1.2em;
            color: #636e72;
        }

        .spectate-score span, .spectate-time span {
            font-size: 1.5em;
            font-weight: bold;
            color: #fd79a8;
        }

        .spectate-consonants {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        /* ëŒ€ê¸°ì‹¤ í™”ë©´ */
        .lobby-container {
            text-align: center;
            padding: 40px 20px;
        }

        .lobby-container h2 {
            margin-bottom: 30px;
            color: #2d3436;
        }

        .player-list {
            max-width: 400px;
            margin: 0 auto 30px;
        }

        .player-item {
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #dfe6e9;
            font-size: 1.1em;
        }

        .player-item.me {
            background: #ffeaa7;
            border-color: #fdcb6e;
            font-weight: bold;
        }

        .start-game-btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-game-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(253, 121, 168, 0.3);
        }

        /* ì•Œë¦¼ í† ìŠ¤íŠ¸ */
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fd79a8;
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ê¸°ë‹¤ë¦¬ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #acceptingBtn {
            transition: all 0.3s ease;
        }
        @media (max-width: 768px) {
            body {
                padding: 0;
                overflow: hidden;
                position: fixed;
                width: 100%;
                height: 100%;
            }

            .header {
                display: none;
            }

            .container {
                border-radius: 0;
                padding: 0;
                max-width: 100%;
                height: 100vh;
                height: 100dvh;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                position: relative;
                z-index: 1;
                background: rgba(255, 255, 255, 0.95);
            }

            .game-start-section {
                flex: 1;
                overflow-y: auto;
                padding: 30px 20px;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

            .start-title {
                font-size: 2.5em;
            }

            .start-instruction {
                font-size: 1.1em;
                margin-bottom: 25px;
            }

            .score-guide {
                padding: 15px;
                margin-bottom: 20px;
            }

            .score-guide-compact {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                margin-bottom: 10px;
            }

            .score-item {
                font-size: 1em;
                margin: 5px 0;
            }

            .special-score {
                font-size: 0.9em;
                margin-top: 8px;
            }

            .special-score-detail {
                font-size: 0.8em;
            }

            .game-start-btn {
                padding: 15px 40px;
                font-size: 1.3em;
                margin-top: 10px;
            }

            /* ê²Œì„ í™”ë©´ - ëª¨ë°”ì¼ */
            #gameScreen {
                display: flex;
                flex-direction: column;
                height: 100%;
                overflow: hidden;
                border: 3px solid transparent;
                transition: border-color 0.3s ease;
            }
            
            /* í„´ì œ ëª¨ë“œ: ìì‹ ì˜ í„´ì¼ ë•Œ ë‹¨ì–´ ì…ë ¥ì°½ í…Œë‘ë¦¬ ê¹œë¹¡ì„ */
            .word-input.my-turn {
                border: 3px solid #fd79a8;
                animation: turnInputPulse 1.5s ease-in-out infinite;
            }
            
            @keyframes turnInputPulse {
                0%, 100% {
                    border-color: #fd79a8;
                    box-shadow: 0 0 0 0 rgba(253, 121, 168, 0.7);
                }
                50% {
                    border-color: #e84393;
                    box-shadow: 0 0 15px 3px rgba(253, 121, 168, 0.8);
                }
            }

            /* 1ì¤„: ì ìˆ˜/ì‹œê°„/ìµœê³  + ìƒˆê²Œì„ */
            .game-info {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 3px;
                padding: 6px 8px;
                margin: 0;
                background: white;
                border-bottom: 1px solid #f0f0f0;
                flex-shrink: 0;
            }

            .info-box {
                background: #ffeaa7;
                padding: 6px 8px;
                border-radius: 8px;
                flex: 1;
                text-align: center;
                box-shadow: 0 1px 3px rgba(253, 203, 110, 0.3);
            }

            .info-box div:first-child {
                font-size: 0.55em;
                color: #636e72;
                margin-bottom: 2px;
            }

            .info-box div:last-child {
                font-size: 0.9em;
                font-weight: bold;
                color: #2d3436;
            }

            .reset-btn {
                padding: 6px 10px;
                font-size: 0.9em;
                border-radius: 8px;
                min-width: 60px;
            }

            .settings-btn {
                padding: 6px 10px;
                font-size: 1.2em;
                margin: 0;
                border-radius: 8px;
                min-width: 40px;
                background: #f5f5f5;
                border: 2px solid #dfe6e9;
                color: #636e72;
                cursor: pointer;
            }

            /* 2ì¤„: ì•ˆë‚´ ë¬¸êµ¬ ìˆ¨ê¹€ */
            .fixed-guide {
                display: none;
            }

            /* 3ì¤„: ì´ˆì„± */
            .consonants {
                display: flex;
                justify-content: center;
                gap: 3px;
                margin: 0;
                padding: 10px 8px;
                background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
                border-radius: 0;
                flex-shrink: 0;
            }

            .consonant {
                font-size: 1.5em;
                padding: 6px 10px;
                min-width: 36px;
                border: 2px solid #f5f5f5;
            }

            /* 4ì¤„: ì´ëª¨í‹°ì½˜ ìˆ¨ê¹€ (í† ìŠ¤íŠ¸ë¡œ ëŒ€ì²´) */
            .emoji-display {
                display: none;
            }

            /* 5ì¤„: ëœ» - 2ì¤„ ê³ ì •ìœ¼ë¡œ ìˆ˜ì • */
            .definition-container {
                background: #f8f9fa;
                padding: 6px 8px;
                border-radius: 0;
                margin: 0;
                height: 40px;
                min-height: 40px;
                max-height: 40px;
                flex-shrink: 0;
                position: relative;
                display: flex;
                align-items: center;
                justify-content: center;
                overflow: hidden;
            }

            .definition-text {
                font-size: 0.9em;
                color: #2d3436;
                line-height: 1.3;
                text-align: center;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
                text-overflow: ellipsis;
                max-height: 2.6em;
                width: 100%;
            }

            /* 6ì¤„: ì…ë ¥ì°½ - í°ë°°ê²½ ë…¸ë€í…Œë‘ë¦¬ */
            .input-section {
                display: flex;
                gap: 8px;
                padding: 10px 12px;
                margin: 0;
                background: white;
                border-top: 1px solid #f0f0f0;
                flex-shrink: 0;
            }

            .word-input {
                flex: 1;
                padding: 10px 12px;
                font-size: 1.1em;
                border: 3px solid #fdcb6e;
                border-radius: 12px;
                background: white;
                color: #2d3436;
                text-align: center;
                font-weight: bold;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
            }

            .word-input::placeholder {
                color: #b2bec3;
            }

            .word-input:focus {
                border-color: #fd79a8;
            }
            
            /* í„´ì œ ëª¨ë“œ: ìì‹ ì˜ í„´ì¼ ë•Œ ë‹¨ì–´ ì…ë ¥ì°½ í…Œë‘ë¦¬ ê¹œë¹¡ì„ */
            .word-input.my-turn {
                border: 3px solid #fd79a8;
                animation: turnInputPulse 1.5s ease-in-out infinite;
            }
            
            @keyframes turnInputPulse {
                0%, 100% {
                    border-color: #fd79a8;
                    box-shadow: 0 0 0 0 rgba(253, 121, 168, 0.7);
                }
                50% {
                    border-color: #e84393;
                    box-shadow: 0 0 15px 3px rgba(253, 121, 168, 0.8);
                }
            }

            .submit-btn {
                padding: 10px 20px;
                font-size: 1em;
                border-radius: 12px;
            }

            /* ë‚˜ë¨¸ì§€ ê³µê°„ - ì—¬ë°± ì—†ì´ */
            .game-content {
                flex: 1;
                min-height: 0;
                overflow: hidden;
            }

            /* ë³„ë˜¥ë³„ ë°°ê²½ ì»¨í…Œì´ë„ˆ - ëª¨ë°”ì¼ ì „ìš© */
            .falling-bg {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 35vh;
                background: linear-gradient(to bottom, rgba(255, 255, 255, 0.95), rgba(255, 234, 167, 0.95));
                z-index: 1;
                pointer-events: none;
                overflow: hidden;
            }

            /* ë³„ë˜¥ë³„ ì´ˆì„± */
            .consonant-star {
                position: absolute;
                font-size: 24px;
                font-weight: bold;
                color: rgba(93, 64, 55, 0.25);
                animation: fall linear infinite;
                opacity: 0;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                pointer-events: none;
            }

            .consonant-star.special { 
                color: rgba(233, 30, 99, 0.3); 
            }

            @keyframes fall {
                0% {
                    transform: translateY(-50px) rotate(0deg) scale(0.8);
                    opacity: 0;
                }
                10% {
                    opacity: 0.5;
                    transform: translateY(0) rotate(180deg) scale(1);
                }
                90% {
                    opacity: 0.3;
                }
                100% {
                    transform: translateY(35vh) rotate(360deg) scale(0.6);
                    opacity: 0;
                }
            }


            /* ì„¤ì • ëª¨ë‹¬ */
            .settings-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .settings-content {
                background: white;
                border-radius: 20px;
                padding: 25px;
                width: 80%;
                max-width: 300px;
            }

            .settings-title {
                font-size: 1.3em;
                font-weight: bold;
                margin-bottom: 20px;
                text-align: center;
                color: #2d3436;
            }

            .settings-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 0;
                border-bottom: 1px solid #f0f0f0;
            }

            .settings-item:last-of-type {
                border-bottom: none;
            }

            .settings-label {
                font-size: 1em;
                color: #2d3436;
            }

            .settings-toggle {
                padding: 6px 15px;
                border-radius: 12px;
                border: 2px solid #dfe6e9;
                background: #f5f5f5;
                color: #636e72;
                font-size: 0.9em;
                font-weight: bold;
                cursor: pointer;
            }

            .settings-toggle.active {
                background: #ffeaa7;
                border-color: #fdcb6e;
                color: #2d3436;
            }

            .settings-newgame-btn {
                width: 100%;
                padding: 12px;
                margin-top: 10px;
                background: #ff7675;
                color: white;
                border: none;
                border-radius: 12px;
                font-size: 1em;
                font-weight: bold;
                cursor: pointer;
            }

            .settings-close-btn {
                width: 100%;
                padding: 12px;
                margin-top: 10px;
                background: linear-gradient(135deg, #fd79a8, #fdcb6e);
                color: white;
                border: none;
                border-radius: 12px;
                font-size: 1em;
                font-weight: bold;
                cursor: pointer;
            }

            /* ê²Œì„ ì¢…ë£Œ í™”ë©´ì—ì„œë§Œ ìŠ¤í¬ë¡¤ í—ˆìš© */
            .game-end-overlay {
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .game-end-content {
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
        }
        /* ===== ë©€í‹°í”Œë ˆì´ì–´ CSS (PC ì „ìš©) ===== */
        .multiplayer-section {
            margin: 20px 0;
        }

        .mode-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px;
            font-size: 1.1em;
            font-weight: bold;
            font-family: 'Do Hyeon', sans-serif;
            border: 3px solid #dfe6e9;
            border-radius: 15px;
            background: white;
            color: #636e72;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn:hover {
            border-color: #fd79a8;
            transform: scale(1.02);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            border-color: #fd79a8;
        }

        .multiplayer-dropdown {
            margin: 15px 0;
        }

        .dropdown-btn {
            width: 100%;
            padding: 12px;
            font-size: 1em;
            font-weight: bold;
            background: #f8f9fa;
            border: 2px solid #dfe6e9;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dropdown-btn:hover {
            background: #ffeaa7;
            border-color: #fdcb6e;
        }

        .dropdown-content {
            margin-top: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #dfe6e9;
        }

        .dropdown-content.hidden {
            display: none;
        }

        .mp-btn {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            font-size: 1em;
            font-weight: bold;
            background: white;
            border: 2px solid #dfe6e9;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mp-btn:hover {
            background: #ffeaa7;
            border-color: #fdcb6e;
            transform: translateX(5px);
        }

        /* ë°© ëª©ë¡ ëª¨ë‹¬ */
        .room-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .room-modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .room-modal-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            color: #2d3436;
        }

        .room-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            border: 2px solid #dfe6e9;
        }

        .room-code {
            font-size: 1.5em;
            font-weight: bold;
            color: #fd79a8;
            margin-bottom: 10px;
        }

        .room-players {
            font-size: 0.9em;
            color: #636e72;
            margin: 5px 0;
        }

        .room-join-btn {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
        }

        .room-create-btn {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .room-create-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(9, 132, 227, 0.4);
        }

        .room-close-btn {
            width: 100%;
            padding: 12px;
            margin-top: 20px;
            background: #636e72;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
        }

        /* ëŒ€ê¸°ë°© í™”ë©´ */
        .waiting-room {
            text-align: center;
            padding: 20px;
        }

        .waiting-room-code {
            font-size: 2em;
            font-weight: bold;
            color: #fd79a8;
            margin: 20px 0;
        }

        .copy-code-btn {
            padding: 10px 20px;
            background: #ffeaa7;
            border: 2px solid #fdcb6e;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
        }

        .player-list {
            margin: 20px 0;
            text-align: left;
        }

        .player-slot {
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #dfe6e9;
        }

        .player-slot.empty {
            opacity: 0.5;
            border-style: dashed;
        }

        /* ë©€í‹°í”Œë ˆì´ì–´ ê²Œì„ í™”ë©´ (2x2 ê·¸ë¦¬ë“œ) */
        .mp-game-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            height: 100%;
        }

        .mp-player-screen {
            background: white;
            border-radius: 15px;
            padding: 15px;
            border: 3px solid #dfe6e9;
            display: flex;
            flex-direction: column;
        }

        .mp-player-screen.me {
            border-color: #fd79a8;
            box-shadow: 0 0 20px rgba(253, 121, 168, 0.3);
        }

        .mp-player-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .mp-player-name {
            font-weight: bold;
            color: #2d3436;
        }

        .mp-player-score {
            font-weight: bold;
            color: #fd79a8;
        }

        .mp-consonants-mini {
            display: flex;
            gap: 3px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 10px 0;
        }

        .mp-consonant-mini {
            font-size: 0.9em;
            padding: 4px 8px;
            background: #ffeaa7;
            border-radius: 8px;
            font-weight: bold;
        }

        .mp-last-word {
            text-align: center;
            font-size: 1.2em;
            color: #636e72;
            margin: 10px 0;
        }

        /* ëª¨ë°”ì¼ì—ì„œëŠ” ë©€í‹°í”Œë ˆì´ì–´ ìˆ¨ê¹€ */
        @media (max-width: 768px) {
            .multiplayer-section {
                display: none !important;
            }
            
            .mode-start-btn.together {
                display: none !important;
            }
        }

        /* ===== ë©€í‹°í”Œë ˆì´ì–´ ìŠ¬ë¡¯ ë ˆì´ì•„ì›ƒ ===== */
        .mp-slots-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 10;
        }

        .mp-player-slot {
            position: absolute;
            width: 220px;
            min-height: 180px;
            padding: 15px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            pointer-events: auto;
        }

        /* ìŠ¬ë¡¯ ìœ„ì¹˜ */
        .mp-player-slot.slot-1 {
            top: 80px;
            left: 20px;
        }

        .mp-player-slot.slot-2 {
            top: 80px;
            right: 20px;
        }

        .mp-player-slot.slot-3 {
            bottom: 20px;
            left: 20px;
        }

        .mp-player-slot.slot-4 {
            bottom: 20px;
            right: 20px;
        }

        .mp-player-slot.empty {
            opacity: 0.3;
            background: #f8f9fa;
        }

        .mp-slot-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ffeaa7;
        }

        .mp-slot-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #2d3436;
        }

        .mp-slot-chat {
            max-height: 60px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .mp-chat-message {
            font-size: 0.9em;
            color: #636e72;
            margin: 3px 0;
            padding: 5px 8px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .mp-slot-score {
            font-size: 1.3em;
            font-weight: bold;
            color: #fd79a8;
            margin-bottom: 5px;
        }

        .mp-score-popup {
            font-size: 1.5em;
            font-weight: bold;
            animation: scorePopup 0.8s ease-out;
        }

        .mp-score-popup.positive {
            color: #00b894;
        }

        @keyframes scorePopup {
            0% {
                transform: scale(0) translateY(0);
                opacity: 1;
            }
            50% {
                transform: scale(1.5) translateY(-10px);
                opacity: 1;
            }
            100% {
                transform: scale(1) translateY(-20px);
                opacity: 0;
            }
        }

        /* ëŒ€ê¸°ì‹¤ ì±„íŒ… (ê¸°ë³¸ - ì‹œê°„ì œ: ì¤‘ì•™ ì˜ì—­ì— ì–‡ì€ ì…ë ¥ì°½ë§Œ ì‚¬ìš©) */
        .mp-waiting-chat {
            margin-top: 12px;
            padding: 4px 0;
            background: transparent;
            border-radius: 0;
            max-width: 360px;
            margin-left: auto;
            margin-right: auto;
        }

        /* ì‹œê°„ì œ: ëŒ€ê¸°ì‹¤ ì±„íŒ… ë©”ì‹œì§€ëŠ” ìˆ¨ê¸°ê³ , ì…ë ¥ì°½ë§Œ ì‚¬ìš© (ë©”ì‹œì§€ëŠ” ì˜¤ë¥¸ìª½ ì±„íŒ… ì˜ì—­ì—ë§Œ í‘œì‹œ) */
        body:not(.turn-mode) #mpChatMessages {
            display: none;
        }

        body:not(.turn-mode) #mpChatInput {
            font-size: 0.85em;
            padding: 6px 10px;
            height: 32px;
        }
        
        /* í„´ì œ ëª¨ë“œ: ëŒ€ê¸°ì‹¤ ì±„íŒ… ìŠ¤íƒ€ì¼ (ë°°ê²½ë§Œ ë‹¤í¬í†¤ìœ¼ë¡œ ë³€ê²½) */
        body.turn-mode .mp-waiting-chat {
            background: transparent;
            border: none;
            border-radius: 0;
        }
        
        body.turn-mode .mp-chat-messages {
            color: #e0e0e0;
        }
        
        body.turn-mode .mp-chat-item {
            color: #e0e0e0;
        }
        
        body.turn-mode .mp-chat-name {
            color: #6bff6b;
        }
        
        body.turn-mode .mp-chat-input {
            background: #151520;
            border: 2px solid #6a6a8a;
            color: #ffffff;
        }
        
        body.turn-mode .mp-chat-input::placeholder {
            color: #6b6b8a;
        }

        .mp-chat-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #fdcb6e;
            border-radius: 10px;
            font-size: 1em;
            margin-bottom: 8px;
        }

        .mp-chat-messages {
            max-height: 100px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .mp-chat-item {
            font-size: 0.9em;
            margin: 5px 0;
            color: #2d3436;
        }

        .mp-chat-name {
            font-weight: bold;
            color: #fd79a8;
        }
    </style>
</head>
<body>
    <!-- ë©€í‹°í”Œë ˆì´ì–´ ìŠ¬ë¡¯ -->
    <div id="mpSlotsContainer" class="mp-slots-container hidden">
        <div id="mpSlot1" class="mp-player-slot slot-1 empty">
            <div class="mp-slot-header">
                <span class="mp-slot-name">í”Œë ˆì´ì–´1</span>
            </div>
            <div class="mp-slot-chat"></div>
            <div class="mp-slot-score">0ì </div>
            <div class="mp-score-popup-container"></div>
        </div>
        
        <div id="mpSlot2" class="mp-player-slot slot-2 empty">
            <div class="mp-slot-header">
                <span class="mp-slot-name">í”Œë ˆì´ì–´2</span>
            </div>
            <div class="mp-slot-chat"></div>
            <div class="mp-slot-score">0ì </div>
            <div class="mp-score-popup-container"></div>
        </div>
        
        <div id="mpSlot3" class="mp-player-slot slot-3 empty">
            <div class="mp-slot-header">
                <span class="mp-slot-name">í”Œë ˆì´ì–´3</span>
            </div>
            <div class="mp-slot-chat"></div>
            <div class="mp-slot-score">0ì </div>
            <div class="mp-score-popup-container"></div>
        </div>
        
        <div id="mpSlot4" class="mp-player-slot slot-4 empty">
            <div class="mp-slot-header">
                <span class="mp-slot-name">í”Œë ˆì´ì–´4</span>
            </div>
            <div class="mp-slot-chat"></div>
            <div class="mp-slot-score">0ì </div>
            <div class="mp-score-popup-container"></div>
        </div>
    </div>

    <div class="header">
        <div class="logo">
            ğŸ® ì´ˆì„±ì™•
        </div>
        <div class="audio-controls">
            <button id="bgmBtn" class="audio-btn active" onclick="toggleBGM()">ğŸµ BGM</button>
            <button id="sfxBtn" class="audio-btn active" onclick="toggleSFX()">ğŸ”Š íš¨ê³¼ìŒ</button>
            <button id="typingBtn" class="audio-btn active" onclick="toggleTyping()">âŒ¨ï¸ íƒ€ê±´ìŒ</button>
        </div>
    </div>


    <div class="container">
        <!-- ê²Œì„ ì‹œì‘ í™”ë©´ -->
        <div id="gameStartSection" class="game-start-section">
            <div class="start-crown">ğŸ‘‘</div>
            <div class="start-title">ì´ˆì„±ì™•</div>
            
            <div class="start-instruction">
                ê¸´ ë‹¨ì–´ì¼ìˆ˜ë¡ ëŒ€ë°•!<br>íŠ¹ë³„ì´ˆì„±ì€ ë³´ë„ˆìŠ¤!<br>ì¤€ë¹„ë˜ì…¨ìŠµë‹ˆê¹Œ?
            </div>

            <div class="score-guide" style="display: none;">
                    <div class="score-guide-compact">
                        <div class="score-item">2ê¸€ì: 10ì </div>
                        <div class="score-item">3ê¸€ì: 100ì </div>
                        <div class="score-item">4ê¸€ì: 400ì </div>
                        <div class="score-item">5ê¸€ì: 900ì </div>
                        <div class="special-score">âœ¨ íŠ¹ë³„ì´ˆì„±(ã„²ã„¸ã…ƒã…†ã…‰ã…Šã…‹ã…Œã…) ê° +20ì </div>
                        <div class="special-score-detail">ìƒˆ í”Œë ˆì´ì–´ ì…ì¥ ì‹œ ìë™ í•©ë¥˜</div>
                    </div>
            </div>

            <div class="best-score-display" id="bestScoreDisplay">
                ğŸ† ìµœê³  ê¸°ë¡: 0ì 
            </div>

            <!-- ê²Œì„ ëª¨ë“œ ì„ íƒ ë²„íŠ¼ -->
            <div class="game-mode-buttons" id="gameModeButtons">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
            
            <!-- ì´ë¦„ ë³€ê²½ ë²„íŠ¼ (ë°© ì…ì¥ ì „ì—ë§Œ í‘œì‹œ, ì‹œì‘ ë²„íŠ¼ ìœ„ ê°€ìš´ë°) -->
            <div class="change-name-container" id="changeNameContainer" style="display: none;">
                <button id="changeNameBtn" class="change-name-btn" onclick="changePlayerName()">
                    âœï¸
                </button>
                <div id="changeNameHint" class="change-name-hint" style="display: none;"></div>
            </div>

            <!-- ëŒ€ê¸°ì‹¤ ì±„íŒ… (ë©€í‹°í”Œë ˆì´ ì‹œì—ë§Œ í‘œì‹œ) -->
            <div id="mpWaitingChat" class="mp-waiting-chat hidden">
                <div class="mp-chat-messages" id="mpChatMessages">
                    <!-- ì±„íŒ… ë©”ì‹œì§€ -->
                </div>
                <input type="text" id="mpChatInput" class="mp-chat-input" placeholder="ì±„íŒ…ì„ ì…ë ¥í•˜ì„¸ìš”..." autocomplete="off" onkeypress="if(event.key==='Enter') { const input = document.getElementById('mpChatInput'); if(input && input.value.trim()) { sendChatMessageFromInput(input.value.trim()); input.value = ''; } }">
            </div>
        </div>

        <!-- ê²Œì„ í™”ë©´ -->
        <div id="gameScreen" class="hidden">
            <!-- ì‹œê°„ì œ ëª¨ë“œ: ê²Œì„ ì •ë³´ -->
            <div id="timeModeInfo" class="game-info">
                <div class="info-box">
                    <div>ì ìˆ˜</div>
                    <div id="score">0</div>
                </div>
                <div class="info-box">
                    <div>ë‚¨ì€ ì‹œê°„</div>
                    <div id="timer">180</div>
                </div>
                <div class="info-box">
                    <div>ìµœê³  ê¸°ë¡</div>
                    <div id="currentBestScore">0</div>
                </div>
                <button class="reset-btn" onclick="resetGame()">ğŸ”„ ìƒˆê²Œì„</button>
                <button id="mpLeaveBtn" class="reset-btn hidden" onclick="leaveGameRoom()" style="background: #ff7675;">ğŸšª ë‚˜ê°€ê¸°</button>
                <button class="settings-btn hidden" onclick="openSettings()">âš™ï¸</button>
            </div>
            
            <!-- í„´ì œ ëª¨ë“œ: 5ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸ -->
            <div id="turnModeTimer" class="turn-timer hidden">6</div>

            <!-- ì‹œê°„ì œ ëª¨ë“œ: ì•ˆë‚´ ë¬¸êµ¬ (PC only) -->
            <div id="timeModeGuide" class="fixed-guide">
                <div class="fixed-guide-text">ì œì‹œëœ ì´ˆì„±ìœ¼ë¡œ ìˆœì„œ ìƒê´€ì—†ì´ ë‹¨ì–´ë¥¼ ë§Œë“œì„¸ìš”!</div>
                <div class="fixed-guide-scores">2ê¸€ì 10ì  / 3ê¸€ì 100ì  / 4ê¸€ì 400ì  / 5ê¸€ì 900ì  / 6ê¸€ì 1500ì </div>
                <div class="fixed-guide-special">íŠ¹ë³„ì´ˆì„±(ã„²ã„¸ã…ƒã…†ã…‰ã…Šã…‹ã…Œã…) ê° +20ì </div>
            </div>
            
            <!-- í„´ì œ ëª¨ë“œ: ì„¤ëª… ë¬¸êµ¬ -->
            <div id="turnModeGuide" class="turn-mode-guide hidden">
                <div style="font-weight: bold; margin-bottom: 8px;">ì œì‹œëœ ì´ˆì„±ìœ¼ë¡œ ìˆœì„œ ìƒê´€ì—†ì´ ë‹¨ì–´ë¥¼ ë§Œë“œì„¸ìš”!</div>
                <div>íŠ¹ë³„ì´ˆì„± 2ê¸€ì <span class="special-bonus" style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">â¤ï¸</span> / 3ê¸€ì <span class="special-bonus" style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">â¤ï¸</span> / 4ê¸€ì <span class="special-bonus" style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">â¤ï¸â¤ï¸â¤ï¸</span> / 5ê¸€ì+ <span class="special-bonus" style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</span></div>
                <div style="margin-top: 6px; font-size: 0.9em;">íŠ¹ë³„ì´ˆì„±(ã„²ã„¸ã…ƒã…†ã…‰ã…Šã…‹ã…Œã…)</div>
                <div id="turnModeWaitMessage" style="margin-top: 10px; padding: 10px; background: #6b6b8a; border-radius: 8px; color: #e0e0e0; font-weight: bold; display: none;">ì°¸ê°€ìê°€ í•œëª…ì´ìƒ ë“¤ì–´ì™€ì•¼í•´ìš”!</div>
            </div>

            <!-- ì´ˆì„± -->
            <div class="consonants" id="consonants"></div>

            <!-- ì‹œê°„ì œ ëª¨ë“œ: ì´ëª¨í‹°ì½˜ (PC only) -->
            <div id="emojiDisplay" class="emoji-display" data-mode="time">
                <div>ğŸ¤”</div>
                <div class="emoji-text">ë‹¨ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
                <div class="emoji-score">+0ì </div>
            </div>

            <!-- ì‹œê°„ì œ ëª¨ë“œ: ëœ» -->
            <div id="timeModeDefinition" class="definition-container">
                <div class="definition-text" id="definitionText">ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ë©´ ëœ»ì´ í‘œì‹œë©ë‹ˆë‹¤</div>
            </div>
            
            <!-- í„´ì œ ëª¨ë“œ: ì‚¬ìš©ëœ ë‹¨ì–´ ì˜ì—­ -->
            <div id="turnModeUsedWords" class="used-words-turn hidden">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>

            <!-- ì…ë ¥ì°½ -->
            <div class="input-section">
                <input type="text" id="wordInput" class="word-input" placeholder="ë‹¨ì–´ ì…ë ¥" autocomplete="off">
                <button class="submit-btn" onclick="checkWord()">í™•ì¸</button>
            </div>

            <!-- ë‚˜ë¨¸ì§€ ê³µê°„ -->
            <div class="game-content"></div>
        </div>
    </div>

    <!-- ì„¤ì • ëª¨ë‹¬ (ëª¨ë°”ì¼ ì „ìš©) -->
    <div id="settingsModal" class="settings-modal hidden">
        <div class="settings-content">
            <div class="settings-title">âš™ï¸ ì„¤ì •</div>
            <div class="settings-item">
                <div class="settings-label">ğŸµ BGM</div>
                <button id="modalBgmBtn" class="settings-toggle active" onclick="toggleModalBGM()">ON</button>
            </div>
            <div class="settings-item">
                <div class="settings-label">ğŸ”Š íš¨ê³¼ìŒ</div>
                <button id="modalSfxBtn" class="settings-toggle active" onclick="toggleModalSFX()">ON</button>
            </div>
            <div class="settings-item">
                <div class="settings-label">âŒ¨ï¸ íƒ€ê±´ìŒ</div>
                <button id="modalTypingBtn" class="settings-toggle active" onclick="toggleModalTyping()">ON</button>
            </div>
            <button class="settings-newgame-btn" onclick="resetGameFromSettings()">ğŸ”„ ìƒˆê²Œì„</button>
            <button class="settings-close-btn" onclick="closeSettings()">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- ğŸ†• ë°© ì œëª© ì…ë ¥ ëª¨ë‹¬ -->
    <div id="mpRoomTitleModal" class="mp-modal-overlay hidden">
        <div class="mp-modal-content">
            <div class="mp-name-title">ğŸ·ï¸ ë°© ì œëª© ì…ë ¥</div>
            <div class="mp-name-hint" style="font-size: 0.9em; color: #636e72; margin-bottom: 15px;">
                ì œëª©ì„ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ ëœë¤ ì œëª©ì´ ì„¤ì •ë©ë‹ˆë‹¤
            </div>
            <input 
                type="text" 
                id="mpRoomTitleInput" 
                class="mp-name-input" 
                placeholder="ë°© ì œëª© ì…ë ¥ (ì„ íƒì‚¬í•­)"
                maxlength="20"
                onkeypress="if(event.key==='Enter') confirmRoomTitle()"
            />
            <div class="mp-name-buttons">
                <button class="mp-name-btn" onclick="confirmRoomTitle()">í™•ì¸</button>
                <button class="mp-name-btn secondary" onclick="cancelRoomTitle()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ë©€í‹°í”Œë ˆì´ ëŒ€ê¸°ë°© ëª©ë¡ ëª¨ë‹¬ (í•¨ê»˜í•˜ê¸° í´ë¦­ ì‹œ ë°”ë¡œ í‘œì‹œ) -->
    <div id="mpRoomModal" class="mp-modal-overlay hidden">
        <div class="mp-modal-content">
            <div class="mp-modal-title">ğŸ‘¥ ëŒ€ê¸°ë°© ëª©ë¡</div>
            <div id="mpRoomList" class="mp-room-list">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
            <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;">
                <button class="mp-create-solo-btn" onclick="createRoomWithMode('time')" style="width: 100%; padding: 15px; font-size: 1.1em;">
                    â° ì‹œê°„ì œ ë°© ë§Œë“¤ê¸°
                </button>
                <button class="mp-create-solo-btn" onclick="createRoomWithMode('turn')" style="width: 100%; padding: 15px; font-size: 1.1em; background: linear-gradient(135deg, #fd79a8, #e84393);">
                    ğŸ”„ í„´ì œ ë°© ë§Œë“¤ê¸°
                </button>
            </div>
            <button class="mp-close-btn" onclick="closeRoomModal()">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- ì´ë¦„ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="mpNameModal" class="mp-modal-overlay hidden">
        <div class="mp-name-modal">
            <div class="mp-name-title">âœï¸ ì´ë¦„ ë³€ê²½</div>
            <input type="text" id="mpNameInput" class="mp-name-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="8">
            <!-- ğŸš€ ë©”ì‹œì§€ ì˜ì—­ (ì…ë ¥ì°½ ì•„ë˜, ë²„íŠ¼ ìœ„) -->
            <div id="mpNameMessage" class="mp-name-message" style="display: none;"></div>
            <div class="mp-name-buttons">
                <button class="mp-name-confirm" onclick="confirmName()">í™•ì¸</button>
                <button class="mp-name-cancel" onclick="cancelName()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ë©€í‹°í”Œë ˆì´: ì¢Œì¸¡ ìŠ¬ë¡¯ -->
    <div id="playerSlotsLeft" class="player-slots-left hidden">
        <!-- ìŠ¬ë¡¯ 4ê°œ ë™ì  ìƒì„± -->
    </div>

    <!-- ë©€í‹°í”Œë ˆì´: ìš°ì¸¡ ì±„íŒ… -->
    <div id="chatContainer" class="chat-container hidden">
        <!-- ë°©ë²ˆí˜¸/ë°©ì œ í‘œì‹œ (ì‹œê°„ì œ/í„´ì œ ê³µí†µ) -->
        <div id="roomInfoInChat" class="turn-room-info hidden" style="margin-bottom: 10px;">
            <div class="turn-room-title"></div>
            <div class="turn-room-id"></div>
        </div>
        <!-- ê¸°ì¡´ ğŸ’¬ ì±„íŒ… ë¼ë²¨ì€ ë°©ì •ë³´ë¡œ ëŒ€ì²´ë˜ë¯€ë¡œ ìˆ¨ê¹€ -->
        <div class="chat-title" style="display: none;">ğŸ’¬ ì±„íŒ…</div>
        <div class="chat-hint">
            âš ï¸ ê²Œì„ ì¤‘ <strong>/</strong>ë¥¼ ëˆ„ë¥´ë©´<br>
            ì±„íŒ…ì´ ê°€ëŠ¥í•´ìš”
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- ì±„íŒ… ë©”ì‹œì§€ ë™ì  ìƒì„± -->
        </div>
        <!-- ğŸ†• í„´ì œ ëª¨ë“œ: íƒˆë½ì ë‚˜ê°€ê¸° ë²„íŠ¼ (ì±„íŒ… ì°½ ì•„ë˜) -->
        <button id="turnModeLeaveBtn" class="reset-btn hidden" onclick="leaveGameRoom()" style="display: none; width: 100%; margin-top: 10px; background: #ff7675;">ğŸšª ë‚˜ê°€ê¸°</button>
    </div>

    <audio id="tickSound" src="./sound/tick.mp3"></audio>

    <script>
        // API ê¸°ë³¸ URL
        const API_BASE = 'https://steep-moon-7816.sucksuck1114.workers.dev';
        
        // ê²Œì„ ìƒíƒœ
        const gameState = {
            score: 0,
            timeLeft: 180,
            usedWords: [],
            wordDefinitions: {},
            currentConsonants: [],
            originalConsonants: [],
            gameRunning: false,
            gameTimer: null,
            bgmEnabled: true,
            sfxEnabled: true,
            typingEnabled: true,
            tickSoundPlaying: false,
            bestScore: 0,
            roundCount: 0,
            shuffleCount: 0,
            isMobile: window.innerWidth <= 768
        };

        // ì´ˆì„± ëª©ë¡
        const CONSONANTS = ['ã„±', 'ã„´', 'ã„·', 'ã„¹', 'ã…', 'ã…‚', 'ã……', 'ã…‡', 'ã…ˆ', 'ã…'];
        const SPECIAL_CONSONANTS = ['ã„²', 'ã„¸', 'ã…ƒ', 'ã…†', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…'];

        function getRandomConsonants() {
            const count = 6; // 6ê°œë¡œ ê³ ì •
            const specialCount = Math.random() < 0.5 ? 1 : 2; // 1ê°œ ë˜ëŠ” 2ê°œ
            const consonants = [];

            // íŠ¹ë³„ ì´ˆì„± ì¶”ê°€ (ì¤‘ë³µ ì—†ìŒ)
            const usedSpecials = [];
            for (let i = 0; i < specialCount; i++) {
                let special;
                do {
                    special = SPECIAL_CONSONANTS[Math.floor(Math.random() * SPECIAL_CONSONANTS.length)];
                } while (usedSpecials.includes(special));
                usedSpecials.push(special);
                consonants.push({ char: special, isSpecial: true });
            }

            // ì¼ë°˜ ì´ˆì„± ì¶”ê°€
            const normalCount = count - specialCount;
            const normalConsonants = [];
            
            // ì¤‘ë³µ ì—¬ë¶€ ê²°ì • (33% í™•ë¥ ë¡œ ì¤‘ë³µ, 67% í™•ë¥ ë¡œ ì¤‘ë³µ ì—†ìŒ)
            const shouldDuplicate = Math.random() < 0.33 && normalCount >= 2;
            
            if (shouldDuplicate) {
                // ì¤‘ë³µí•  ë¬¸ì ì„ íƒ
                const duplicateChar = CONSONANTS[Math.floor(Math.random() * CONSONANTS.length)];
                normalConsonants.push(duplicateChar, duplicateChar);
                
                // ë‚˜ë¨¸ì§€ ì¼ë°˜ ì´ˆì„± ì¶”ê°€ (ì¤‘ë³µ ì—†ìŒ)
                const remainingCount = normalCount - 2;
                for (let i = 0; i < remainingCount; i++) {
                    let normal;
                    do {
                        normal = CONSONANTS[Math.floor(Math.random() * CONSONANTS.length)];
                    } while (normal === duplicateChar || normalConsonants.includes(normal));
                    normalConsonants.push(normal);
                }
            } else {
                // ì¤‘ë³µ ì—†ì´ ì¼ë°˜ ì´ˆì„± ì¶”ê°€
                for (let i = 0; i < normalCount; i++) {
                    let normal;
                    do {
                        normal = CONSONANTS[Math.floor(Math.random() * CONSONANTS.length)];
                    } while (normalConsonants.includes(normal));
                    normalConsonants.push(normal);
                }
            }

            // ì¼ë°˜ ì´ˆì„±ì„ consonants ë°°ì—´ì— ì¶”ê°€
            normalConsonants.forEach(normal => {
                consonants.push({ char: normal, isSpecial: false });
            });

            return consonants.sort(() => Math.random() - 0.5);
        }

        function hasEnoughConsonants(wordChosung, currentChars) {
            const availableChars = [...currentChars];
            for (const ch of wordChosung) {
                const index = availableChars.indexOf(ch);
                if (index === -1) return false;
                availableChars.splice(index, 1);
            }
            return true;
        }

        function displayConsonants(consonants) {
            const container = document.getElementById('consonants');
            container.innerHTML = consonants.map(c => 
                `<div class="consonant ${c.isSpecial ? 'special' : ''}">${c.char}</div>`
            ).join('');
        }

        function shuffleConsonants(type) {
            const container = document.getElementById('consonants');
            if (type === 'reverse') {
                gameState.currentConsonants.reverse();
            } else {
                gameState.currentConsonants = [...gameState.currentConsonants].sort(() => Math.random() - 0.5);
            }
            container.classList.add('shuffling');
            displayConsonants(gameState.currentConsonants);
            setTimeout(() => container.classList.remove('shuffling'), 600);
            // shuffleCountëŠ” íƒ€ì´ë¨¸ì—ì„œ ê´€ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì¦ê°€ì‹œí‚¤ì§€ ì•ŠìŒ
        }

        function getChosung(str) {
            const chosungList = ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
            const result = [];
            for (let i = 0; i < str.length; i++) {
                const code = str.charCodeAt(i) - 44032;
                if (code > -1 && code < 11172) {
                    result.push(chosungList[Math.floor(code / 588)]);
                }
            }
            return result;
        }

        function calculateScore(word, inputChosung) {
            let baseScore = 0;
            if (word.length === 2) baseScore = 10;
            else if (word.length === 3) baseScore = 100;
            else if (word.length === 4) baseScore = 400;
            else if (word.length === 5) baseScore = 900;
            else if (word.length >= 6) baseScore = 1500;
            
            let bonusScore = 0;
            inputChosung.forEach(ch => {
                const found = gameState.currentConsonants.find(c => c.char === ch);
                if (found && found.isSpecial) bonusScore += 20;
            });

            return { base: baseScore, bonus: bonusScore, total: baseScore + bonusScore };
        }

        function updateEmoji(emoji, message, score) {
            if (gameState.isMobile) return; // ëª¨ë°”ì¼ì—ì„œëŠ” ì´ëª¨í‹°ì½˜ í‘œì‹œ ì•ˆí•¨
            
            const emojiDisplay = document.getElementById('emojiDisplay');
            if (!emojiDisplay) return; // ìš”ì†Œê°€ ì—†ìœ¼ë©´ (í„´ëª¨ë“œ ë“±) ë¦¬í„´
            
            emojiDisplay.innerHTML = `
                <div>${emoji}</div>
                <div class="emoji-text">${message}</div>
                <div class="emoji-score">+${score}ì </div>
            `;
            
            // ëª¨ë“  ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ì œê±°
            emojiDisplay.classList.remove('emoji-score-10', 'emoji-score-30', 'emoji-score-50', 
                                        'emoji-score-100', 'emoji-score-400', 'emoji-score-500');
            
            // ì ìˆ˜ë³„ ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ì¶”ê°€
            if (score >= 500) {
                emojiDisplay.classList.add('emoji-score-500');
            } else if (score >= 400) {
                emojiDisplay.classList.add('emoji-score-400');
            } else if (score >= 100) {
                emojiDisplay.classList.add('emoji-score-100');
            } else if (score >= 50) {
                emojiDisplay.classList.add('emoji-score-50');
            } else if (score >= 30) {
                emojiDisplay.classList.add('emoji-score-30');
            } else {
                emojiDisplay.classList.add('emoji-score-10');
            }
        }

        function updateDefinition(definition) {
            document.getElementById('definitionText').textContent = definition;
        }

        function showToast(emoji, message, score) {
            // ğŸ†• PC ì²´í¬ ê°•í™”: isPC() í•¨ìˆ˜ì™€ gameState.isMobile ëª¨ë‘ ì²´í¬
            if (!gameState.isMobile || isPC()) return; // PCì—ì„œëŠ” ì ˆëŒ€ í† ìŠ¤íŠ¸ ì•ˆë„ì›€
            // ğŸ†• í„´ì œ ëª¨ë“œì—ì„œëŠ” showTurnModeToast ì‚¬ìš© (PCì—ì„œë„ í‘œì‹œë˜ì–´ì•¼ í•¨)
            if (document.body.classList.contains('turn-mode')) {
                showTurnModeToast(emoji, message);
                return;
            }
            
            // ì´ì „ í† ìŠ¤íŠ¸ ì œê±°
            const oldToast = document.querySelector('.toast-message');
            if (oldToast) oldToast.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast-message';
            toast.innerHTML = `<div class="toast-text">${emoji} ${message}</div><div class="toast-score">+${score}ì </div>`;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 800);
        }
        
        // ğŸ†• í„´ì œ ëª¨ë“œìš© í† ìŠ¤íŠ¸ í•¨ìˆ˜ (PCì—ì„œë„ í‘œì‹œ)
        function showTurnModeToast(emoji, message) {
            // ì´ì „ í† ìŠ¤íŠ¸ ì œê±°
            const oldToast = document.querySelector('.toast-message');
            if (oldToast) oldToast.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast-message';
            // ğŸ†• ìƒëª…ê¶Œ íšë“ ì‹œ í•˜íŠ¸ ìƒ‰ìƒì„ #6bff6bë¡œ ë³€ê²½
            let displayEmoji = emoji;
            if (emoji === 'â¤ï¸' && document.body.classList.contains('turn-mode')) {
                displayEmoji = `<span style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">${emoji}</span>`;
            }
            toast.innerHTML = `<div class="toast-text">${displayEmoji} ${message}</div>`;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 2000);
        }

        // ë³„ë˜¥ë³„ ì´ˆì„± ë°°ê²½ ìƒì„± í•¨ìˆ˜
        function createFallingConsonants() {
            // ê¸°ì¡´ ì»¨í…Œì´ë„ˆì™€ ë³„ë˜¥ë³„ ì œê±°
            const oldContainer = document.querySelector('.falling-bg');
            if (oldContainer) oldContainer.remove();
            
            // ëª¨ë°”ì¼ì—ì„œë§Œ ìƒì„±
            if (!gameState.isMobile) return;
            
            // ë³„ë˜¥ë³„ ë°°ê²½ ì»¨í…Œì´ë„ˆ ìƒì„±
            const container = document.createElement('div');
            container.className = 'falling-bg';
            document.body.appendChild(container);
            
            const consonants = ['ã„±', 'ã„´', 'ã„·', 'ã„¹', 'ã…', 'ã…‚', 'ã……', 'ã…‡', 'ã…ˆ', 'ã…'];
            const specialConsonants = ['ã„²', 'ã„¸', 'ã…ƒ', 'ã…†', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…'];
            
            // ì¼ë°˜ ì´ˆì„± 12ê°œ
            for (let i = 0; i < 12; i++) {
                const star = document.createElement('div');
                star.className = 'consonant-star';
                star.textContent = consonants[Math.floor(Math.random() * consonants.length)];
                star.style.left = Math.random() * 100 + '%';
                star.style.animationDuration = (8 + Math.random() * 10) + 's';
                star.style.animationDelay = (Math.random() * 8) + 's';
                container.appendChild(star);
            }
            
            // íŠ¹ìˆ˜ ì´ˆì„± 4ê°œ
            for (let i = 0; i < 4; i++) {
                const star = document.createElement('div');
                star.className = 'consonant-star special';
                star.textContent = specialConsonants[Math.floor(Math.random() * specialConsonants.length)];
                star.style.left = Math.random() * 100 + '%';
                star.style.animationDuration = (10 + Math.random() * 8) + 's';
                star.style.animationDelay = (Math.random() * 6) + 's';
                container.appendChild(star);
            }
        }

        // ğŸ†• íŠ¹ë³„ì´ˆì„± ì²´í¬ í•¨ìˆ˜
        function hasSpecialConsonant(word, currentChars) {
            const SPECIAL_CONSONANTS = ['ã„²', 'ã„¸', 'ã…ƒ', 'ã…†', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…'];
            const wordChosung = getChosung(word);
            return wordChosung.some(ch => SPECIAL_CONSONANTS.includes(ch)) && 
                   currentChars.some(ch => SPECIAL_CONSONANTS.includes(ch));
        }

        async function checkWord() {
            const input = document.getElementById('wordInput');
            let word = input.value.trim();
            if (!word) return;

            // ğŸ†• í„´ì œ ëª¨ë“œì—ì„œ ì±„íŒ… ì²˜ë¦¬
            if (multiplayerState.isMultiplayer && gameState.gameRunning && multiplayerState.gameMode === 'turn') {
                const lastRoomData = multiplayerState.lastRoomData;
                if (lastRoomData) {
                    const isEliminated = lastRoomData.eliminatedPlayers?.includes(multiplayerState.playerId) || false;
                    const isMyTurn = lastRoomData.currentTurnPlayerId === multiplayerState.playerId;
                    
                    // 1. íƒˆë½ìëŠ” ëª¨ë“  ì…ë ¥ì„ ì±„íŒ…ìœ¼ë¡œ ì²˜ë¦¬ ("/" ì—†ì´ë„ ê°€ëŠ¥)
                    if (isEliminated) {
                        if (word.trim()) {
                            await sendChatMessageFromInput(word.trim());
                        }
                        input.value = '';
                        return;
                    }
                    
                    // 2. ìì‹ ì˜ í„´ì´ ì•„ë‹ ë•Œ: "/" ì—†ì´ ì…ë ¥í•˜ë©´ ë¬´ì‹œ, "/"ë¡œ ì‹œì‘í•˜ë©´ ì±„íŒ…
                    if (!isMyTurn) {
                        if (word.startsWith('/')) {
                            const chatMessage = word.substring(1).trim();
                            if (chatMessage) {
                                await sendChatMessageFromInput(chatMessage);
                            }
                            input.value = '';
                            return;
                        } else {
                            // "/" ì—†ì´ ì…ë ¥í•˜ë©´ ë¬´ì‹œ (ì •ë‹µìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ)
                            input.value = '';
                            return;
                        }
                    }
                }
            }
            
            // ğŸ†• ê¸°ì¡´: "/" ë¡œ ì‹œì‘í•˜ë©´ ì±„íŒ… ë©”ì‹œì§€ (ì‹œê°„ì œ ëª¨ë“œ ë˜ëŠ” í„´ì œì—ì„œ ìì‹ ì˜ í„´ì¼ ë•Œ)
            if (multiplayerState.isMultiplayer && word.startsWith('/')) {
                const chatMessage = word.substring(1).trim(); // "/" ì œê±°, ë„ì–´ì“°ê¸°ëŠ” ìœ ì§€
                if (chatMessage) {
                    // ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ (ì„œë²„ë¡œ)
                    await sendChatMessageFromInput(chatMessage);
                }
                input.value = '';
                return;
            }

            // ì ìˆ˜ ê³„ì‚°ìš©: ëª¨ë“  ë„ì–´ì“°ê¸° ì œê±° (ì¤‘ê°„ ë„ì–´ì“°ê¸°ë„ ì œê±°)
            const wordForGame = word.replace(/\s+/g, '');
            if (!wordForGame) {
                input.value = '';
                return;
            }

            const wordChosung = getChosung(wordForGame);
            const currentChars = gameState.currentConsonants.map(c => c.char);

            // ë„ì–´ì“°ê¸° ì œê±° í›„ ê¸¸ì´ ì²´í¬
            if (wordForGame.length < 2 || wordForGame.length > 6) {
                // ğŸ†• PCì—ì„œëŠ” í•­ìƒ updateEmoji ì‚¬ìš©, ëª¨ë°”ì¼ì—ì„œë§Œ showToast ì‚¬ìš©
                if (gameState.isMobile && !isPC()) {
                    showToast('ğŸ˜“', '2~6ê¸€ìë§Œ ê°€ëŠ¥í•´ìš”', 0);
                } else {
                    updateEmoji('ğŸ˜“', '2~6ê¸€ìë§Œ ê°€ëŠ¥í•´ìš”', 0);
                }
                playWrongSound();
                input.value = '';
                return;
            }

            const isValid = hasEnoughConsonants(wordChosung, currentChars);
            if (!isValid) {
                // ğŸ†• PCì—ì„œëŠ” í•­ìƒ updateEmoji ì‚¬ìš©, ëª¨ë°”ì¼ì—ì„œë§Œ showToast ì‚¬ìš©
                if (gameState.isMobile && !isPC()) {
                    showToast('ğŸ˜“', 'ì´ˆì„±ì„ í™•ì¸í•´ì£¼ì„¸ìš”', 0);
                } else {
                    updateEmoji('ğŸ˜“', 'ì´ˆì„±ì„ í™•ì¸í•´ì£¼ì„¸ìš”', 0);
                }
                playWrongSound();
                input.value = '';
                return;
            }

            // ë„ì–´ì“°ê¸° ì œê±°í•œ ë‹¨ì–´ë¡œ ì¤‘ë³µ ì²´í¬
            if (gameState.usedWords && gameState.usedWords.includes(wordForGame)) {
                if (gameState.isMobile) {
                    showToast('ğŸ˜“', 'ì´ë¯¸ ì‚¬ìš©í•œ ë‹¨ì–´ì˜ˆìš”', 0);
                } else {
                    updateEmoji('ğŸ˜“', 'ì´ë¯¸ ì‚¬ìš©í•œ ë‹¨ì–´ì˜ˆìš”', 0);
                }
                playWrongSound();
                input.value = '';
                return;
            }

            try {
                // ğŸ†• í„´ì œ ëª¨ë“œ: í˜„ì¬ í„´ì¸ì§€ í™•ì¸
                if (multiplayerState.isMultiplayer && multiplayerState.gameMode === 'turn') {
                    // ì¤‘ë³µ ë‹¨ì–´ ì²´í¬ (í´ë¼ì´ì–¸íŠ¸ ì¸¡)
                    const wordLower = wordForGame.toLowerCase();
                    if (multiplayerState.usedWords && multiplayerState.usedWords.includes(wordLower)) {
                        // ì¤‘ë³µ ë‹¨ì–´ ì²˜ë¦¬: ë‹¨ì–´ ëœ» ì˜ì—­ì— ë©”ì‹œì§€ í‘œì‹œ
                        updateDefinition('ì´ë¯¸ ë‚˜ì™”ë˜ ë‹¨ì–´ì…ë‹ˆë‹¤');
                        
                        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ (í„´ì œ ëª¨ë“œ: PCì—ì„œëŠ” showTurnModeToast, ëª¨ë°”ì¼ì—ì„œë§Œ showToast)
                        if (gameState.isMobile && !isPC()) {
                            showToast('ğŸ˜“', 'ì´ë¯¸ ë‚˜ì™”ë˜ ë‹¨ì–´ì…ë‹ˆë‹¤', 0);
                        } else {
                            showTurnModeToast('ğŸ˜“', 'ì´ë¯¸ ë‚˜ì™”ë˜ ë‹¨ì–´ì…ë‹ˆë‹¤');
                        }
                        playWrongSound();
                        input.value = '';
                        return;
                    }
                    
                    // í„´ì œ ëª¨ë“œì—ì„œëŠ” ì„œë²„ì—ì„œ í„´ í™•ì¸ ë° ë‹¨ì–´ ì œì¶œ
                    // ğŸš€ ì†ë„ ê°œì„ : íƒ€ì„ì•„ì›ƒ 2ì´ˆ ì„¤ì •
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 2000);
                    
                    let response;
                    try {
                        response = await fetch('https://steep-moon-7816.sucksuck1114.workers.dev/api/validate-word', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ word: wordForGame }),
                            signal: controller.signal
                        });
                        clearTimeout(timeoutId);
                    } catch (error) {
                        clearTimeout(timeoutId);
                        if (error.name === 'AbortError') {
                            updateDefinition('ìš”ì²­ ì‹œê°„ ì´ˆê³¼ (2ì´ˆ)');
                            if (gameState.isMobile && !isPC()) {
                                showToast('â±ï¸', 'ì‘ë‹µì´ ë„ˆë¬´ ëŠë¦½ë‹ˆë‹¤', 0);
                            } else {
                                showTurnModeToast('â±ï¸', 'ì‘ë‹µì´ ë„ˆë¬´ ëŠë¦½ë‹ˆë‹¤');
                            }
                            playWrongSound();
                            input.value = '';
                            return;
                        }
                        throw error;
                    }
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    const data = await response.json();

                    if (data.valid) {
                        // ë‹¨ì–´ ëœ» í‘œì‹œ (API ì‘ë‹µ êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì •)
                        if (data.definitions && data.definitions.length > 0 && data.definitions[0].definition) {
                            updateDefinition(data.definitions[0].definition);
                        } else if (data.definition) {
                            // í•˜ìœ„ í˜¸í™˜ì„±
                            updateDefinition(data.definition);
                        }
                        
                        // ìƒëª…ê¶Œ íšë“ ê³„ì‚° (íš¨ê³¼ìŒ/í† ìŠ¤íŠ¸ìš©)
                        const wordLength = wordForGame.length;
                        const hasSpecial = hasSpecialConsonant(wordForGame, currentChars);
                        let livesEarned = 0;
                        if (wordLength === 2 && hasSpecial) {
                            livesEarned = 1; // 2ê¸€ì + íŠ¹ë³„ì´ˆì„±
                        } else if (wordLength === 2) {
                            livesEarned = 0; // 2ê¸€ì ì¼ë°˜
                        } else if (wordLength === 3) {
                            livesEarned = 1; // 3ê¸€ì
                        } else if (wordLength === 4) {
                            livesEarned = 3; // 4ê¸€ì
                        } else if (wordLength >= 5) {
                            livesEarned = 5; // 5ê¸€ì+
                        }
                        
                        // íš¨ê³¼ìŒ ì¬ìƒ ê·œì¹™ (í„´ì œ ì „ìš©):
                        // - 3ê¸€ì ì´ìƒ ë§ì·„ì„ ë•Œë§Œ ì ìˆ˜ íš¨ê³¼ìŒ
                        //   - 3ê¸€ì: 100 110 120.mp3
                        //   - 4ê¸€ì ì´ìƒ: 400.mp3
                        if (wordLength >= 3) {
                            if (wordLength === 3) {
                                playScoreSound(100); // 100 110 120.mp3
                            } else if (wordLength >= 4) {
                                playScoreSound(400); // 400.mp3
                            }
                        } else {
                            // 2ê¸€ìëŠ” ê¸°ì¡´ ë¡œì§ ìœ ì§€ (ìƒëª…ê¶Œ ìœ ë¬´ì— ë”°ë¼ 100/30 ì„ íƒ)
                            if (livesEarned >= 1) {
                                playScoreSound(100);
                            } else {
                                playScoreSound(30);
                            }
                        }
                        
                        // ìƒëª…ê¶Œ í† ìŠ¤íŠ¸ëŠ” ê¸°ì¡´ ê·œì¹™ ìœ ì§€ (í„´ì œ ëª¨ë“œ: PCì—ì„œëŠ” showTurnModeToast, ëª¨ë°”ì¼ì—ì„œë§Œ showToast)
                        if (livesEarned >= 1) {
                            if (gameState.isMobile && !isPC()) {
                                showToast('â¤ï¸', `ìƒëª…ê¶Œ ${livesEarned}ê°œ íšë“`, 0);
                            } else {
                                showTurnModeToast('â¤ï¸', `ìƒëª…ê¶Œ ${livesEarned}ê°œ íšë“`);
                            }
                        }
                        
                        // ğŸ†• ìì‹ ì´ ë‹¨ì–´ë¥¼ ì…ë ¥í–ˆìœ¼ë¯€ë¡œ lastUsedWordsCount ì—…ë°ì´íŠ¸ (ìƒëŒ€ë°© íš¨ê³¼ìŒ ì¤‘ë³µ ë°©ì§€)
                        if (multiplayerState.usedWords) {
                            multiplayerState.lastUsedWordsCount = multiplayerState.usedWords.length + 1; // +1ì€ ì„œë²„ì— ì¶”ê°€ë  ì˜ˆì •
                        }
                        // ğŸ†• ìì‹ ì´ ë°©ê¸ˆ ì…ë ¥í–ˆë‹¤ëŠ” í”Œë˜ê·¸ ì„¤ì • (í´ë§ì—ì„œ ì¤‘ë³µ íš¨ê³¼ìŒ ë°©ì§€)
                        multiplayerState.justSubmittedWord = true;
                        setTimeout(() => {
                            multiplayerState.justSubmittedWord = false;
                        }, 1000); // 1ì´ˆ í›„ í”Œë˜ê·¸ í•´ì œ (í´ë§ ì£¼ê¸° ê³ ë ¤)
                        
                        // ì„œë²„ì— ë‹¨ì–´ ì œì¶œ
                        console.log('[í„´ì œ] ë‹¨ì–´ ì œì¶œ:', wordForGame, 'í”Œë ˆì´ì–´:', multiplayerState.players.length);
                        
                        // ğŸ†• ë‹¨ì–´ ì œì¶œ í”Œë˜ê·¸ ì„¤ì • (turn_timeout ì¤‘ë³µ ë°©ì§€)
                        gameState.wordSubmitted = true;
                        
                        const submitResponse = await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${multiplayerState.roomId}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                action: 'submit_word',
                                playerId: multiplayerState.playerId,
                                word: wordForGame,
                                isValid: true,
                                wordLength: wordForGame.length,
                                hasSpecialConsonant: hasSpecialConsonant(wordForGame, currentChars)
                                // ğŸš€ players ë°°ì—´ ì œê±°: ì„œë²„ì˜ state.playersë§Œ ì‚¬ìš©
                            })
                        });
                        
                        if (submitResponse.ok) {
                            console.log('[í„´ì œ] ë‹¨ì–´ ì œì¶œ ì„±ê³µ, í„´ ì „í™˜ ëŒ€ê¸°');
                            // ğŸ†• ë‹¨ì–´ ì œì¶œ í›„ ì„œë²„ ì²˜ë¦¬ ì‹œê°„ì„ ê³ ë ¤í•˜ì—¬ í´ë§ ê°•ì œ ì‹¤í–‰
                            if (gameState.pollingAbortController) {
                                gameState.pollingAbortController.abort(); // ê¸°ì¡´ í´ë§ ì·¨ì†Œ
                            }
                            // ì„œë²„ì—ì„œ í„´ ì „í™˜ì´ ì™„ë£Œë  ì‹œê°„ì„ ê³ ë ¤í•˜ì—¬ í´ë§ ì‹œì‘
                            setTimeout(() => {
                                startPolling();
                            }, 300); // 300ms í›„ í´ë§ (ì„œë²„ ì²˜ë¦¬ ì‹œê°„ ê³ ë ¤)
                        }
                        
                        // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                        input.value = '';
                        input.focus();
                    } else {
                        // ì˜¤ë‹µ ì²˜ë¦¬: ë‹¨ì–´ ëœ» ì˜ì—­ì— ë©”ì‹œì§€ í‘œì‹œ
                        updateDefinition('ì‚¬ì „ì— ì—†ëŠ” ë‹¨ì–´ì…ë‹ˆë‹¤');
                        
                        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ (í„´ì œ ëª¨ë“œ: PCì—ì„œëŠ” showTurnModeToast, ëª¨ë°”ì¼ì—ì„œë§Œ showToast)
                        if (gameState.isMobile && !isPC()) {
                            showToast('ğŸ˜“', 'ì‚¬ì „ì— ì—†ëŠ” ë‹¨ì–´ì…ë‹ˆë‹¤', 0);
                        } else {
                            showTurnModeToast('ğŸ˜“', 'ì‚¬ì „ì— ì—†ëŠ” ë‹¨ì–´ì…ë‹ˆë‹¤');
                        }
                        playWrongSound();
                        input.value = '';
                    }
                    return; // í„´ì œ ëª¨ë“œëŠ” ì—¬ê¸°ì„œ ì¢…ë£Œ (ì„œë²„ì—ì„œ í„´ ì „í™˜ ì²˜ë¦¬)
                }
                
                // ì‹œê°„ì œ ëª¨ë“œ: ê¸°ì¡´ ë¡œì§
                // ì„œë²„ ê²€ì¦ì€ ë„ì–´ì“°ê¸° ì œê±°í•œ ë‹¨ì–´ë¡œ
                // ğŸš€ ì†ë„ ê°œì„ : íƒ€ì„ì•„ì›ƒ 2ì´ˆ ì„¤ì •
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 2000);
                
                let response;
                try {
                    response = await fetch('https://steep-moon-7816.sucksuck1114.workers.dev/api/validate-word', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ word: wordForGame }),
                        signal: controller.signal
                    });
                    clearTimeout(timeoutId);
                } catch (error) {
                    clearTimeout(timeoutId);
                    if (error.name === 'AbortError') {
                        updateDefinition('ìš”ì²­ ì‹œê°„ ì´ˆê³¼ (2ì´ˆ)');
                        if (gameState.isMobile && !isPC()) {
                            showToast('â±ï¸', 'ì‘ë‹µì´ ë„ˆë¬´ ëŠë¦½ë‹ˆë‹¤', 0);
                        } else {
                            updateEmoji('â±ï¸', 'ì‘ë‹µì´ ë„ˆë¬´ ëŠë¦½ë‹ˆë‹¤', 0);
                        }
                        playWrongSound();
                        input.value = '';
                        return;
                    }
                    throw error;
                }
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const data = await response.json();

                if (data.valid) {
                    // ì ìˆ˜ ê³„ì‚°ë„ ë„ì–´ì“°ê¸° ì œê±°í•œ ë‹¨ì–´ë¡œ
                    const score = calculateScore(wordForGame, wordChosung);
                    gameState.score += score.total;
                    gameState.usedWords.push(wordForGame);

                    const definition = data.definitions && data.definitions[0] ? data.definitions[0].definition : 'ëœ»ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                    gameState.wordDefinitions[word] = definition;

                    document.getElementById('score').textContent = gameState.score;
                    updateDefinition(definition);

                    let message = '';
                    let emoji = '';
                    if (score.total >= 500) {
                        emoji = 'ğŸ‘‘';
                        message = 'ë ˆì „ë“œë‹¤!';
                    } else if (score.total >= 400) {
                        emoji = 'ğŸ”¥';
                        message = 'ì´ˆì„± ì²œì¬!';
                    } else if (score.total >= 100) {
                        emoji = 'ğŸ¤©';
                        message = 'ëŒ€ë°• ì‚¬ê±´!';
                    } else if (score.total >= 50) {
                        emoji = 'ğŸ¤“';
                        message = 'ëŒ€ë‹¨í•´ìš”!';
                    } else if (score.total >= 30) {
                        emoji = 'ğŸ˜‰';
                        message = 'ì œë²•ì¸ë°?';
                    } else {
                        emoji = 'ğŸ¤¨';
                        message = 'ê¸°ë³¸ì´ì§€!';
                    }
                    
                    // ğŸ†• PCì—ì„œëŠ” í•­ìƒ updateEmoji ì‚¬ìš©, ëª¨ë°”ì¼ì—ì„œë§Œ showToast ì‚¬ìš©
                    if (gameState.isMobile && !isPC()) {
                        showToast(emoji, message, score.total);
                    } else {
                        updateEmoji(emoji, message, score.total);
                    }
                    playScoreSound(score.total);

                    input.value = '';
                    input.focus();
                } else {
                    // ğŸ†• PCì—ì„œëŠ” í•­ìƒ updateEmoji ì‚¬ìš©, ëª¨ë°”ì¼ì—ì„œë§Œ showToast ì‚¬ìš©
                    if (gameState.isMobile && !isPC()) {
                        showToast('ğŸ˜“', 'ì˜¬ë°”ë¥¸ ë‹¨ì–´ê°€ ì•„ë‹ˆì—ìš”', 0);
                    } else {
                        updateEmoji('ğŸ˜“', 'ì˜¬ë°”ë¥¸ ë‹¨ì–´ê°€ ì•„ë‹ˆì—ìš”', 0);
                    }
                    playWrongSound();
                    input.value = '';
                }
            } catch (error) {
                if (gameState.isMobile) {
                    showToast('ğŸ˜“', 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”', 0);
                } else {
                    updateEmoji('ğŸ˜“', 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”', 0);
                }
                playWrongSound();
                input.value = '';
            }
        }

        function startGame() {
            // ë©€í‹°í”Œë ˆì´ ì ìˆ˜ íŒì—…/ë‹¨ì–´ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
            multiplayerState.previousWordCounts = {};
            gameState.score = 0;
            gameState.timeLeft = 180;
            gameState.usedWords = [];
            gameState.wordDefinitions = {};
            gameState.gameRunning = true;
            gameState.tickSoundPlaying = false;
            gameState.roundCount++;
            gameState.shuffleCount = 0;
            
            gameState.originalConsonants = getRandomConsonants();
            gameState.currentConsonants = [...gameState.originalConsonants];
            
            displayConsonants(gameState.currentConsonants);
            
            document.getElementById('gameStartSection').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            document.getElementById('score').textContent = 0;
            document.getElementById('timer').textContent = 180;
            
            if (gameState.isMobile) {
                updateDefinition('ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ë©´ ëœ»ì´ í‘œì‹œë©ë‹ˆë‹¤');
                // ëª¨ë°”ì¼ì—ì„œë§Œ ë³„ë˜¥ë³„ ì´ˆì„± ë°°ê²½ ìƒì„±
                createFallingConsonants();
            } else {
                updateEmoji('ğŸ¤”', 'ë‹¨ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 0);
                updateDefinition('ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ë©´ ëœ»ì´ í‘œì‹œë©ë‹ˆë‹¤');
            }
            
            const input = document.getElementById('wordInput');
            input.value = '';
            setTimeout(() => input.focus(), 300);
            
            document.body.classList.remove('time-warning');
            
            gameState.gameTimer = setInterval(() => {
                gameState.timeLeft--;
                document.getElementById('timer').textContent = gameState.timeLeft;
                
                // ì´ˆì„± ë°°ì—´ ë³€ê²½ (ì •í™•í•œ ì‹œì  ì²´í¬, <= ì‚¬ìš©ìœ¼ë¡œ ê±´ë„ˆë›°ëŠ” ê²½ìš° ë°©ì§€)
                // ë©€í‹°í”Œë ˆì´ì–´ ëª¨ë“œì—ì„œëŠ” ì„œë²„ì˜ timeLeftë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ë³„ë„ ì²´í¬ í•„ìš”
                if (!multiplayerState.isMultiplayer) {
                    // ì‹±ê¸€í”Œë ˆì´ì–´: í´ë¼ì´ì–¸íŠ¸ íƒ€ì´ë¨¸ ì‚¬ìš©
                    if (gameState.timeLeft <= 120 && gameState.shuffleCount === 0) {
                        shuffleConsonants('reverse');
                        gameState.shuffleCount = 1; // ì‹¤í–‰ í‘œì‹œ
                    } else if (gameState.timeLeft <= 60 && gameState.shuffleCount === 1) {
                        shuffleConsonants('random');
                        gameState.shuffleCount = 2; // ì‹¤í–‰ í‘œì‹œ
                    }
                } else {
                    // ë©€í‹°í”Œë ˆì´ì–´: ì„œë²„ timeLeft ê¸°ë°˜ìœ¼ë¡œ ì²´í¬ (í´ë§ì—ì„œ ì—…ë°ì´íŠ¸ë¨)
                    // í´ë§ì—ì„œ timeLeftë¥¼ ë°›ì•„ì˜¬ ë•Œ ì²´í¬í•˜ë„ë¡ ë³€ê²½
                }
                
                if (gameState.timeLeft === 10) {
                    document.body.classList.add('time-warning');
                    if (gameState.sfxEnabled) playTickSound();
                    if (bgmAudio && gameState.bgmEnabled) fadeOutBGM();
                }
                
                // ğŸ†• ë©€í‹°í”Œë ˆì´ì–´ì—ì„œëŠ” ì„œë²„ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ì¢…ë£Œ ì²´í¬ (í´ë¼ì´ì–¸íŠ¸ íƒ€ì´ë¨¸ëŠ” ì°¸ê³ ìš©)
                if (gameState.timeLeft <= 0) {
                    if (multiplayerState.isMultiplayer) {
                        // ë©€í‹°í”Œë ˆì´ì–´: ì„œë²„ ì‹œê°„ í™•ì¸ í›„ ì¢…ë£Œ (í´ë§ì—ì„œ ì²˜ë¦¬)
                        // í´ë¼ì´ì–¸íŠ¸ íƒ€ì´ë¨¸ë§Œ ì •ì§€í•˜ê³  ì„œë²„ ì‘ë‹µ ëŒ€ê¸°
                        clearInterval(gameState.gameTimer);
                        gameState.gameRunning = false;
                    } else {
                        // ì‹±ê¸€í”Œë ˆì´ì–´: ì¦‰ì‹œ ì¢…ë£Œ
                        endGame();
                    }
                }
            }, 1000);
            
            if (gameState.bgmEnabled) playBGM();
        }

        function endGame() {
            clearInterval(gameState.gameTimer);
            gameState.gameRunning = false;
            document.body.classList.remove('time-warning');
            
            // ëª¨ë°”ì¼ì—ì„œ í‚¤ë³´ë“œ ë‚´ë¦¬ê¸°
            const input = document.getElementById('wordInput');
            if (input) input.blur();
            
            stopTickSound();
            stopBGM();
            saveBestScore(gameState.score);

            // ë©€í‹°í”Œë ˆì´ì–´ ëª¨ë“œë©´ ì„œë²„ì— ì¢…ë£Œ ì‹ í˜¸ ì „ì†¡
            if (multiplayerState.isMultiplayer && multiplayerState.roomId) {
                sendGameEnd();
                // ë©€í‹°í”Œë ˆì´ì–´ëŠ” í´ë§ì—ì„œ ëª¨ë‹¬ì„ ë„ìš°ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” return
                return;
            }

            // ì‹±ê¸€í”Œë ˆì´ì–´ ëª¨ë“œ
            // ğŸ†• ë©€í‹°í”Œë ˆì´ì–´ì™€ ë™ì¼í•œ ì¤‘ë³µ ë°©ì§€ ë¡œì§ ì ìš©
            if (gameState.sfxEnabled && !gameState.finishedSoundPlaying) {
                gameState.finishedSoundPlaying = true; // ì¬ìƒ ì‹œì‘ í”Œë˜ê·¸
                try {
                    const audio = new Audio('./sound/finished.mp3');
                    audio.volume = 0.5;
                    audio.onended = () => {
                        // ì¬ìƒì´ ëë‚˜ë©´ ì¦‰ì‹œ í”Œë˜ê·¸ ë¦¬ì…‹
                        gameState.finishedSoundPlaying = false;
                    };
                    audio.play().catch(e => {
                        console.log('ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', e);
                        gameState.finishedSoundPlaying = false; // ì—ëŸ¬ ì‹œ í”Œë˜ê·¸ ë¦¬ì…‹
                    });
                } catch (e) {
                    console.log('ì†Œë¦¬ ë¡œë“œ ì‹¤íŒ¨:', e);
                    gameState.finishedSoundPlaying = false; // ì—ëŸ¬ ì‹œ í”Œë˜ê·¸ ë¦¬ì…‹
                }
            }

            showGameEndScreen();
        }

        function getGameEndMessage(score) {
            if (score >= 2000) return { emoji: 'ğŸ‘‘', message: 'ì´ˆì„±ì˜ ì „ì„¤!!!', animation: 'mascotSpin' };
            else if (score >= 1501) return { emoji: 'ğŸ”¥', message: 'ë‹¹ì‹ ì€ ì´ˆì„±ì™•!', animation: 'mascotJump' };
            else if (score >= 1001) return { emoji: 'ğŸ¤©', message: 'ê³ ìˆ˜ì‹œë„¤ìš”?', animation: 'mascotPulse' };
            else if (score >= 601) return { emoji: 'ğŸ¤“', message: 'ì œë²•ì¸ë°ìš”?', animation: 'mascotShake' };
            else if (score >= 301) return { emoji: 'ğŸ˜‰', message: 'ê¸°ë³¸ì€ í•˜ì‹œë„¤ìš”?', animation: 'mascotPulse' };
            else return { emoji: 'ğŸ¤¨', message: 'í• ë§í•˜ì•Š...', animation: 'mascotShake' };
        }

        function showGameEndScreen() {
            const endData = getGameEndMessage(gameState.score);
            
            // ğŸ†• ëœë¤ ë°°ë„ˆ ì„ íƒ (banner1~5.jpg)
            const randomBannerNum = Math.floor(Math.random() * 5) + 1;
            const bannerImage = `./banner/banner${randomBannerNum}.jpg`;
            
            const overlay = document.createElement('div');
            overlay.className = 'game-end-overlay';
            overlay.innerHTML = `
                <div class="game-end-content">
                    <div class="mascot ${endData.animation}">${endData.emoji}</div>
                    <div class="game-end-title">${endData.message}</div>
                    <div class="final-score">${gameState.score}ì </div>
                    <div class="game-end-banner" style="text-align: center; margin: 15px 0;">
                        <a href="https://smartstore.naver.com/gemfarm" target="_blank" style="display: inline-block;">
                            <img src="${bannerImage}" alt="ê´‘ê³ " style="width: 300px; height: 200px; object-fit: contain; border-radius: 8px; cursor: pointer; background: #f8f9fa;" />
                        </a>
                    </div>
                    <div class="game-stats">
                        <div class="stat-box">
                            <div class="stat-label">ë§ì¶˜ ë‹¨ì–´</div>
                            <div class="stat-value">${gameState.usedWords.length}ê°œ</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">ìµœê³  ê¸°ë¡</div>
                            <div class="stat-value">${gameState.bestScore}ì </div>
                        </div>
                    </div>
                    <div class="study-notes">
                        <h3>ğŸ“š í•™ìŠµ ë…¸íŠ¸</h3>
                        <div id="studyWordList" class="word-list"></div>
                    </div>
                    <div class="end-buttons">
                        <button class="end-btn secondary" onclick="closeGameEndScreen()">ë‹«ê¸°</button>
                        <button class="end-btn primary" onclick="closeGameEndScreen(); setTimeout(startGame, 100);">ë‹¤ì‹œ í•˜ê¸°</button>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);

            const studyList = overlay.querySelector('#studyWordList');
            gameState.usedWords.forEach(word => {
                const definition = gameState.wordDefinitions[word] || 'ëœ»í’€ì´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
                const score = calculateScore(word, getChosung(word));
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                wordItem.innerHTML = `
                    <div class="word-header">
                        <strong>${word}</strong>
                        <span>+${score.total}ì </span>
                    </div>
                    <div class="word-def">${definition}</div>
                `;
                studyList.appendChild(wordItem);
            });
        }

        function closeGameEndScreen() {
            const overlay = document.querySelector('.game-end-overlay');
            if (overlay) overlay.remove();
            resetGame();
        }

        function resetGame() {
            if (gameState.gameRunning) {
                // ë©€í‹°í”Œë ˆì´ ì¤‘ì´ê³  ë°©ì¥ì´ë©´ ë‹¤ì‹œ ì‹œì‘
                if (multiplayerState.isMultiplayer && multiplayerState.isHost) {
                    if (!confirm('ê²Œì„ì„ ë‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                    
                    clearInterval(gameState.gameTimer);
                    stopBGM();
                    stopTickSound();
                    document.body.classList.remove('time-warning');
                    
                    // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
                    gameState.score = 0;
                    gameState.usedWords = [];
                    gameState.wordDefinitions = {};
                    
                    // ìƒˆ ê²Œì„ ì‹œì‘
                    setTimeout(() => startGame(), 100);
                    return;
                }
                
                if (!confirm('ê²Œì„ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            }
            
            clearInterval(gameState.gameTimer);
            stopBGM();
            stopTickSound();
            document.body.classList.remove('time-warning');
            
            document.getElementById('gameStartSection').classList.remove('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('wordInput').value = '';
            gameState.gameRunning = false;
            
            // ëª¨ë°”ì¼ ì„¤ì • ëª¨ë‹¬ ë‹«ê¸°
            closeSettings();
        }

        function resetGameFromSettings() {
            closeSettings();
            setTimeout(() => {
                if (gameState.gameRunning && !confirm('ê²Œì„ì„ ì¢…ë£Œí•˜ê³  ìƒˆê²Œì„ì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                resetGame();
                setTimeout(startGame, 100);
            }, 100);
        }

        function toggleBGM() {
            gameState.bgmEnabled = !gameState.bgmEnabled;
            document.getElementById('bgmBtn').classList.toggle('active');
            if (!gameState.bgmEnabled) stopBGM();
            else if (gameState.gameRunning) playBGM();
        }

        function toggleSFX() {
            gameState.sfxEnabled = !gameState.sfxEnabled;
            document.getElementById('sfxBtn').classList.toggle('active');
        }

        function toggleTyping() {
            gameState.typingEnabled = !gameState.typingEnabled;
            document.getElementById('typingBtn').classList.toggle('active');
        }

        // ëª¨ë°”ì¼ ì„¤ì • ëª¨ë‹¬ í•¨ìˆ˜
        function openSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
            syncSettingsModal();
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        function syncSettingsModal() {
            const bgmBtn = document.getElementById('modalBgmBtn');
            const sfxBtn = document.getElementById('modalSfxBtn');
            const typingBtn = document.getElementById('modalTypingBtn');
            
            bgmBtn.textContent = gameState.bgmEnabled ? 'ON' : 'OFF';
            bgmBtn.classList.toggle('active', gameState.bgmEnabled);
            
            sfxBtn.textContent = gameState.sfxEnabled ? 'ON' : 'OFF';
            sfxBtn.classList.toggle('active', gameState.sfxEnabled);
            
            typingBtn.textContent = gameState.typingEnabled ? 'ON' : 'OFF';
            typingBtn.classList.toggle('active', gameState.typingEnabled);
        }

        function toggleModalBGM() {
            gameState.bgmEnabled = !gameState.bgmEnabled;
            syncSettingsModal();
            if (!gameState.bgmEnabled) stopBGM();
            else if (gameState.gameRunning) playBGM();
        }

        function toggleModalSFX() {
            gameState.sfxEnabled = !gameState.sfxEnabled;
            syncSettingsModal();
        }

        function toggleModalTyping() {
            gameState.typingEnabled = !gameState.typingEnabled;
            syncSettingsModal();
        }

        let bgmAudio = null;

        function playBGM() {
            try {
                // í„´ì œ ëª¨ë“œ: turn_background.mp3 ë£¨í”„
                if (multiplayerState.isMultiplayer && multiplayerState.gameMode === 'turn') {
                    if (bgmAudio) {
                        bgmAudio.pause();
                        bgmAudio.currentTime = 0;
                    }
                    bgmAudio = new Audio('./sound/turn_background.mp3');
                    bgmAudio.loop = true;
                    bgmAudio.volume = 0.3;
                    bgmAudio.play().catch(e => {});
                    return;
                }
                
                // ì‹œê°„ì œ ëª¨ë“œ: background.mp3ì™€ background2.mp3 êµëŒ€
                const bgmFile = (gameState.roundCount % 2 === 1) ? './sound/background.mp3' : './sound/background2.mp3';
                if (bgmAudio) {
                    bgmAudio.pause();
                    bgmAudio.currentTime = 0;
                }
                bgmAudio = new Audio(bgmFile);
                bgmAudio.loop = true;
                bgmAudio.volume = bgmFile === './sound/background2.mp3' ? 0.4 : 0.3;
                bgmAudio.play().catch(e => {});
            } catch (e) {}
        }

        function stopBGM() {
            if (bgmAudio) {
                bgmAudio.pause();
                bgmAudio.currentTime = 0;
            }
        }

        function fadeOutBGM() {
            if (!bgmAudio) return;
            const fadeInterval = setInterval(() => {
                if (bgmAudio.volume > 0.05) {
                    bgmAudio.volume -= 0.05;
                } else {
                    clearInterval(fadeInterval);
                    bgmAudio.volume = 0;
                }
            }, 200);
        }

        function playScoreSound(score) {
            if (!gameState.sfxEnabled) {
                console.log('[ì†Œë¦¬] SFX ë¹„í™œì„±í™”ë¨');
                return;
            }
            let soundFile = '';
            if (score === 10) soundFile = './sound/10.mp3';
            else if (score === 20) soundFile = './sound/20.mp3';
            else if (score >= 30 && score < 100) soundFile = './sound/30.mp3';
            else if (score >= 100 && score < 400) soundFile = './sound/100 110 120.mp3';
            else if (score >= 400 && score < 900) soundFile = './sound/400.mp3';
            else if (score >= 900 && score < 1500) soundFile = './sound/900.mp3';
            else if (score >= 1500) soundFile = './sound/1500.mp3';
            
            if (!soundFile) {
                console.warn(`[ì†Œë¦¬] ì ìˆ˜ ${score}ì— í•´ë‹¹í•˜ëŠ” ì†Œë¦¬ íŒŒì¼ ì—†ìŒ`);
                return;
            }
            
            try {
                const audio = new Audio(soundFile);
                audio.volume = 0.5;
                console.log(`[ì†Œë¦¬] ì¬ìƒ ì‹œë„: ${soundFile} (ì ìˆ˜: ${score})`);
                audio.play().catch(e => {
                    console.error(`[ì†Œë¦¬] ì¬ìƒ ì‹¤íŒ¨: ${soundFile}`, e);
                });
            } catch (e) {
                console.error(`[ì†Œë¦¬] ì˜¤ë””ì˜¤ ìƒì„± ì‹¤íŒ¨: ${soundFile}`, e);
            }
        }

        function playWrongSound() {
            if (!gameState.sfxEnabled) return;
            try {
                const audio = new Audio('./sound/wrong.mp3');
                audio.volume = 0.5;
                audio.play().catch(e => {});
            } catch (e) {}
        }

        function playTickSound() {
            if (gameState.tickSoundPlaying) return;
            gameState.tickSoundPlaying = true;
            const tick = document.getElementById('tickSound');
            if (tick) {
                tick.loop = true;
                tick.volume = 0.3;
                tick.play().catch(e => {});
            }
        }

        function stopTickSound() {
            gameState.tickSoundPlaying = false;
            const tick = document.getElementById('tickSound');
            if (tick) {
                tick.pause();
                tick.currentTime = 0;
            }
        }

        function playTypingSound() {
            if (!gameState.typingEnabled) return;
            try {
                const audio = new Audio('./sound/typing.mp3');
                audio.volume = 0.2;
                audio.play().catch(e => {});
            } catch (e) {}
        }

        function saveBestScore(score) {
            // ğŸ†• localStorageì—ì„œ ì§ì ‘ ìµœê³  ê¸°ë¡ì„ ê°€ì ¸ì™€ ë¹„êµ (gameStateê°€ ì´ˆê¸°í™”ë˜ì—ˆì„ ìˆ˜ ìˆìŒ)
            const savedBest = localStorage.getItem('chosungBestScore');
            const currentBest = savedBest ? parseInt(savedBest, 10) : 0;
            
            if (score > currentBest) {
                gameState.bestScore = score;
                localStorage.setItem('chosungBestScore', score.toString());
                updateBestScoreDisplay();
                console.log(`ğŸ† ìƒˆë¡œìš´ ìµœê³  ê¸°ë¡! ${currentBest} â†’ ${score}`);
            } else {
                console.log(`ğŸ“Š í˜„ì¬ ì ìˆ˜: ${score}, ìµœê³  ê¸°ë¡: ${currentBest}`);
            }
        }

        function loadBestScore() {
            const saved = localStorage.getItem('chosungBestScore');
            gameState.bestScore = saved ? parseInt(saved) : 0;
            updateBestScoreDisplay();
        }

        function updateBestScoreDisplay() {
            document.getElementById('bestScoreDisplay').textContent = `ğŸ† ìµœê³  ê¸°ë¡: ${gameState.bestScore}ì `;
            document.getElementById('currentBestScore').textContent = gameState.bestScore;
        }

        // ğŸ†• ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (HTML onclickì—ì„œ ì‚¬ìš©)
        document.addEventListener('DOMContentLoaded', () => {
            loadBestScore();
            
            // ğŸ†• ì‹œì‘ í™”ë©´ ë²„íŠ¼ ì´ˆê¸°í™”
            setTimeout(() => {
                updateStartScreenButtons();
            }, 100);
            
            const input = document.getElementById('wordInput');
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    checkWord();
                }
            });
            
            input.addEventListener('input', () => {
                playTypingSound();
            });

            // ëª¨ë°”ì¼ì—ì„œ ìŠ¤í¬ë¡¤ ì™„ì „ ì°¨ë‹¨ (ê²Œì„ ì¤‘ì—ëŠ”)
            if (gameState.isMobile) {
                document.body.style.overflow = 'hidden';
                document.documentElement.style.overflow = 'hidden';
                
                // ê²Œì„ ì¤‘ì—ëŠ” í„°ì¹˜ë¬´ë¸Œ ì°¨ë‹¨
                document.addEventListener('touchmove', function preventScrollDuringGame(e) {
                    if (gameState.gameRunning) {
                        e.preventDefault();
                    }
                }, { passive: false });

                // ì„¤ì • ë²„íŠ¼ í‘œì‹œ, ìƒˆê²Œì„ ë²„íŠ¼ ìˆ¨ê¹€
                document.querySelector('.settings-btn').classList.remove('hidden');
                document.querySelector('.reset-btn').classList.add('hidden');
            } else {
                // PCì—ì„œëŠ” ì„¤ì • ë²„íŠ¼ ìˆ¨ê¹€, ìƒˆê²Œì„ ë²„íŠ¼ í‘œì‹œ
                document.querySelector('.settings-btn').classList.add('hidden');
                document.querySelector('.reset-btn').classList.remove('hidden');
            }
        });


        // ===== ë©€í‹°í”Œë ˆì´ ì‹œìŠ¤í…œ (í´ë§ ë°©ì‹) =====
        const multiplayerState = {
            lastEliminatedPlayers: [], // ğŸ†• íƒˆë½ íš¨ê³¼ìŒìš©: ì´ì „ íƒˆë½ì ëª©ë¡
            lastRoomData: null, // ğŸ†• ìµœì‹  roomData ì €ì¥ (checkWordì—ì„œ íƒˆë½ì ì²´í¬ìš©)
            isMultiplayer: false,
            roomId: null,
            playerId: null,
            playerName: null,
            isHost: false,
            pollingInterval: null,
            lastPlayerCount: 0,
            pendingRoomId: null,
            pendingRoomTitle: null, // ğŸ†• ë°© ì œëª© ì„ì‹œ ì €ì¥
            pendingGameMode: null, // ğŸ†• ê²Œì„ ëª¨ë“œ ì„ì‹œ ì €ì¥ (time/turn)
            playerWords: {},
            // ì±„íŒ… ê´€ë ¨
            chatMessages: [],
            // ìŠ¬ë¡¯ ê´€ë ¨ (ì´ì „ ì ìˆ˜ ì €ì¥)
            previousScores: {},
            // ğŸ†• ë¼ìš´ë“œ ì¶”ì 
            currentRound: 0,  // í˜„ì¬ ì°¸ì—¬ ì¤‘ì¸ ë¼ìš´ë“œ ë²ˆí˜¸
            // ğŸ†• í˜„ì¬ ê²Œì„ ëª¨ë“œ (time/turn)
            gameMode: 'time',
            // ğŸ†• í„´ì œ ëª¨ë“œ ì¶”ì 
            lastTurnPlayerId: null,
            lastTurnStartTime: null,
            players: [], // í”Œë ˆì´ì–´ ëª©ë¡ ì €ì¥
            // ğŸ†• í„´ì œ íš¨ê³¼ìŒ ì¶”ì  (ìƒëŒ€ë°© íš¨ê³¼ìŒ ì¬ìƒìš©)
            lastUsedWordsCount: 0, // ì´ì „ usedWords ë°°ì—´ ê¸¸ì´
            lastTurnCounts: {}, // ì´ì „ turnCount ìƒíƒœ
            lastPlayerLives: {} // ì´ì „ playerLives ìƒíƒœ (ìƒëª…ê¶Œ ì†Œì§„ íš¨ê³¼ìŒìš©)
        };

        function isPC() {
            return window.innerWidth >= 768;
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'mp-toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // ğŸ†• ë°© ëª©ë¡ ìë™ ìƒˆë¡œê³ ì¹¨ interval
        let roomListInterval = null;

        // ğŸ†• í•¨ê»˜í•˜ê¸° í´ë¦­ ì‹œ ë°”ë¡œ ë°© ëª©ë¡ í‘œì‹œ
        async function showRoomList() {
            // PCê°€ ì•„ë‹ˆì–´ë„ ë°© ëª©ë¡ì€ ì—´ ìˆ˜ ìˆë„ë¡ í—ˆìš©í•˜ë˜, ì•ˆë‚´ë§Œ í‘œì‹œ
            if (!isPC()) {
                showToast('ë©€í‹°í”Œë ˆì´ëŠ” PCì—ì„œ ê°€ì¥ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤ (ëª¨ë°”ì¼ì€ ì‹¤í—˜ ê¸°ëŠ¥)');
            }

            console.log('[showRoomList] fetching https://steep-moon-7816.sucksuck1114.workers.dev/api/rooms');

            // ë°© ëª©ë¡ ì¡°íšŒ í•¨ìˆ˜ (ì¬ì‹œë„ ë¡œì§ í¬í•¨)
            async function fetchAndDisplayRooms(retryCount = 0) {
                try {
                    const response = await fetch('https://steep-moon-7816.sucksuck1114.workers.dev/api/rooms');
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    const roomList = document.getElementById('mpRoomList');
                    
                    // dataê°€ ë°°ì—´ì´ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©, ì•„ë‹ˆë©´ data.rooms ì‚¬ìš©, ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´
                    let rooms = [];
                    if (Array.isArray(data)) {
                        rooms = data;
                    } else if (data && Array.isArray(data.rooms)) {
                        rooms = data.rooms;
                    }
                    
                    // ë°© ëª©ë¡ì´ ë¹„ì–´ìˆê³  ì¬ì‹œë„ íšŸìˆ˜ê°€ 3íšŒ ë¯¸ë§Œì´ë©´ ì¬ì‹œë„ (KV eventual consistency ëŒ€ì‘)
                    if (rooms.length === 0 && retryCount < 3) {
                        console.log(`[rooms] ë°© ëª©ë¡ ë¹„ì–´ìˆìŒ, ${500 * (retryCount + 1)}ms í›„ ì¬ì‹œë„... (${retryCount + 1}/3)`);
                        setTimeout(() => {
                            fetchAndDisplayRooms(retryCount + 1);
                        }, 500 * (retryCount + 1)); // 500ms, 1000ms, 1500ms
                        return;
                    }
                    
                    // ì„œë²„ì—ì„œ ì´ë¯¸ í•„í„°ë§ëœ ë°© ëª©ë¡ì„ ë°›ìœ¼ë¯€ë¡œ ì¶”ê°€ í•„í„°ë§ ë¶ˆí•„ìš”
                    if (rooms.length === 0) {
                        roomList.innerHTML = '<div class="mp-empty-message">í˜„ì¬ ëŒ€ê¸° ì¤‘ì¸ ë°©ì´ ì—†ì–´ìš”</div>';
                    } else {
                        roomList.innerHTML = rooms.map((room, index) => {
                            // ğŸ†• metadata ê¸°ë°˜ - playerCount / roomNumber ì‚¬ìš©
                            const playerCount = room.playerCount || 0;
                            const roomTitle = room.title || 'ì´ˆì„± ë°°í‹€ë°©';
                            const gameMode = room.gameMode === 'turn' ? 'í„´ì œ' : 'ì‹œê°„ì œ'; // ğŸ†• ê²Œì„ ëª¨ë“œ í‘œì‹œ
                            const roomNumber = room.roomNumber || (index + 1);
                            return `
                            <div class="mp-room-item">
                                <div class="mp-room-info">
                                    <div class="mp-room-title">${roomNumber}.ğŸ® ${roomTitle} [${gameMode}]</div>
                                    <div class="mp-room-status">(${playerCount}/5ëª…)</div>
                                </div>
                                <button class="mp-join-btn" onclick="joinRoom('${room.id}')">ì…ì¥í•˜ê¸°</button>
                            </div>
                        `;
                        }).join('');
                    }
                } catch (error) {
                    console.error('ë°© ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                    const roomList = document.getElementById('mpRoomList');
                    roomList.innerHTML = '<div class="mp-empty-message">ë°© ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
                }
            }
            
            // ì²« ì¡°íšŒ
            await fetchAndDisplayRooms();
            
            // ëª¨ë‹¬ í‘œì‹œ
            const modal = document.getElementById('mpRoomModal');
            modal.classList.remove('hidden');
            
            // ğŸ†• 1ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
            if (roomListInterval) clearInterval(roomListInterval);
            roomListInterval = setInterval(async () => {
                // ëª¨ë‹¬ì´ ì—´ë ¤ìˆì„ ë•Œë§Œ ìƒˆë¡œê³ ì¹¨
                if (!document.getElementById('mpRoomModal').classList.contains('hidden')) {
                    await fetchAndDisplayRooms();
                } else {
                    clearInterval(roomListInterval);
                    roomListInterval = null;
                }
            }, 1000);
        }

        function closeRoomModal() {
            document.getElementById('mpRoomModal').classList.add('hidden');
            // ğŸ†• interval ì •ë¦¬
            if (roomListInterval) {
                clearInterval(roomListInterval);
                roomListInterval = null;
            }
        }

        // ğŸ†• ê²Œì„ ëª¨ë“œ ì„ íƒí•˜ì—¬ ë°© ìƒì„±
        async function createRoomWithMode(gameMode) {
            let playerName = localStorage.getItem('playerName');
            if (!playerName) {
                multiplayerState.pendingRoomId = 'CREATE_NEW';
                multiplayerState.pendingGameMode = gameMode; // ğŸ†• ê²Œì„ ëª¨ë“œ ì €ì¥
                closeRoomModal();
                showNameModal();
                return;
            }
            
            // ğŸ†• ë°© ì œëª© ì…ë ¥ ëª¨ë‹¬ í‘œì‹œ (ê²Œì„ ëª¨ë“œì™€ í•¨ê»˜)
            multiplayerState.pendingGameMode = gameMode;
            closeRoomModal();
            showRoomTitleModal();
        }
        
        // ğŸ†• ë°© ì œëª© ì…ë ¥ ëª¨ë‹¬ í‘œì‹œ
        function showRoomTitleModal() {
            const modal = document.getElementById('mpRoomTitleModal');
            const input = document.getElementById('mpRoomTitleInput');
            input.value = '';
            modal.classList.remove('hidden');
            input.focus();
        }
        
        // ğŸ†• ë°© ì œëª© í™•ì¸
        async function confirmRoomTitle() {
            const input = document.getElementById('mpRoomTitleInput');
            const title = input.value.trim();
            document.getElementById('mpRoomTitleModal').classList.add('hidden');
            
            let playerName = localStorage.getItem('playerName');
            if (!playerName) {
                // ì´ë¦„ì´ ì—†ìœ¼ë©´ ì´ë¦„ ì…ë ¥ ë¨¼ì €
                multiplayerState.pendingRoomId = 'CREATE_NEW';
                multiplayerState.pendingRoomTitle = title || null;
                showNameModal();
                return;
            }
            
            // ğŸ†• ê²Œì„ ëª¨ë“œì™€ í•¨ê»˜ ë°© ìƒì„±
            const gameMode = multiplayerState.pendingGameMode || 'time'; // ê¸°ë³¸ê°’: ì‹œê°„ì œ
            await createRoomAndStart(playerName, title || null, gameMode);
        }
        
        // ğŸ†• ë°© ì œëª© ì·¨ì†Œ
        function cancelRoomTitle() {
            document.getElementById('mpRoomTitleModal').classList.add('hidden');
        }

        async function createRoomAndStart(playerName, roomTitle = null, gameMode = 'time') {
            try {
                // ğŸ†• playerIdë¥¼ ë¨¼ì € ìƒì„± (ë°© ìƒì„± ì‹œ ìë™ ì…ì¥ìš©)
                multiplayerState.playerId = 'player_' + Date.now();
                multiplayerState.playerName = playerName;
                multiplayerState.isHost = true;
                multiplayerState.isMultiplayer = true;
                multiplayerState.lastPlayerCount = 1;
                
                // ğŸ†• ì œëª©, ê²Œì„ ëª¨ë“œ, ë°©ì¥ ì •ë³´ë¥¼ ì„œë²„ì— ì „ì†¡ (ë°© ìƒì„±ê³¼ ë™ì‹œì— ë°©ì¥ ìë™ ì…ì¥)
                const createResponse = await fetch('https://steep-moon-7816.sucksuck1114.workers.dev/api/create-room', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        title: roomTitle, 
                        gameMode: gameMode,
                        playerId: multiplayerState.playerId,
                        playerName: playerName
                    })
                });
                if (!createResponse.ok) throw new Error('ë°© ìƒì„± ì‹¤íŒ¨');
                const createData = await createResponse.json();
                const roomId = createData.roomId;
                multiplayerState.roomId = roomId;
                
                // ğŸ†• ë°© ìƒì„± ì‹œ ì´ë¯¸ ë°©ì¥ì´ ì…ì¥í–ˆìœ¼ë¯€ë¡œ join-room í˜¸ì¶œ ë¶ˆí•„ìš”
                // (í•˜ì§€ë§Œ í˜¸í™˜ì„±ì„ ìœ„í•´ í˜¸ì¶œí•´ë„ ì¤‘ë³µ ì²´í¬ë¡œ ì²˜ë¦¬ë¨)
                closeRoomModal();
                // ê²Œì„ ì‹œì‘ ëŒ€ì‹  ëŒ€ê¸°ì‹¤ë¡œ ì´ë™ (ì´ì „ ë²„ì „ê³¼ ë™ì¼)
                updateStartScreenButtons();
                startPolling(); // í´ë§ ì‹œì‘
                
                // ğŸ†• ë¹ˆ ìŠ¬ë¡¯ ì¦‰ì‹œ í‘œì‹œ!
                document.getElementById('playerSlotsLeft').classList.remove('hidden');
                document.getElementById('chatContainer').classList.remove('hidden');
                
                // ğŸ†• ë¹ˆ ìŠ¬ë¡¯ 5ê°œ ë¨¼ì € ë§Œë“¤ê¸° (ëŒ€ê¸°ì¤‘ í‘œì‹œ)
                const slotsContainer = document.getElementById('playerSlotsLeft');
                slotsContainer.innerHTML = '';
                for (let i = 0; i < 5; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'player-slot empty';
                    slot.innerHTML = `
                        <div class="player-slot-name">ëŒ€ê¸°ì¤‘...</div>
                        <div class="player-slot-score">-</div>
                    `;
                    slotsContainer.appendChild(slot);
                }
                
                // ğŸ†• ê·¸ ë‹¤ìŒì— ì‹¤ì œ í”Œë ˆì´ì–´ ì •ë³´ë¡œ ì—…ë°ì´íŠ¸
                const roomResponse = await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${roomId}`);
                const roomData = await roomResponse.json();
                // ğŸ†• ê²Œì„ ëª¨ë“œ ì €ì¥
                multiplayerState.gameMode = roomData.gameMode || 'time';
                multiplayerState.players = roomData.players || [];
                
                // ğŸ†• í„´ì œ ëª¨ë“œì¼ ë•Œ bodyì— í´ë˜ìŠ¤ ì¶”ê°€
                updateGameModeUI(multiplayerState.gameMode);
                
                // ğŸ†• ë°©ì œ í‘œì‹œ ì—…ë°ì´íŠ¸ (ë°© ìƒì„± ì§í›„, ì‹œê°„ì œ/í„´ì œ ê³µí†µ)
                if (roomData.title && roomData.id) {
                    const roomInfoInChat = document.getElementById('roomInfoInChat');
                    if (roomInfoInChat) {
                        const titleEl = roomInfoInChat.querySelector('.turn-room-title');
                        const roomNumber = roomData.roomNumber || null;
                        if (titleEl) {
                            titleEl.textContent = roomNumber ? `${roomNumber}. ${roomData.title}` : roomData.title;
                        }
                        roomInfoInChat.classList.remove('hidden');
                    }
                }
                
                // ğŸ†• í„´ì œ ëª¨ë“œì¼ ë•Œ ì‹œì‘ í™”ë©´ ì„¤ëª… ë¬¸êµ¬ ë³€ê²½
                if (multiplayerState.gameMode === 'turn') {
                    const startInstruction = document.querySelector('.start-instruction');
                    const scoreGuide = document.querySelector('.score-guide');
                    if (startInstruction) {
                        startInstruction.innerHTML = 'ì œì‹œëœ ì´ˆì„±ìœ¼ë¡œ ìˆœì„œ ìƒê´€ì—†ì´ ë‹¨ì–´ë¥¼ ë§Œë“œì„¸ìš”!<br><span style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">í•˜íŠ¸â¤ï¸</span>ë¥¼ ëª¨ì•„ ìƒì¡´í•˜ì„¸ìš”!';
                    }
                    if (scoreGuide) {
                        scoreGuide.style.display = 'block';
                        scoreGuide.innerHTML = `
                            <div class="score-guide-compact" style="text-align: center; letter-spacing: -0.5px; display: flex; flex-direction: column; align-items: center;">
                                <div class="score-item" style="text-align: center; width: 100%;">íŠ¹ë³„ì´ˆì„± 2ê¸€ì<span style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">â¤ï¸</span> / 3ê¸€ì<span style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">â¤ï¸</span></div>
                                <div class="score-item" style="text-align: center; width: 100%;">4ê¸€ì<span style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">â¤ï¸â¤ï¸â¤ï¸</span> / 5ê¸€ì+<span style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</span></div>
                                <div class="special-score" style="text-align: center; width: 100%;">íŠ¹ë³„ì´ˆì„±(ã„²ã„¸ã…ƒã…†ã…‰ã…Šã…‹ã…Œã…)</div>
                                <div class="score-item" style="color: #6bff6b; margin-top: 8px; font-weight: bold; text-align: center; width: 100%;">ìµœì†Œ 2ì¸ë¶€í„° ê²Œì„ ì‹œì‘ì´ ê°€ëŠ¥í•´ìš”</div>
                            </div>
                        `;
                    }
                } else {
                    // ì‹œê°„ì œ ëª¨ë“œ: ê¸°ë³¸ ë¬¸êµ¬ë¡œ ë³µì›
                    const startInstruction = document.querySelector('.start-instruction');
                    const scoreGuide = document.querySelector('.score-guide');
                    if (startInstruction) {
                        startInstruction.innerHTML = 'ì œì‹œëœ ì´ˆì„±ìœ¼ë¡œ ìˆœì„œ ìƒê´€ì—†ì´<br>ë§˜ê» ë‹¨ì–´ë¥¼ ë§Œë“œì„¸ìš”!';
                    }
                    if (scoreGuide) {
                        scoreGuide.style.display = 'block';
                        scoreGuide.innerHTML = `
                            <div class="score-guide-compact">
                                <div class="score-item">2ê¸€ì: 10ì </div>
                                <div class="score-item">3ê¸€ì: 100ì </div>
                                <div class="score-item">4ê¸€ì: 400ì </div>
                                <div class="score-item">5ê¸€ì: 900ì </div>
                                <div class="special-score">âœ¨ íŠ¹ë³„ì´ˆì„±(ã„²ã„¸ã…ƒã…†ã…‰ã…Šã…‹ã…Œã…) ê° +20ì </div>
                                <div class="special-score-detail">ìƒˆ í”Œë ˆì´ì–´ ì…ì¥ ì‹œ ìë™ í•©ë¥˜</div>
                            </div>
                        `;
                    }
                }
                
                updateScoreboard(roomData);
            } catch (error) {
                console.error('ë°© ìƒì„± ì‹¤íŒ¨:', error);
                showToast('ë°© ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
            }
        }

        function joinRoom(roomId) {
            let playerName = localStorage.getItem('playerName');
            if (!playerName) {
                multiplayerState.pendingRoomId = roomId;
                closeRoomModal();
                showNameModal();
                return;
            }
            joinRoomWithName(roomId, playerName);
        }

        async function joinRoomWithName(roomId, playerName) {
            try {
                // ğŸ†• íƒˆë½ì ì¬ì…ì¥ ì²´í¬: ë¨¼ì € í˜„ì¬ ë°© ìƒíƒœ í™•ì¸
                let isEliminatedRejoin = false;
                const previousPlayerId = localStorage.getItem(`lastPlayerId_${roomId}`);
                
                if (previousPlayerId) {
                    // ì´ì „ playerIdë¡œ íƒˆë½ì ì—¬ë¶€ í™•ì¸
                    const currentRoomData = await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${roomId}`).then(r => r.json()).catch(() => null);
                    if (currentRoomData?.eliminatedPlayers?.includes(previousPlayerId)) {
                        isEliminatedRejoin = true;
                    }
                }
                
                // ğŸ†• localStorage 5ë¶„ ì œí•œ ì™„ì „íˆ ì œê±° (íƒˆë½ìë“  ìƒˆ ìœ ì €ë“  ììœ ë¡­ê²Œ ì…ì¥ ê°€ëŠ¥)
                
                // ğŸ†• íƒˆë½ì ì¬ì…ì¥ì¸ ê²½ìš° ì´ì „ playerId ì¬ì‚¬ìš©, ì•„ë‹ˆë©´ ìƒˆë¡œ ìƒì„±
                if (isEliminatedRejoin && previousPlayerId) {
                    multiplayerState.playerId = previousPlayerId;
                } else {
                    multiplayerState.playerId = 'player_' + Date.now();
                    // ìƒˆ playerId ì €ì¥
                    localStorage.setItem(`lastPlayerId_${roomId}`, multiplayerState.playerId);
                }
                
                multiplayerState.playerName = playerName;
                multiplayerState.roomId = roomId;
                multiplayerState.isHost = false;
                multiplayerState.isMultiplayer = true;
                
                // ğŸ†• worker.jsì—ì„œ ìë™ìœ¼ë¡œ íƒˆë½ì ì¬ì…ì¥ ì²˜ë¦¬ (eliminatedPlayers í™•ì¸ í›„ player_rejoin ì•¡ì…˜ ì „ì†¡)
                const response = await fetch('https://steep-moon-7816.sucksuck1114.workers.dev/api/join-room', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ roomId: roomId, playerId: multiplayerState.playerId, playerName: playerName })
                });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    // ğŸš€ ë‹‰ë„¤ì„ ì¤‘ë³µ ì—ëŸ¬ ì²˜ë¦¬: í† ìŠ¤íŠ¸ ëŒ€ì‹  ëª¨ë‹¬ ë‚´ë¶€ì— ë©”ì‹œì§€ í‘œì‹œ
                    if (errorData.error === 'DUPLICATE_NAME' || errorData.message) {
                        // ëª¨ë‹¬ì´ ì´ë¯¸ ì—´ë ¤ìˆìœ¼ë©´ ë©”ì‹œì§€ë§Œ ì—…ë°ì´íŠ¸, ì•„ë‹ˆë©´ ëª¨ë‹¬ ì—´ê¸°
                        const modal = document.getElementById('mpNameModal');
                        if (modal.classList.contains('hidden')) {
                            multiplayerState.pendingRoomId = roomId;
                            showNameModal();
                        }
                        // ëª¨ë‹¬ ë‚´ë¶€ì— ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ (ì…ë ¥ì°½ì„ ê°€ë¦¬ì§€ ì•ŠìŒ)
                        showNameModalMessage('ê°™ì€ ì´ë¦„ì˜ í”Œë ˆì´ì–´ê°€ ìˆìŠµë‹ˆë‹¤.\në‹¤ë¥¸ ì´ë¦„ì„ ì‚¬ìš©í•˜ì„¸ìš”.', 'error');
                        return;
                    }
                    throw new Error('ë°© ì…ì¥ ì‹¤íŒ¨');
                }
                const data = await response.json();
                closeRoomModal();
                // showToast(`${data.roomData.players.length}ëª…ì˜ í”Œë ˆì´ì–´ê°€ í•¨ê»˜ í”Œë ˆì´ ì¤‘ì…ë‹ˆë‹¤`); // ì œê±°
                // ë°© ì…ì¥ í›„ ì ìˆ˜ íŒì—…ìš© ìƒíƒœ ì´ˆê¸°í™”
                multiplayerState.previousWordCounts = {};

                // ğŸš€ ì…ì¥ ì§í›„ ì¦‰ì‹œ game-state ê°€ì ¸ì™€ì„œ ìŠ¬ë¡¯ í‘œì‹œ
                const stateResponse = await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${roomId}&playerId=${encodeURIComponent(multiplayerState.playerId || '')}`, {
                    cache: 'no-cache'
                });
                const roomData = await stateResponse.json();
                
                // ğŸš€ ì…ì¥ ì§í›„ ì¦‰ì‹œ ìŠ¬ë¡¯ í‘œì‹œ (í´ë§ ì‹œì‘ ì „ì—ë„)
                multiplayerState.gameMode = roomData.gameMode || 'time';
                updateGameModeUI(multiplayerState.gameMode);
                
                // ğŸš€ ìŠ¬ë¡¯ ì¦‰ì‹œ í‘œì‹œ
                if (multiplayerState.isMultiplayer) {
                    document.getElementById('playerSlotsLeft')?.classList.remove('hidden');
                    document.getElementById('chatContainer')?.classList.remove('hidden');
                    updatePlayerSlots(roomData);
                }
                
                if (multiplayerState.gameMode === 'turn') {
                    const startInstruction = document.querySelector('.start-instruction');
                    const scoreGuide = document.querySelector('.score-guide');
                    if (startInstruction) {
                        startInstruction.innerHTML = 'ì œì‹œëœ ì´ˆì„±ìœ¼ë¡œ ìˆœì„œ ìƒê´€ì—†ì´ ë‹¨ì–´ë¥¼ ë§Œë“œì„¸ìš”!<br><span style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">í•˜íŠ¸â¤ï¸</span>ë¥¼ ëª¨ì•„ ìƒì¡´í•˜ì„¸ìš”!';
                    }
                    if (scoreGuide) {
                        scoreGuide.style.display = 'block';
                        scoreGuide.innerHTML = `
                            <div class="score-guide-compact" style="text-align: center; letter-spacing: -0.5px; display: flex; flex-direction: column; align-items: center;">
                                <div class="score-item" style="text-align: center; width: 100%;">íŠ¹ë³„ì´ˆì„± 2ê¸€ì<span style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">â¤ï¸</span> / 3ê¸€ì<span style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">â¤ï¸</span></div>
                                <div class="score-item" style="text-align: center; width: 100%;">4ê¸€ì<span style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">â¤ï¸â¤ï¸â¤ï¸</span> / 5ê¸€ì+<span style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</span></div>
                                <div class="special-score" style="text-align: center; width: 100%;">íŠ¹ë³„ì´ˆì„±(ã„²ã„¸ã…ƒã…†ã…‰ã…Šã…‹ã…Œã…)</div>
                                <div class="score-item" style="color: #6bff6b; margin-top: 8px; font-weight: bold; text-align: center; width: 100%;">ìµœì†Œ 2ì¸ë¶€í„° ê²Œì„ ì‹œì‘ì´ ê°€ëŠ¥í•´ìš”</div>
                            </div>
                        `;
                    }
                } else {
                    // ì‹œê°„ì œ ëª¨ë“œ: ê¸°ë³¸ ë¬¸êµ¬ë¡œ ë³µì›
                    const startInstruction = document.querySelector('.start-instruction');
                    const scoreGuide = document.querySelector('.score-guide');
                    if (startInstruction) {
                        startInstruction.innerHTML = 'ì œì‹œëœ ì´ˆì„±ìœ¼ë¡œ ìˆœì„œ ìƒê´€ì—†ì´<br>ë§˜ê» ë‹¨ì–´ë¥¼ ë§Œë“œì„¸ìš”!';
                    }
                    if (scoreGuide) {
                        scoreGuide.style.display = 'block';
                        scoreGuide.innerHTML = `
                            <div class="score-guide-compact">
                                <div class="score-item">2ê¸€ì: 10ì </div>
                                <div class="score-item">3ê¸€ì: 100ì </div>
                                <div class="score-item">4ê¸€ì: 400ì </div>
                                <div class="score-item">5ê¸€ì: 900ì </div>
                                <div class="special-score">âœ¨ íŠ¹ë³„ì´ˆì„±(ã„²ã„¸ã…ƒã…†ã…‰ã…Šã…‹ã…Œã…)</div>
                                <div class="special-score-detail">ê° +20ì </div>
                            </div>
                        `;
                    }
                }
                
                joinOngoingGame(roomData);
            } catch (error) {
                console.error('ë°© ì…ì¥ ì‹¤íŒ¨:', error);
                // showToast('ë°© ì…ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤'); // ì œê±°
            }
        }

        function joinOngoingGame(roomData) {
            console.log('[ì…ì¥] ê²Œì„ ì°¸ì—¬ ì‹œë„:', {
                gameStarted: roomData.gameStarted,
                hasConsonants: !!roomData.consonants,
                consonantsLength: roomData.consonants ? roomData.consonants.length : 0,
                startTime: roomData.startTime,
                endTime: roomData.endTime,
                gameMode: roomData.gameMode
            });
            
            // ğŸ†• ê²Œì„ ëª¨ë“œ ì €ì¥
            multiplayerState.gameMode = roomData.gameMode || 'time';
            multiplayerState.players = roomData.players || [];
            
            // ğŸ†• í„´ì œ ëª¨ë“œì¼ ë•Œ bodyì— í´ë˜ìŠ¤ ì¶”ê°€
            updateGameModeUI(multiplayerState.gameMode);

            // ê²Œì„ì´ ì¢…ë£Œëœ ë°©ì´ë©´
            if (roomData.endTime) {
                console.log('[ì…ì¥] âŒ ê²Œì„ì´ ì´ë¯¸ ì¢…ë£Œëœ ë°©ì…ë‹ˆë‹¤');
                // showToast('ê²Œì„ì´ ì´ë¯¸ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤'); // ì œê±°
                leaveRoom();
                return;
            }

            // ê²Œì„ì´ ì‹œì‘ë˜ì—ˆê³  ì´ˆì„±ì´ ìˆìœ¼ë©´ ì°¸ì—¬
            if (roomData.gameStarted === true && 
                roomData.consonants && 
                Array.isArray(roomData.consonants) && 
                roomData.consonants.length > 0) {
                
                console.log('[ì…ì¥] âœ… ê²Œì„ ì°¸ì—¬ - ì´ˆì„±:', roomData.consonants);
                joinActiveGame(roomData);
            } else {
                // ê²Œì„ ëŒ€ê¸° ì¤‘
                console.log('[ì…ì¥] â³ ê²Œì„ ëŒ€ê¸° ì¤‘');
                multiplayerState.lastPlayerCount = roomData.players ? roomData.players.length : 0;
                
                // ğŸ†• ëŒ€ê¸°ì‹¤ í™”ë©´ í‘œì‹œ (ê²Œì„ í™”ë©´ ìˆ¨ê¸°ê³  ì‹œì‘ í™”ë©´ í‘œì‹œ)
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('gameStartSection').classList.remove('hidden');
                
                // ğŸ†• ì…ì¥ ì‹œ ì¦‰ì‹œ ìŠ¬ë¡¯ í‘œì‹œ (í´ë§ ì‹œì‘ ì „ì—ë„)
                updateScoreboard(roomData);
                
                startPolling();
                updateStartScreenButtons();
                // showToast('ê²Œì„ ì‹œì‘ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...'); // ì œê±°
                
                // ğŸ†• í´ë§ ì‹œì‘ í›„ ì¦‰ì‹œ í•œ ë²ˆ ë” ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸ (ì…ì¥ì ë™ê¸°í™” ë³´ì¥)
                setTimeout(() => {
                    if (multiplayerState.isMultiplayer && multiplayerState.roomId) {
                        fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${multiplayerState.roomId}&playerId=${encodeURIComponent(multiplayerState.playerId || '')}`, {
                            cache: 'no-cache'
                        })
                        .then(r => r.json())
                        .then(data => updateScoreboard(data))
                        .catch(err => console.log('[ì…ì¥] ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ (ë¬´ì‹œ):', err));
                    }
                }, 300);
            }
        }

        // í™œì„± ê²Œì„ ì°¸ì—¬ í•¨ìˆ˜
        function joinActiveGame(roomData) {
            // ğŸ†• ì¢…ë£Œ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ë‹«ê¸° (ë°©ì¥ì´ ìƒˆ ê²Œì„ ì‹œì‘ ì‹œ ì°¸ê°€ì ëª¨ë‹¬ ë‹«ê¸°)
            const resultModal = document.querySelector('.mp-result-modal');
            if (resultModal) {
                resultModal.remove();
                // ğŸ†• finished ì†Œë¦¬ í”Œë˜ê·¸ëŠ” ë¦¬ì…‹í•˜ì§€ ì•ŠìŒ (ì´ì „ ê²Œì„ ì¢…ë£Œ ì†Œë¦¬ê°€ ì™„ì „íˆ ëë‚  ë•Œê¹Œì§€ ëŒ€ê¸°)
                // gameState.finishedSoundPlayingì€ audio.onendedì—ì„œë§Œ ë¦¬ì…‹ë¨
                console.log('[ê²Œì„ ì°¸ì—¬] ì¢…ë£Œ ëª¨ë‹¬ ì œê±°');
            }
            
            // ğŸ†• ê²Œì„ ì‹œì‘ ì‹œ ì ìˆ˜ ë©”ì‹œì§€ ì´ˆê¸°í™” (ë‹¨ì–´ ì…ë ¥í•´ì£¼ì„¸ìš” ë©”ì‹œì§€ ì œê±°)
            if (!gameState.isMobile || isPC()) {
                updateEmoji('ğŸ¤”', 'ë‹¨ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 0);
            }
            
            // ê¸°ì¡´ íƒ€ì´ë¨¸ ì •ë¦¬
            if (gameState.gameTimer) clearInterval(gameState.gameTimer);
            
            // ğŸ†• ë¼ìš´ë“œ ë²ˆí˜¸ ì„¤ì •
            multiplayerState.currentRound = roomData.roundNumber || 0;
            console.log(`[ê²Œì„ ì°¸ì—¬] ë¼ìš´ë“œ ${multiplayerState.currentRound}`);
            
            // ğŸ†• ê²Œì„ ëª¨ë“œ ì €ì¥
            multiplayerState.gameMode = roomData.gameMode || 'time';
            console.log(`[ê²Œì„ ì°¸ì—¬] ê²Œì„ ëª¨ë“œ: ${multiplayerState.gameMode}`);
            
            // ğŸ†• BGM êµëŒ€ ì¬ìƒì„ ìœ„í•´ roundCountë¥¼ ì„œë²„ ë¼ìš´ë“œ ë²ˆí˜¸ì™€ ë™ê¸°í™”
            // ì„œë²„ ë¼ìš´ë“œ ë²ˆí˜¸ë¥¼ roundCountë¡œ ì‚¬ìš© (BGM êµëŒ€ ì¬ìƒ)
            gameState.roundCount = roomData.roundNumber || 0;
            
            // ê²Œì„ ìƒíƒœ ì„¤ì •
            gameState.gameRunning = true;
            gameState.currentConsonants = roomData.consonants;
            gameState.score = 0;
            gameState.usedWords = [];
            gameState.wordDefinitions = {}; // ğŸ†• ì´ì „ ë¼ìš´ë“œì˜ ëœ»í’€ì´ ì´ˆê¸°í™”
            
            // ğŸ†• UI ì´ˆê¸°í™” (ì´ì „ ë¼ìš´ë“œì˜ ì”ìƒ ì œê±°)
            if (!gameState.isMobile) {
                updateEmoji('ğŸ¤”', 'ë‹¨ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 0);
                updateDefinition('ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ë©´ ëœ»ì´ í‘œì‹œë©ë‹ˆë‹¤');
            }

            // ë‚¨ì€ ì‹œê°„ ê³„ì‚°
            if (roomData.startTime) {
                const elapsedTime = Math.floor((Date.now() - roomData.startTime) / 1000);
                gameState.timeLeft = Math.max(1, 180 - elapsedTime);
                console.log('[ì…ì¥] ë‚¨ì€ ì‹œê°„:', gameState.timeLeft, 'ì´ˆ');
            } else {
                gameState.timeLeft = 180;
            }
            
            // ì´ˆì„± ë°°ì—´ ë³€ê²½ ì¹´ìš´í„° ì´ˆê¸°í™” (ë‚¨ì€ ì‹œê°„ì— ë”°ë¼)
            if (gameState.timeLeft <= 60) {
                gameState.shuffleCount = 2; // ì´ë¯¸ ë‘ ë²ˆ ë³€ê²½ë¨
            } else if (gameState.timeLeft <= 120) {
                gameState.shuffleCount = 1; // í•œ ë²ˆ ë³€ê²½ë¨
            } else {
                gameState.shuffleCount = 0; // ì•„ì§ ë³€ê²½ ì•ˆ ë¨
            }

            // í™”ë©´ ì „í™˜
            document.getElementById('gameStartSection').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');

            // ë©€í‹°í”Œë ˆì´ ì¤‘ì´ë©´ ìƒˆê²Œì„ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            const resetBtn = document.querySelector('.reset-btn');
            if (resetBtn) resetBtn.style.display = 'none';

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('score').textContent = '0';
            document.getElementById('timer').textContent = gameState.timeLeft;
            displayConsonants(gameState.currentConsonants);
            updateScoreboard(roomData);
            
            // ğŸ†• ê²Œì„ ëª¨ë“œì— ë”°ë¼ UI ì „í™˜ (í„´ëª¨ë“œ ê´€ë ¨ ì½”ë“œ ìœ ì§€)
            const currentGameMode = roomData.gameMode || 'time';
            multiplayerState.gameMode = currentGameMode;
            updateGameModeUI(currentGameMode);
            
            // ğŸ†• BGM ì¬ìƒ (ê²Œì„ ì‹œì‘ ì‹œ)
            if (gameState.bgmEnabled) {
                playBGM();
            }

            // ğŸ†• í„´ì œ ëª¨ë“œì™€ ì‹œê°„ì œ ëª¨ë“œ íƒ€ì´ë¨¸ ë¶„ë¦¬
            if (gameState.gameTimer) {
                clearInterval(gameState.gameTimer);
            }
            if (gameState.turnTimer) {
                clearInterval(gameState.turnTimer);
            }
            
            if (multiplayerState.gameMode === 'turn') {
                // í„´ì œ ëª¨ë“œ: 5ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸
                startTurnModeTimer(roomData);
                
                // ğŸ†• í„´ì œ ëª¨ë“œ: 60ì´ˆë§ˆë‹¤ ì´ˆì„± ëœë¤ ì¬ë°°ì—´
                if (gameState.turnShuffleTimer) {
                    clearInterval(gameState.turnShuffleTimer);
                }
                const gameStartTime = roomData.startTime || Date.now();
                gameState.turnShuffleCount = 0; // ì¬ë°°ì—´ íšŸìˆ˜ ì¶”ì 
                
                gameState.turnShuffleTimer = setInterval(() => {
                    if (!gameState.gameRunning) {
                        clearInterval(gameState.turnShuffleTimer);
                        return;
                    }
                    
                    const elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
                    // 60ì´ˆë§ˆë‹¤ ì¬ë°°ì—´ (60ì´ˆ, 120ì´ˆ, 180ì´ˆ...)
                    if (elapsed > 0 && elapsed % 60 === 0 && elapsed / 60 > gameState.turnShuffleCount) {
                        gameState.turnShuffleCount = elapsed / 60;
                        shuffleConsonants('random');
                        console.log(`[í„´ì œ] ${elapsed}ì´ˆ ê²½ê³¼ - ì´ˆì„± ëœë¤ ì¬ë°°ì—´`);
                    }
                }, 1000); // 1ì´ˆë§ˆë‹¤ ì²´í¬
            } else {
                // ì‹œê°„ì œ ëª¨ë“œ: ê¸°ì¡´ 180ì´ˆ íƒ€ì´ë¨¸
                gameState.gameTimer = setInterval(() => {
                    // ê²Œì„ì´ ì§„í–‰ ì¤‘ì¼ ë•Œë§Œ ì‹œê°„ ê°ì†Œ
                    if (!gameState.gameRunning) {
                        return;
                    }
                    
                    gameState.timeLeft--;
                    document.getElementById('timer').textContent = gameState.timeLeft;
                    
                    // ë©€í‹°í”Œë ˆì´ì–´: ì´ˆì„± ë°°ì—´ ë³€ê²½ ì²´í¬
                    if (gameState.timeLeft <= 120 && gameState.shuffleCount === 0) {
                        shuffleConsonants('reverse');
                        gameState.shuffleCount = 1;
                    } else if (gameState.timeLeft <= 60 && gameState.shuffleCount === 1) {
                        shuffleConsonants('random');
                        gameState.shuffleCount = 2;
                    }
                    
                    if (gameState.timeLeft === 10) {
                        document.body.classList.add('time-warning');
                        if (gameState.sfxEnabled) playTickSound();
                        if (bgmAudio && gameState.bgmEnabled) fadeOutBGM();  // ğŸ†• BGM í˜ì´ë“œì•„ì›ƒ
                    }
                    
                    if (gameState.timeLeft <= 0) {
                        clearInterval(gameState.gameTimer);
                        gameState.gameRunning = false;
                        endGame();
                    }
                }, 1000);
            }

            startPolling();
            // showToast('ğŸ® ê²Œì„ì— ì°¸ì—¬í–ˆìŠµë‹ˆë‹¤!'); // ì œê±°
            
            // ğŸ†• BGM ì¬ìƒ (ë©€í‹°í”Œë ˆì´ë„!)
            if (gameState.bgmEnabled) playBGM();
            
            const input = document.getElementById('wordInput');
            input.value = '';
            setTimeout(() => input.focus(), 300);
        }

        function showNameModal() {
            const modal = document.getElementById('mpNameModal');
            const input = document.getElementById('mpNameInput');
            const messageEl = document.getElementById('mpNameMessage');
            
            // ì´ë¦„ ë³€ê²½ì¸ ê²½ìš° í˜„ì¬ ì´ë¦„ í‘œì‹œ, ë°© ì…ì¥ì¸ ê²½ìš° ë¹ˆ ê°’
            if (multiplayerState.pendingRoomId === 'CHANGE_NAME') {
                const currentName = localStorage.getItem('playerName');
                input.value = currentName || '';
                // ğŸš€ ì´ë¦„ ë³€ê²½ ëª¨ë“œ: 7ì¼ ì œí•œ ì²´í¬ (localStorageì— ì´ë¦„ì´ ìˆì„ ë•Œë§Œ)
                if (currentName) {
                    const lastChange = localStorage.getItem('playerNameLastChange');
                    if (lastChange) {
                        const daysSinceChange = (Date.now() - parseInt(lastChange)) / (1000 * 60 * 60 * 24);
                        if (daysSinceChange < 7) {
                            const daysLeft = Math.ceil(7 - daysSinceChange);
                            messageEl.textContent = `ë‹‰ë„¤ì„ì€ ${daysLeft}ì¼ í›„ì— ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
                            messageEl.className = 'mp-name-message info';
                            messageEl.style.display = 'block';
                        } else {
                            messageEl.style.display = 'none';
                        }
                    } else {
                        messageEl.style.display = 'none';
                    }
                } else {
                    // ğŸš€ localStorageì— ì´ë¦„ì´ ì—†ìœ¼ë©´ (ì‹œí¬ë¦¿ ëª¨ë“œ ë“±) ì²˜ìŒ ì…ë ¥ìœ¼ë¡œ ì²˜ë¦¬
                    messageEl.style.display = 'none';
                }
            } else {
                // ğŸš€ ì²˜ìŒ ì…ë ¥ ëª¨ë“œ: 1ì£¼ì¼ ì œí•œ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
                input.value = '';
                const hasExistingName = localStorage.getItem('playerName');
                if (!hasExistingName) {
                    messageEl.textContent = 'ì„¤ì •í•œ ë‹‰ë„¤ì„ì€ 1ì£¼ì¼ ë™ì•ˆ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                    messageEl.className = 'mp-name-message info';
                    messageEl.style.display = 'block';
                } else {
                    messageEl.style.display = 'none';
                }
            }
            modal.classList.remove('hidden');
            input.focus();
        }
        
        // ğŸš€ ëª¨ë‹¬ ë©”ì‹œì§€ í‘œì‹œ í—¬í¼ í•¨ìˆ˜
        function showNameModalMessage(text, type = 'info') {
            const messageEl = document.getElementById('mpNameMessage');
            messageEl.textContent = text;
            messageEl.className = `mp-name-message ${type}`;
            messageEl.style.display = 'block';
        }
        
        function hideNameModalMessage() {
            const messageEl = document.getElementById('mpNameMessage');
            messageEl.style.display = 'none';
        }

        function confirmName() {
            const input = document.getElementById('mpNameInput');
            const name = input.value.trim();
            if (!name) {
                showNameModalMessage('âš ï¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                input.focus(); // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤ ìœ ì§€
                return;
            }
            
            // ì´ë¦„ ë³€ê²½ì¸ ê²½ìš° (ë°© ì…ì¥ì´ ì•„ë‹Œ ê²½ìš°)
            if (multiplayerState.pendingRoomId === 'CHANGE_NAME') {
                // ğŸš€ 7ì¼ ì œí•œ ì²´í¬ (localStorageì— playerNameì´ ìˆì„ ë•Œë§Œ ì²´í¬)
                const existingName = localStorage.getItem('playerName');
                if (existingName) {
                    const lastChange = localStorage.getItem('playerNameLastChange');
                    if (lastChange) {
                        const daysSinceChange = (Date.now() - parseInt(lastChange)) / (1000 * 60 * 60 * 24);
                        if (daysSinceChange < 7) {
                            const daysLeft = Math.ceil(7 - daysSinceChange);
                            showNameModalMessage(`ë‹‰ë„¤ì„ì€ ${daysLeft}ì¼ í›„ì— ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`, 'error');
                            input.focus();
                            return;
                        }
                    }
                }
                // ğŸš€ localStorageì— ì´ë¦„ì´ ì—†ìœ¼ë©´ (ì‹œí¬ë¦¿ ëª¨ë“œ ë“±) ì²˜ìŒ ì…ë ¥ìœ¼ë¡œ ì²˜ë¦¬
                
                // 7ì¼ ê²½ê³¼í–ˆê±°ë‚˜ ì²˜ìŒ ë³€ê²½í•˜ëŠ” ê²½ìš°
                localStorage.setItem('playerName', name);
                localStorage.setItem('playerNameLastChange', Date.now().toString());
                multiplayerState.playerName = name;
                document.getElementById('mpNameModal').classList.add('hidden');
                hideNameModalMessage();
                showToast('ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
                multiplayerState.pendingRoomId = null;
                return;
            }
            
            // ë°© ì…ì¥ì„ ìœ„í•œ ì´ë¦„ ì…ë ¥
            const hasExistingName = localStorage.getItem('playerName');
            localStorage.setItem('playerName', name);
            // ğŸš€ ì²˜ìŒ ì´ë¦„ ì„¤ì • ì‹œ ë³€ê²½ ì‹œê°„ ì €ì¥
            if (!hasExistingName) {
                localStorage.setItem('playerNameLastChange', Date.now().toString());
            }
            multiplayerState.playerName = name;
            document.getElementById('mpNameModal').classList.add('hidden');
            hideNameModalMessage();
            if (multiplayerState.pendingRoomId === 'CREATE_NEW') {
                // ğŸ†• ë°© ì œëª©ê³¼ ê²Œì„ ëª¨ë“œê°€ ìˆìœ¼ë©´ í•¨ê»˜ ì „ë‹¬
                const roomTitle = multiplayerState.pendingRoomTitle || null;
                const gameMode = multiplayerState.pendingGameMode || 'time';
                createRoomAndStart(name, roomTitle, gameMode);
                multiplayerState.pendingRoomTitle = null;
                multiplayerState.pendingGameMode = null;
            } else if (multiplayerState.pendingRoomId) {
                joinRoomWithName(multiplayerState.pendingRoomId, name);
            }
            multiplayerState.pendingRoomId = null;
        }

        function cancelName() {
            document.getElementById('mpNameModal').classList.add('hidden');
            hideNameModalMessage(); // ğŸš€ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            multiplayerState.pendingRoomId = null;
        }

        function startPolling() {
            if (multiplayerState.pollingInterval) clearInterval(multiplayerState.pollingInterval);
            
            // ğŸ†• ì—ëŸ¬ ì¹´ìš´í„° ì´ˆê¸°í™”
            if (!multiplayerState.pollingErrorCount) {
                multiplayerState.pollingErrorCount = 0;
            }
            
            multiplayerState.pollingInterval = setInterval(async () => {
                if (!multiplayerState.isMultiplayer || !multiplayerState.roomId) return;
                
                try {
                    // ğŸ†• íƒ€ì„ì•„ì›ƒ ì„¤ì • (5ì´ˆë¡œ ì¦ê°€) - ë„¤íŠ¸ì›Œí¬ ì§€ì—° ëŒ€ì‘
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000);
                    
                    const response = await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${multiplayerState.roomId}&playerId=${encodeURIComponent(multiplayerState.playerId || '')}`, {
                        signal: controller.signal,
                        cache: 'no-cache' // ğŸ†• ìºì‹œ ë°©ì§€ë¡œ ìµœì‹  ë°ì´í„° ë³´ì¥
                    });
                    
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    const roomData = await response.json();
                    
                    // ğŸ†• ìµœì‹  roomData ì €ì¥ (checkWordì—ì„œ íƒˆë½ì ì²´í¬ìš©)
                    multiplayerState.lastRoomData = roomData;
                    
                    // ğŸ†• ì„±ê³µ ì‹œ ì—ëŸ¬ ì¹´ìš´í„° ë¦¬ì…‹
                    multiplayerState.pollingErrorCount = 0;
                    
                    // ğŸ†• ë¼ìš´ë“œ ë²ˆí˜¸ ê¸°ë°˜ ìƒíƒœ ì²´í¬
                    const serverRound = roomData.roundNumber || 0;
                    const clientRound = multiplayerState.currentRound;
                    
                    // 1. ê²Œì„ ì¢…ë£Œ ê°ì§€ (ê°™ì€ ë¼ìš´ë“œì´ê³  endTime ìˆìŒ)
                    if (roomData.endTime && serverRound === clientRound && !document.querySelector('.mp-result-modal')) {
                        console.log(`ğŸ”´ ê²Œì„ ì¢…ë£Œ ê°ì§€! (ë¼ìš´ë“œ ${serverRound})`);
                        
                        // ğŸš€ ê²Œì„ ì¢…ë£Œ ì‹œ íƒ€ì´ë¨¸ ì •ì§€
                        if (gameState.turnTimer) {
                            clearInterval(gameState.turnTimer);
                            gameState.turnTimer = null;
                        }
                        
                        // ğŸš€ íƒˆë½ì ì „ìš© ë‚˜ê°€ê¸° ë²„íŠ¼ ì œê±° (ëª¨ë“  ìœ ì €ì—ê²Œ ë‚˜ê°€ê¸° ë²„íŠ¼ í‘œì‹œë¨)
                        const turnModeLeaveBtn = document.getElementById('turnModeLeaveBtn');
                        if (turnModeLeaveBtn) {
                            turnModeLeaveBtn.classList.add('hidden');
                            turnModeLeaveBtn.style.display = 'none';
                        }
                        
                        // ê²Œì„ í™”ë©´ ìˆ¨ê¸°ê¸°
                        document.getElementById('gameScreen').classList.add('hidden');
                        document.getElementById('gameStartSection').classList.remove('hidden');
                        
                        // ê²°ê³¼ í™”ë©´ í‘œì‹œ
                        showFinalResults(roomData);
                        return;
                    }
                    
                    // 2. ìƒˆ ê²Œì„ ì‹œì‘ ê°ì§€ (ë¼ìš´ë“œ ë²ˆí˜¸ê°€ ì¦ê°€í•¨)
                    if (serverRound > clientRound && roomData.gameStarted && roomData.consonants) {
                        console.log(`ğŸŸ¢ ìƒˆ ë¼ìš´ë“œ ì‹œì‘! (${clientRound} â†’ ${serverRound})`);
                        
                        // ê²°ê³¼ í™”ë©´ ë‹«ê¸°
                        document.querySelector('.mp-result-modal')?.remove();
                        // ğŸ†• finished ì†Œë¦¬ í”Œë˜ê·¸ëŠ” ë¦¬ì…‹í•˜ì§€ ì•ŠìŒ (ì´ì „ ê²Œì„ ì¢…ë£Œ ì†Œë¦¬ê°€ ì™„ì „íˆ ëë‚  ë•Œê¹Œì§€ ëŒ€ê¸°)
                        
                        // ë¼ìš´ë“œ ë²ˆí˜¸ ë° ì ìˆ˜ íŒì—… ìƒíƒœ ì—…ë°ì´íŠ¸
                        multiplayerState.currentRound = serverRound;
                        multiplayerState.previousWordCounts = {};
                        
                        // ê²Œì„ ì°¸ì—¬
                        joinActiveGame(roomData);
                        return;
                    }
                    
                    // ğŸ†• ê²Œì„ì´ ì§„í–‰ ì¤‘ì¸ë° ì•„ì§ ì°¸ì—¬í•˜ì§€ ì•Šì€ ê²½ìš° (ì¤‘ê°„ í•©ë¥˜)
                    // ê²Œì„ì´ ì‹œì‘ë˜ì—ˆê³ , ì´ˆì„±ì´ ìˆê³ , ê²Œì„ì´ ì¢…ë£Œë˜ì§€ ì•Šì•˜ê³ , ì•„ì§ ê²Œì„ì— ì°¸ì—¬í•˜ì§€ ì•Šì•˜ìœ¼ë©´
                    if (roomData.gameStarted && 
                        roomData.consonants && 
                        Array.isArray(roomData.consonants) && 
                        roomData.consonants.length > 0 &&
                        !roomData.endTime &&
                        !gameState.gameRunning) { // ê²Œì„ì´ ì‹¤í–‰ ì¤‘ì´ ì•„ë‹ˆë©´ (ì•„ì§ ì°¸ì—¬ ì•ˆ í•¨)
                        console.log(`ğŸŸ¡ [ì¤‘ê°„ í•©ë¥˜] ê²Œì„ ì§„í–‰ ì¤‘ ì°¸ì—¬! (ë¼ìš´ë“œ ${serverRound}, ë‚¨ì€ ì‹œê°„: ${roomData.timeLeft || 'ê³„ì‚° ì¤‘'})`);
                        
                        // ë¼ìš´ë“œ ë²ˆí˜¸ ë° ì ìˆ˜ íŒì—… ìƒíƒœ ì—…ë°ì´íŠ¸
                        multiplayerState.currentRound = serverRound;
                        multiplayerState.previousWordCounts = {};
                        
                        // ê²Œì„ ì°¸ì—¬
                        joinActiveGame(roomData);
                        return;
                    }
                    
                    // 3. í”Œë ˆì´ì–´ ìˆ˜ ë³€ê²½ ê°ì§€ ë° ë°©ì¥ ë³€ê²½ ì²´í¬
                    if (roomData.players && roomData.players.length !== multiplayerState.lastPlayerCount) {
                        const previousCount = multiplayerState.lastPlayerCount;
                        const currentCount = roomData.players.length;
                        
                        if (currentCount > previousCount) {
                            // í”Œë ˆì´ì–´ ì…ì¥
                            const newPlayer = roomData.players[currentCount - 1];
                            // showToast(`${newPlayer.name}ë‹˜ì´ ì…ì¥í–ˆìŠµë‹ˆë‹¤`); // ì œê±°
                            // ì…ì¥ íš¨ê³¼ìŒ ì¬ìƒ
                            if (gameState.sfxEnabled) {
                                try {
                                    const enterSound = new Audio('./sound/enter.mp3');
                                    enterSound.volume = 0.5;
                                    enterSound.play().catch(e => console.log('ì…ì¥ ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', e));
                                } catch (e) {
                                    console.log('ì…ì¥ ì†Œë¦¬ ë¡œë“œ ì‹¤íŒ¨:', e);
                                }
                            }
                        } else if (currentCount < previousCount) {
                            // í”Œë ˆì´ì–´ í‡´ì¥
                            // í‡´ì¥ íš¨ê³¼ìŒ ì¬ìƒ
                            if (gameState.sfxEnabled) {
                                try {
                                    const outSound = new Audio('./sound/out.mp3');
                                    outSound.volume = 0.5;
                                    outSound.play().catch(e => console.log('í‡´ì¥ ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', e));
                                } catch (e) {
                                    console.log('í‡´ì¥ ì†Œë¦¬ ë¡œë“œ ì‹¤íŒ¨:', e);
                                }
                            }
                            
                            // ë°©ì¥ ë³€ê²½ ì²´í¬: ì²« ë²ˆì§¸ í”Œë ˆì´ì–´ê°€ ë°©ì¥
                            const newHostId = roomData.players.length > 0 ? roomData.players[0].id : null;
                            let hostChanged = false;

                            if (newHostId && newHostId === multiplayerState.playerId && !multiplayerState.isHost) {
                                // ë‚´ê°€ ìƒˆ ë°©ì¥ì´ ë¨
                                multiplayerState.isHost = true;
                                hostChanged = true;
                                // showToast('ğŸ‰ ë°©ì¥ì´ ë˜ì—ˆìŠµë‹ˆë‹¤!'); // ì œê±°
                            } else if (multiplayerState.isHost && newHostId !== multiplayerState.playerId) {
                                // ë‚´ê°€ ë°©ì¥ì´ì—ˆëŠ”ë° ë‹¤ë¥¸ ì‚¬ëŒì´ ë°©ì¥ì´ ë¨ (ì´ë¡ ì ìœ¼ë¡œëŠ” ë°œìƒí•˜ì§€ ì•Šì•„ì•¼ í•¨)
                                multiplayerState.isHost = false;
                                hostChanged = true;
                            }

                            if (hostChanged) {
                                // ë°©ì¥ ë³€ê²½ ì‹œ ëŒ€ê¸°ì‹¤ ë²„íŠ¼/ì•ˆë‚´ ì¦‰ì‹œ ê°±ì‹ 
                                updateStartScreenButtons();
                                if (roomData.gameMode === 'turn') {
                                    updateGameModeUI('turn');
                                }
                                
                                // ğŸ†• ê²°ê³¼ ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ë²„íŠ¼ë„ ì—…ë°ì´íŠ¸
                                const resultModal = document.querySelector('.mp-result-modal');
                                if (resultModal) {
                                    const buttonsContainer = resultModal.querySelector('.mp-result-buttons');
                                    if (buttonsContainer) {
                                        buttonsContainer.innerHTML = `
                                            ${multiplayerState.isHost 
                                                ? '<button class="mp-result-btn replay" onclick="restartMultiplayerGame()">ë‹¤ì‹œí•˜ê¸°</button>' 
                                                : '<div class="mp-waiting-message">ë°©ì¥ì´ ë‹¤ìŒ ê²Œì„ì„ ì‹œì‘í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>'}
                                            <button class="mp-result-btn home" onclick="goToHome()">ë°© ë‚˜ê°€ê¸°</button>
                                        `;
                                    }
                                }
                            }
                        }
                        
                        multiplayerState.lastPlayerCount = currentCount;
                    }
                    
                    // ğŸ†• í•­ìƒ ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸ (ê²Œì„ ì‹¤í–‰ ì¤‘ì´ì–´ë„ í”Œë ˆì´ì–´ ëª©ë¡ ë™ê¸°í™”)
                    updateScoreboard(roomData);
                
                // ğŸ†• í„´ì œ ëª¨ë“œ: í„´ ì „í™˜ ê°ì§€ ë° íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
                if (roomData.gameMode === 'turn' && gameState.gameRunning) {
                    const currentTurnChanged = roomData.currentTurnPlayerId !== multiplayerState.lastTurnPlayerId;
                    const turnStartTimeChanged = roomData.turnStartTime !== multiplayerState.lastTurnStartTime;
                    
                    // ğŸ†• í„´ ì „í™˜ì´ ì‹¤ì œë¡œ ë°œìƒí–ˆì„ ë•Œë§Œ ì²˜ë¦¬ (ì¤‘ë³µ ë°©ì§€)
                    if (currentTurnChanged || (turnStartTimeChanged && roomData.currentTurnPlayerId)) {
                        console.log('[í„´ì œ] í„´ ì „í™˜ ê°ì§€:', roomData.currentTurnPlayerId, 'ì´ì „:', multiplayerState.lastTurnPlayerId);
                        multiplayerState.lastTurnPlayerId = roomData.currentTurnPlayerId;
                        multiplayerState.lastTurnStartTime = roomData.turnStartTime;
                        
                        // íƒ€ì´ë¨¸ ì¬ì‹œì‘
                        if (gameState.turnTimer) {
                            clearInterval(gameState.turnTimer);
                            gameState.turnTimer = null;
                        }
                        startTurnModeTimer(roomData);
                    }
                    
                    // ì‚¬ìš©ëœ ë‹¨ì–´ ì˜ì—­ ì—…ë°ì´íŠ¸
                    if (roomData.usedWords) {
                        const previousWordsCount = multiplayerState.lastUsedWordsCount || 0;
                        const currentWordsCount = roomData.usedWords.length;
                        
                        // ğŸ†• ìƒëŒ€ë°©ì´ ë‹¨ì–´ë¥¼ ë§ì·„ëŠ”ì§€ ê°ì§€ (ë‹¨ì–´ ìˆ˜ê°€ ì¦ê°€í–ˆê³ , ìì‹ ì´ ë°©ê¸ˆ ì…ë ¥í•˜ì§€ ì•Šì•˜ì„ ë•Œ)
                        if (currentWordsCount > previousWordsCount && 
                            roomData.currentTurnPlayerId !== multiplayerState.playerId &&
                            !multiplayerState.justSubmittedWord) { // ğŸ†• ìì‹ ì´ ë°©ê¸ˆ ì…ë ¥í•œ ê²½ìš° ì œì™¸
                            // ìƒëŒ€ë°©ì´ ë‹¨ì–´ë¥¼ ë§ì¶¤ - íš¨ê³¼ìŒ ì¬ìƒ
                            const newWord = roomData.usedWords[currentWordsCount - 1];
                            if (newWord) {
                                // ë§ˆì§€ë§‰ ë‹¨ì–´ì˜ ê¸¸ì´ë¡œ ìƒëª…ê¶Œ íšë“ ì—¬ë¶€ ì¶”ì •
                                const wordLength = newWord.length;
                                // íŠ¹ë³„ì´ˆì„± ì²´í¬ëŠ” ì–´ë µì§€ë§Œ, ë‹¨ì–´ ê¸¸ì´ë¡œ ëŒ€ëµ ì¶”ì •
                                let livesEarned = 0;
                                if (wordLength === 2) {
                                    // 2ê¸€ìëŠ” íŠ¹ë³„ì´ˆì„± ì—¬ë¶€ë¥¼ ì•Œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ìƒëª…ê¶Œ íšë“ ê°€ëŠ¥ì„± ìˆìŒ
                                    // í•˜ì§€ë§Œ ì¼ë°˜ 2ê¸€ìëŠ” 0ê°œì´ë¯€ë¡œ, ì¼ë‹¨ 30.mp3 ì¬ìƒ
                                    livesEarned = 0;
                                } else if (wordLength === 3) {
                                    livesEarned = 1;
                                } else if (wordLength === 4) {
                                    livesEarned = 3;
                                } else if (wordLength >= 5) {
                                    livesEarned = 5;
                                }
                                
                                // íš¨ê³¼ìŒ ì¬ìƒ
                                if (livesEarned >= 1) {
                                    playScoreSound(100); // ìƒëª…ê¶Œ íšë“
                                } else {
                                    playScoreSound(30); // ìƒëª…ê¶Œ ë¯¸íšë“
                                }
                            }
                        }
                        
                        // ğŸ†• ìµœê·¼ 100ê°œë§Œ ì €ì¥ (ë©”ëª¨ë¦¬ ì ˆì•½, ì„œë²„ì—ì„œ ì´ë¯¸ 100ê°œë§Œ ë³´ë‚´ì£¼ì§€ë§Œ ì•ˆì „ì„ ìœ„í•´ í´ë¼ì´ì–¸íŠ¸ì—ì„œë„ ì œí•œ)
                        const limitedUsedWords = Array.isArray(roomData.usedWords) 
                            ? roomData.usedWords.slice(-100) 
                            : [];
                        multiplayerState.usedWords = limitedUsedWords; // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¤‘ë³µ ì²´í¬ìš© (ìµœê·¼ 100ê°œë§Œ)
                        multiplayerState.lastUsedWordsCount = currentWordsCount; // ì¶”ì ìš©
                        updateTurnModeUsedWords(limitedUsedWords); // ìµœê·¼ 100ê°œë§Œ í‘œì‹œ
                    }
                    
                    // ğŸ†• ìƒëª…ê¶Œ ì†Œì§„ íš¨ê³¼ìŒ ì¬ìƒ (ê²Œì„ ì¢…ë£Œ ì‹œ ì •ì§€)
                    // ğŸš€ ê²Œì„ ì¢…ë£Œ ì‹œ(endTimeì´ ì„¤ì •ë˜ë©´) ìƒëª…ê¶Œ ì†Œì§„ íš¨ê³¼ìŒ ì¬ìƒ ì•ˆ í•¨
                    if (!roomData.endTime && roomData.playerLives) {
                        const currentLives = roomData.playerLives;
                        const lastLives = multiplayerState.lastPlayerLives || {};
                        
                        // ê° í”Œë ˆì´ì–´ì˜ ìƒëª…ê¶Œ ë³€í™” í™•ì¸
                        Object.keys(currentLives).forEach(playerId => {
                            const currentLife = currentLives[playerId] || 0;
                            const lastLife = lastLives[playerId] || 0;
                            
                            // ìƒëª…ê¶Œì´ ê°ì†Œí–ˆì„ ë•Œ (ì†Œì§„)
                            if (currentLife < lastLife) {
                                // heart.mp3 ì¬ìƒ (ëª¨ë‘ì—ê²Œ ë“¤ë¦¼)
                                if (gameState.sfxEnabled) {
                                    try {
                                        const heartSound = new Audio('./sound/heart.mp3');
                                        heartSound.volume = 0.6;
                                        heartSound.play().catch(err => console.log('[í„´ì œ] ìƒëª…ê¶Œ ì†Œì§„ íš¨ê³¼ìŒ ì¬ìƒ ì‹¤íŒ¨:', err));
                                    } catch (err) {
                                        console.log('[í„´ì œ] ìƒëª…ê¶Œ ì†Œì§„ íš¨ê³¼ìŒ ë¡œë“œ ì‹¤íŒ¨:', err);
                                    }
                                }
                            }
                        });
                        
                        // ì´ì „ ìƒíƒœ ì €ì¥
                        multiplayerState.lastPlayerLives = { ...currentLives };
                    }
                    
                    // ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸ (ìƒëª…ê¶Œ, í„´ íšŸìˆ˜)
                    updateScoreboard(roomData);
                    
                    // ê²Œì„ ì¢…ë£Œ ì²´í¬ (1ëª…ë§Œ ë‚¨ìœ¼ë©´)
                    const activePlayers = (roomData.players || []).filter(p => 
                        !roomData.eliminatedPlayers?.includes(p.id)
                    );
                    if (activePlayers.length <= 1 && !roomData.endTime) {
                        // ì„œë²„ì— ê²Œì„ ì¢…ë£Œ ì‹ í˜¸ ì „ì†¡ (ë°©ì¥ë§Œ)
                        if (multiplayerState.isHost) {
                            fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${multiplayerState.roomId}`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ action: 'end_game' })
                            }).catch(err => console.error('ê²Œì„ ì¢…ë£Œ ì „ì†¡ ì‹¤íŒ¨:', err));
                        }
                    }
                } else if (gameState.gameRunning) {
                    // ì‹œê°„ì œ ëª¨ë“œ: ê¸°ì¡´ ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸
                    updateScoreboard(roomData);
                }
                
                // ğŸ†• ë°©ì¥ ìƒíƒœ ë™ê¸°í™” (í”Œë ˆì´ì–´ ìˆ˜ ë³€ê²½ì´ ì—†ì–´ë„ ì²´í¬)
                    if (roomData.players && roomData.players.length > 0) {
                        const currentHostId = roomData.players[0].id;
                        const shouldBeHost = currentHostId === multiplayerState.playerId;
                        if (shouldBeHost !== multiplayerState.isHost) {
                            multiplayerState.isHost = shouldBeHost;
                            // ë°©ì¥ ìƒíƒœê°€ ë°”ë€Œë©´ UIë„ ì¦‰ì‹œ ë°˜ì˜
                            updateStartScreenButtons();
                            if (roomData.gameMode === 'turn') {
                                updateGameModeUI('turn');
                            }
                        }
                    }
                    
                    // ğŸ†• í„´ì œ ëª¨ë“œ: í„´ ì „í™˜ ê°ì§€ ë° íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
                    if (roomData.gameMode === 'turn' && gameState.gameRunning) {
                        // ğŸ†• players ë°°ì—´ í•­ìƒ ì—…ë°ì´íŠ¸ (í„´ ì „í™˜ ê°ì§€ ì „ì—)
                        multiplayerState.players = roomData.players || [];
                        
                        // ğŸ†• íƒˆë½ íš¨ê³¼ìŒ: eliminatedPlayers ë³€í™” ê°ì§€ (2~5ë“± íƒˆë½ ì‹œë§Œ ì¬ìƒ)
                        const previousEliminated = multiplayerState.lastEliminatedPlayers || [];
                        const currentEliminated = roomData.eliminatedPlayers || [];
                        if (currentEliminated.length > previousEliminated.length) {
                            // ìƒˆë¡œìš´ íƒˆë½ìê°€ ìƒê¹€
                            const newEliminated = currentEliminated.filter(id => !previousEliminated.includes(id));
                            if (newEliminated.length > 0) {
                                // í™œì„± í”Œë ˆì´ì–´ ìˆ˜ ê³„ì‚° (2ëª… ì´ìƒ ë‚¨ì•„ìˆìœ¼ë©´ 2~5ë“± íƒˆë½)
                                const activePlayers = (roomData.players || []).filter(p => 
                                    !currentEliminated.includes(p.id)
                                );
                                // 2~5ë“± íƒˆë½ ì‹œì—ë§Œ íš¨ê³¼ìŒ ì¬ìƒ (í™œì„± í”Œë ˆì´ì–´ê°€ 1ëª… ì´ìƒ ë‚¨ì•„ìˆì„ ë•Œ)
                                if (activePlayers.length >= 1 && gameState.sfxEnabled) {
                                    try {
                                        const turndeathSound = new Audio('./sound/turndeath.mp3');
                                        turndeathSound.volume = 0.7;
                                        turndeathSound.play().catch(e => console.log('íƒˆë½ íš¨ê³¼ìŒ ì¬ìƒ ì‹¤íŒ¨:', e));
                                        console.log(`[í„´ì œ] íƒˆë½ íš¨ê³¼ìŒ ì¬ìƒ: ${newEliminated.join(', ')} íƒˆë½`);
                                    } catch (e) {
                                        console.log('íƒˆë½ íš¨ê³¼ìŒ ë¡œë“œ ì‹¤íŒ¨:', e);
                                    }
                                }
                            }
                        }
                        multiplayerState.lastEliminatedPlayers = [...currentEliminated]; // ë³µì‚¬ë³¸ ì €ì¥
                        
                        const currentTurnChanged = roomData.currentTurnPlayerId !== multiplayerState.lastTurnPlayerId;
                        const turnStartTimeChanged = roomData.turnStartTime !== multiplayerState.lastTurnStartTime;
                        
                        if (currentTurnChanged || turnStartTimeChanged) {
                            console.log('[í„´ì œ] í„´ ì „í™˜ ê°ì§€:', roomData.currentTurnPlayerId, 'ì´ì „:', multiplayerState.lastTurnPlayerId);
                            multiplayerState.lastTurnPlayerId = roomData.currentTurnPlayerId;
                            multiplayerState.lastTurnStartTime = roomData.turnStartTime;
                            
                            // íƒ€ì´ë¨¸ ì¬ì‹œì‘
                            if (gameState.turnTimer) {
                                clearInterval(gameState.turnTimer);
                                gameState.turnTimer = null;
                            }
                            startTurnModeTimer(roomData);
                        }
                        
                        // ì‚¬ìš©ëœ ë‹¨ì–´ ì˜ì—­ ì—…ë°ì´íŠ¸
                        if (roomData.usedWords) {
                            multiplayerState.usedWords = roomData.usedWords; // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¤‘ë³µ ì²´í¬ìš©
                            updateTurnModeUsedWords(roomData.usedWords);
                        }
                        
                        // ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸ (ìƒëª…ê¶Œ, í„´ íšŸìˆ˜)
                        updateScoreboard(roomData);
                        
                        // ê²Œì„ ì¢…ë£Œ ì²´í¬ (1ëª…ë§Œ ë‚¨ìœ¼ë©´)
                        const activePlayers = (roomData.players || []).filter(p => 
                            !roomData.eliminatedPlayers?.includes(p.id)
                        );
                        if (activePlayers.length <= 1 && !roomData.endTime) {
                            // ì„œë²„ì— ê²Œì„ ì¢…ë£Œ ì‹ í˜¸ ì „ì†¡ (ë°©ì¥ë§Œ)
                            if (multiplayerState.isHost) {
                                fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${multiplayerState.roomId}`, {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({ action: 'end_game' })
                                }).catch(err => console.error('ê²Œì„ ì¢…ë£Œ ì „ì†¡ ì‹¤íŒ¨:', err));
                            }
                        }
                    } else {
                        // ì‹œê°„ì œ ëª¨ë“œ: ê¸°ì¡´ ë¡œì§
                        // 4. ì ìˆ˜íŒ ì—…ë°ì´íŠ¸ (í•­ìƒ ì—…ë°ì´íŠ¸ - ê²Œì„ ì¤‘/ëŒ€ê¸° ì¤‘ ëª¨ë‘)
                        updateScoreboard(roomData);
                    }
                    
                    // ğŸ†• ë©€í‹°í”Œë ˆì´ì–´: ì„œë²„ startTime ê¸°ì¤€ìœ¼ë¡œ íƒ€ì´ë¨¸ ë™ê¸°í™” (ë¶€ë“œëŸ¬ìš´ ë³´ì •) - ì‹œê°„ì œ ëª¨ë“œë§Œ
                    if (gameState.gameRunning && roomData.startTime && roomData.gameMode !== 'turn') {
                        const elapsedTime = Math.floor((Date.now() - roomData.startTime) / 1000);
                        const serverTimeLeft = Math.max(0, 180 - elapsedTime);
                        
                        // ì„œë²„ ì‹œê°„ê³¼ í´ë¼ì´ì–¸íŠ¸ ì‹œê°„ ì°¨ì´ ê³„ì‚°
                        const timeDiff = serverTimeLeft - gameState.timeLeft;
                        
                        // ì°¨ì´ê°€ 3ì´ˆ ì´ìƒì´ë©´ ì¦‰ì‹œ ë™ê¸°í™” (í° ì˜¤ì°¨ëŠ” ë°”ë¡œ ìˆ˜ì •)
                        if (Math.abs(timeDiff) >= 3) {
                            gameState.timeLeft = serverTimeLeft;
                            document.getElementById('timer').textContent = serverTimeLeft;
                        }
                        // ì°¨ì´ê°€ 1.5ì´ˆ ì´ìƒ 3ì´ˆ ë¯¸ë§Œì´ë©´ ì ì§„ì ìœ¼ë¡œ ë³´ì • (ë¶€ë“œëŸ¬ìš´ ë™ê¸°í™”)
                        else if (Math.abs(timeDiff) >= 1.5) {
                            // ì°¨ì´ì˜ 20%ë§Œ ë³´ì •í•˜ì—¬ ê¸‰ê²©í•œ ë³€í™” ë°©ì§€
                            const correction = Math.round(timeDiff * 0.2);
                            gameState.timeLeft = Math.max(0, gameState.timeLeft + correction);
                            document.getElementById('timer').textContent = gameState.timeLeft;
                        }
                        // 1.5ì´ˆ ë¯¸ë§Œ ì°¨ì´ëŠ” ë¬´ì‹œ (ì •ìƒ ë²”ìœ„)
                        
                        // ì´ˆì„± ë°°ì—´ ë³€ê²½ ì²´í¬ (ì„œë²„ ì‹œê°„ ê¸°ì¤€)
                        if (serverTimeLeft <= 120 && gameState.shuffleCount === 0) {
                            shuffleConsonants('reverse');
                            gameState.shuffleCount = 1;
                        } else if (serverTimeLeft <= 60 && gameState.shuffleCount === 1) {
                            shuffleConsonants('random');
                            gameState.shuffleCount = 2;
                        }
                    }
                    
                    // 5. ì±„íŒ… ë©”ì‹œì§€ ë™ê¸°í™” (ì˜¤ë¥¸ìª½ ì±„íŒ…ì°½ì— í‘œì‹œ)
                    if (roomData.chatMessages && Array.isArray(roomData.chatMessages)) {
                        updateChatMessages(roomData.chatMessages);
                    }
                    
                    // 6. ê²Œì„ ì¢…ë£Œ ì²´í¬ (ì„œë²„ ì‹œê°„ ê¸°ì¤€)
                    // ğŸ†• ê²Œì„ì´ ìƒˆë¡œ ì‹œì‘ë˜ì—ˆìœ¼ë©´ ëª¨ë‹¬ì„ ë„ìš°ì§€ ì•ŠìŒ
                    // endTimeì´ ìˆê³ , ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ê³ , ëª¨ë‹¬ì´ ì—†ì„ ë•Œë§Œ í‘œì‹œ
                    // ğŸ†• ì¶”ê°€ ì¡°ê±´: ê²Œì„ì´ ì‹¤í–‰ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ (ê²Œì„ ì‹œì‘ ì‹œ ì¬ìƒ ë°©ì§€)
                    if (roomData.endTime && 
                        !roomData.gameStarted && 
                        !roomData.consonants &&
                        !gameState.gameRunning &&
                        !document.querySelector('.mp-result-modal')) {
                        // ì„œë²„ì—ì„œ ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆê³ , ìƒˆ ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ê³ , ëª¨ë‹¬ì´ ì—†ìœ¼ë©´ í‘œì‹œ
                        showFinalResults(roomData);
                    }
                    
                    // ğŸ†• ê²Œì„ì´ ìƒˆë¡œ ì‹œì‘ë˜ì—ˆëŠ”ë° ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ë‹«ê¸° (ì¤‘ë³µ ë°©ì§€)
                    if (roomData.gameStarted && 
                        roomData.consonants && 
                        roomData.consonants.length > 0 &&
                        document.querySelector('.mp-result-modal')) {
                        // ê²Œì„ì´ ì‹œì‘ë˜ì—ˆëŠ”ë° ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ë‹«ê¸° (ë°©ì¥ì´ ìƒˆ ê²Œì„ ì‹œì‘ ì‹œ)
                        document.querySelector('.mp-result-modal')?.remove();
                        // ğŸ†• finished ì†Œë¦¬ í”Œë˜ê·¸ëŠ” ë¦¬ì…‹í•˜ì§€ ì•ŠìŒ (ì´ì „ ê²Œì„ ì¢…ë£Œ ì†Œë¦¬ê°€ ì™„ì „íˆ ëë‚  ë•Œê¹Œì§€ ëŒ€ê¸°)
                        console.log('[í´ë§] ê²Œì„ ì‹œì‘ ê°ì§€ - ëª¨ë‹¬ ì œê±°');
                    }
                    
                } catch (error) {
                    // ğŸ†• ì—ëŸ¬ ì¹´ìš´í„° ì¦ê°€
                    multiplayerState.pollingErrorCount = (multiplayerState.pollingErrorCount || 0) + 1;
                    
                    // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë‚˜ íƒ€ì„ì•„ì›ƒì€ ë¡œê·¸ë§Œ ë‚¨ê¸°ê³  ê³„ì† ì‹œë„
                    if (error.name === 'AbortError' || error.name === 'TypeError') {
                        // ì¡°ìš©íˆ ì¬ì‹œë„ (ë„ˆë¬´ ë§ì€ ë¡œê·¸ ë°©ì§€)
                        if (multiplayerState.pollingErrorCount % 10 === 0) {
                            console.warn(`[í´ë§] ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ (${multiplayerState.pollingErrorCount}íšŒ)`);
                        }
                    } else {
                        console.error('[í´ë§] ì—ëŸ¬:', error);
                    }
                    
                    // ğŸ†• ì—°ì† ì—ëŸ¬ê°€ 20íšŒ ì´ìƒì´ë©´ í´ë§ ê°„ê²©ì„ ëŠ˜ë¦¼ (500ms â†’ 1.5ì´ˆ)
                    // ë„ˆë¬´ ìì£¼ ì‹¤íŒ¨í•˜ë©´ ì„œë²„ ë¶€í•˜ë¥¼ ì¤„ì´ê¸° ìœ„í•´
                    if (multiplayerState.pollingErrorCount >= 20 && multiplayerState.pollingErrorCount < 21) {
                        console.warn('[í´ë§] ì—°ì† ì—ëŸ¬ ë°œìƒ, í´ë§ ê°„ê²© ì¡°ì • (500ms â†’ 1.5ì´ˆ)');
                        clearInterval(multiplayerState.pollingInterval);
                        // 1.5ì´ˆ ê°„ê²©ìœ¼ë¡œ ì¬ì‹œì‘
                        multiplayerState.pollingInterval = setInterval(async () => {
                            if (!multiplayerState.isMultiplayer || !multiplayerState.roomId) return;
                            try {
                                const controller = new AbortController();
                                const timeoutId = setTimeout(() => controller.abort(), 5000);
                                const retryResponse = await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${multiplayerState.roomId}&playerId=${encodeURIComponent(multiplayerState.playerId || '')}`, {
                                    signal: controller.signal,
                                    cache: 'no-cache'
                                });
                                clearTimeout(timeoutId);
                                if (retryResponse.ok) {
                                    const retryData = await retryResponse.json();
                                    // ì„±ê³µí•˜ë©´ ì—ëŸ¬ ì¹´ìš´í„° ë¦¬ì…‹í•˜ê³  ì •ìƒ ê°„ê²©ìœ¼ë¡œ ë³µêµ¬
                                    multiplayerState.pollingErrorCount = 0;
                                    startPolling(); // ì •ìƒ ê°„ê²©(500ms)ìœ¼ë¡œ ë³µêµ¬
                                }
                            } catch (retryError) {
                                // ì¬ì‹œë„ ì‹¤íŒ¨ëŠ” ë¬´ì‹œ (ë‹¤ìŒ ì£¼ê¸°ì—ì„œ ë‹¤ì‹œ ì‹œë„)
                            }
                        }, 1500);
                    }
                }
            }, 500); // ğŸ†• 1ì´ˆâ†’500msë¡œ ë‹¨ì¶•í•´ì„œ ë” ë¹ ë¥¸ ì—…ë°ì´íŠ¸
        }

        function stopPolling() {
            if (multiplayerState.pollingInterval) {
                clearInterval(multiplayerState.pollingInterval);
                multiplayerState.pollingInterval = null;
            }
        }

        function updateScoreboard(roomData) {
            // ğŸš€ ë©€í‹°í”Œë ˆì´ ì¤‘ì´ë©´ í•­ìƒ ìŠ¬ë¡¯ í‘œì‹œ (í˜¼ì ìˆì–´ë„!)
            if (multiplayerState.isMultiplayer) {
                document.getElementById('playerSlotsLeft')?.classList.remove('hidden');
                document.getElementById('chatContainer')?.classList.remove('hidden');
                updatePlayerSlots(roomData);
                return;
            }
            
            // ğŸš€ ë©€í‹°í”Œë ˆì´ê°€ ì•„ë‹ˆë©´ ë¬´ì¡°ê±´ ìŠ¬ë¡¯ ìˆ¨ê¹€ (ìµœì´ˆ ì‹œì‘ í™”ë©´ í¬í•¨)
            document.getElementById('playerSlotsLeft')?.classList.add('hidden');
            document.getElementById('chatContainer')?.classList.add('hidden');
            
            // ì‹±ê¸€í”Œë ˆì´ëŠ” ê¸°ì¡´ ë¡œì§
            if (!roomData.players || roomData.players.length < 2) {
                return;
            }

            // ìŠ¬ë¡¯ + ì±„íŒ… í‘œì‹œ
            document.getElementById('playerSlotsLeft').classList.remove('hidden');
            document.getElementById('chatContainer').classList.remove('hidden');

            // í”Œë ˆì´ì–´ ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸
            updatePlayerSlots(roomData);
        }

        // í”Œë ˆì´ì–´ ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸ (ì ìˆ˜ ì• ë‹ˆë©”ì´ì…˜ í¬í•¨)
        function updatePlayerSlots(roomData) {
            const isTurnMode = multiplayerState.gameMode === 'turn';
            
            // ğŸ†• roomData.playersê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”
            if (!roomData.players || !Array.isArray(roomData.players)) {
                console.warn('[ìŠ¬ë¡¯] roomData.playersê°€ ì—†ê±°ë‚˜ ë°°ì—´ì´ ì•„ë‹˜:', roomData);
                roomData.players = [];
            }
            
            // ìˆœìœ„ë³„ë¡œ ì •ë ¬
            // roomData.scoresê°€ ì—†ìœ¼ë©´ ë¹ˆ ê°ì²´ë¡œ ì´ˆê¸°í™”
            const scores = roomData.scores || {};
            const playerWords = roomData.playerWords || {};
            
            // ğŸ†• í„´ì œ ëª¨ë“œ: ì…ì¥ìˆœìœ¼ë¡œ ì •ë ¬ (ì‹œê°„ì œëŠ” ì ìˆ˜ìˆœ)
            const sortedPlayers = isTurnMode 
                ? [...roomData.players] // ì…ì¥ìˆœ ìœ ì§€
                : roomData.players.length > 0 ? roomData.players
                    .map(player => {
                        const words = playerWords[player.id] || [];
                        const highestScore = words.length > 0 
                            ? Math.max(...words.map(w => w.score || 0))
                            : 0;
                        
                        return {
                            ...player,
                            score: scores[player.id] || 0,
                            wordCount: words.length,
                            highestScore: highestScore
                        };
                    })
                    .sort((a, b) => b.score - a.score)
                : []; // ğŸ†• playersê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´

            const slotsContainer = document.getElementById('playerSlotsLeft');
            
            // ìµœëŒ€ 5ê°œ ìŠ¬ë¡¯ (ë°© ìµœëŒ€ ì¸ì›)
            const maxSlots = 5;
            let html = '';
            
            // ğŸ†• ë°©ë²ˆí˜¸/ë°©ì œ í‘œì‹œë¥¼ ì˜¤ë¥¸ìª½ ì±„íŒ…ì°½ ìœ„ë¡œ ì´ë™ (ì‹œê°„ì œ/í„´ì œ ê³µí†µ)
            if (roomData.id && roomData.title) {
                const roomInfoInChat = document.getElementById('roomInfoInChat');
                if (roomInfoInChat) {
                    const titleEl = roomInfoInChat.querySelector('.turn-room-title');
                    const idEl = roomInfoInChat.querySelector('.turn-room-id');
                    const roomNumber = roomData.roomNumber || null;
                    const displayTitle = roomData.title || 'ë°© ì œëª© ì—†ìŒ';
                    if (titleEl) {
                        titleEl.textContent = roomNumber ? `${roomNumber}. ${displayTitle}` : displayTitle;
                    }
                    if (idEl) idEl.textContent = '';
                    roomInfoInChat.classList.remove('hidden');
                }
            } else {
                const roomInfoInChat = document.getElementById('roomInfoInChat');
                if (roomInfoInChat) {
                    roomInfoInChat.classList.add('hidden');
                }
            }

            // ì‹¤ì œ í”Œë ˆì´ì–´ ìŠ¬ë¡¯
            for (let i = 0; i < sortedPlayers.length && i < maxSlots; i++) {
                const player = sortedPlayers[i];
                const isMe = player.id === multiplayerState.playerId;
                const isCurrentTurn = isTurnMode && roomData.currentTurnPlayerId === player.id;
                const isEliminated = isTurnMode && roomData.eliminatedPlayers?.includes(player.id);
                
                if (isTurnMode) {
                    // ğŸ†• í„´ì œ ëª¨ë“œ: ìƒëª…ê¶Œ, í„´ íšŸìˆ˜ í‘œì‹œ
                    const lives = roomData.playerLives?.[player.id] || 0;
                    const turnCount = roomData.turnCount?.[player.id] || 0;
                    
                    html += `
                        <div class="player-slot ${isEliminated ? 'eliminated' : ''} ${isCurrentTurn ? 'current-turn' : ''}" data-player-id="${player.id}">
                            <div class="slot-header">
                                <div class="slot-name">${player.name}</div>
                                <div class="slot-status">${isCurrentTurn ? 'ğŸŸ¢' : (isEliminated ? 'ğŸ”´ íƒˆë½' : '')}</div>
                            </div>
                            <div class="slot-info">
                                <div class="slot-info-row">
                                    <span class="icon" style="color: #6bff6b; filter: hue-rotate(120deg) saturate(1.5) brightness(1.2);">â¤ï¸</span>
                                    <span>ìƒëª…ê¶Œ <span class="lives-count">${lives}</span>ê°œ</span>
                                </div>
                                <div class="slot-info-row">
                                    <span class="icon">ğŸ“</span>
                                    <span>${turnCount}ê°œ ë§ì¶¤</span>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    // ì‹œê°„ì œ ëª¨ë“œ: ê¸°ì¡´ ë¡œì§
                    const words = playerWords[player.id] || [];
                    const highestScore = words.length > 0 
                        ? Math.max(...words.map(w => w.score || 0))
                        : 0;
                    const rankText = `${i + 1}ìœ„`;
                    
                    html += `
                        <div class="player-slot" data-player-id="${player.id}">
                            <div class="slot-header">
                                <div class="slot-name">${rankText} ${player.name}</div>
                                <div class="slot-status">ğŸŸ¢</div>
                            </div>
                            <div class="slot-info">
                                <div class="slot-info-row">
                                    <span class="icon">ğŸ’°</span>
                                    <span class="slot-score">${(scores[player.id] || 0).toLocaleString()}ì </span>
                                </div>
                                <div class="slot-info-row">
                                    <span class="icon">ğŸ“</span>
                                    <span>ë‹¨ì–´ ${words.length}ê°œ</span>
                                </div>
                                <div class="slot-info-row">
                                    <span class="icon">ğŸ†</span>
                                    <span>ìµœê³ ë“ì  ${highestScore}ì </span>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }

            // ë¹ˆ ìŠ¬ë¡¯ ì¶”ê°€
            for (let i = sortedPlayers.length; i < maxSlots; i++) {
                html += `
                    <div class="player-slot empty">
                        <div class="player-slot-name">ëŒ€ê¸°ì¤‘...</div>
                        <div class="player-slot-score">-</div>
                    </div>
                `;
            }

            slotsContainer.innerHTML = html;

            // ì ìˆ˜ ë³€í™” ê°ì§€ ë° íŒì—… ì• ë‹ˆë©”ì´ì…˜
            sortedPlayers.forEach(player => {
                const playerId = player.id;
                const words = playerWords[playerId] || [];
                const lastWord = words.length > 0 ? words[words.length - 1] : null;

                // ì´ì „ ë‹¨ì–´ ê°œìˆ˜ì™€ ë¹„êµí•´ì„œ "ìƒˆ ë‹¨ì–´ê°€ ì¶”ê°€ëœ ê²½ìš°"ë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŒì—… í‘œì‹œ
                if (!multiplayerState.previousWordCounts) {
                    multiplayerState.previousWordCounts = {};
                }
                const prevCount = multiplayerState.previousWordCounts[playerId] || 0;
                const currentCount = words.length;

                if (currentCount > prevCount && lastWord && (lastWord.score || 0) > 0) {
                    showScorePopup(playerId, lastWord.score);
                }

                multiplayerState.previousWordCounts[playerId] = currentCount;
            });
            
            // ğŸ†• í„´ì œ ëª¨ë“œ: í”Œë ˆì´ì–´ ìˆ˜ ë³€ê²½ ì‹œ UI ì—…ë°ì´íŠ¸
            if (multiplayerState.gameMode === 'turn' && multiplayerState.isHost) {
                updateStartScreenButtons();
                updateGameModeUI('turn');
            }
        }

        // ì ìˆ˜ íŒì—… í‘œì‹œ
        function showScorePopup(playerId, scoreDiff) {
            const slot = document.querySelector(`[data-player-id="${playerId}"]`);
            if (!slot) return;

            // ê¸°ì¡´ íŒì—… ì œê±°
            const existingPopup = slot.querySelector('.slot-popup');
            if (existingPopup) {
                existingPopup.remove();
            }

            // ìƒˆ íŒì—… ìƒì„±
            const popup = document.createElement('div');
            popup.className = 'slot-popup';
            popup.textContent = `+${scoreDiff}!`;
            slot.appendChild(popup);

            // 1ì´ˆ í›„ ì œê±°
            setTimeout(() => {
                popup.remove();
            }, 1000);
        }

        // ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ (ì„œë²„ ì—°ë™)
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            if (!multiplayerState.isMultiplayer || !multiplayerState.roomId) return;

            await sendChatMessageFromInput(message);
            input.value = '';
        }

        // ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ (ì…ë ¥ì°½ì—ì„œ ì§ì ‘ í˜¸ì¶œ, ë„ì–´ì“°ê¸° í—ˆìš©)
        async function sendChatMessageFromInput(message) {
            if (!message) return;
            if (!multiplayerState.isMultiplayer || !multiplayerState.roomId) return;

            try {
                // ì„œë²„ì— ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ (ë„ì–´ì“°ê¸° í¬í•¨)
                await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/chat?roomId=${multiplayerState.roomId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        playerName: multiplayerState.playerName,
                        message: message // ë„ì–´ì“°ê¸° í¬í•¨ëœ ì›ë³¸ ë©”ì‹œì§€
                    })
                });
                
                // ê²Œì„ ì…ë ¥ì°½ìœ¼ë¡œ í¬ì»¤ìŠ¤ ë³µê·€
                document.getElementById('wordInput').focus();
            } catch (error) {
                console.error('ì±„íŒ… ì „ì†¡ ì‹¤íŒ¨:', error);
            }
        }

        // ì±„íŒ… ë©”ì‹œì§€ ì¶”ê°€ (ë¡œì»¬ í‘œì‹œìš©)
        function addChatMessage(playerName, message) {
            // ê²Œì„ ì¤‘ ì±„íŒ…ì°½
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                messageDiv.innerHTML = `
                    <span class="chat-name">${playerName}:</span>
                    <span class="chat-text">${message}</span>
                `;
                
                chatMessages.appendChild(messageDiv);
                
                // ìµœëŒ€ 50ê°œ ë©”ì‹œì§€ë§Œ ìœ ì§€
                while (chatMessages.children.length > 50) {
                    chatMessages.removeChild(chatMessages.firstChild);
                }
                
                // ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // ğŸ†• ëŒ€ê¸°ì‹¤ ì±„íŒ…ì°½ (í„´ì œ ëª¨ë“œ)
            const mpChatMessages = document.getElementById('mpChatMessages');
            if (mpChatMessages) {
                const mpMessageDiv = document.createElement('div');
                mpMessageDiv.className = 'mp-chat-item';
                mpMessageDiv.innerHTML = `
                    <span class="mp-chat-name">${playerName}:</span>
                    <span class="mp-chat-text">${message}</span>
                `;
                
                mpChatMessages.appendChild(mpMessageDiv);
                
                // ìµœëŒ€ 50ê°œ ë©”ì‹œì§€ë§Œ ìœ ì§€
                while (mpChatMessages.children.length > 50) {
                    mpChatMessages.removeChild(mpChatMessages.firstChild);
                }
                
                // ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ
                mpChatMessages.scrollTop = mpChatMessages.scrollHeight;
            }
        }

        // ì±„íŒ… ë©”ì‹œì§€ ë™ê¸°í™” (ì„œë²„ì—ì„œ ë°›ì€ ë©”ì‹œì§€)
        let lastChatTimestamp = 0;
        function updateChatMessages(serverMessages) {
            if (!serverMessages || serverMessages.length === 0) return;
            
            // ìƒˆë¡œìš´ ë©”ì‹œì§€ë§Œ ì¶”ê°€
            const newMessages = serverMessages.filter(msg => msg.timestamp > lastChatTimestamp);
            if (newMessages.length === 0) return;
            
            newMessages.forEach(msg => {
                addChatMessage(msg.playerName, msg.message);
            });
            
            // ë§ˆì§€ë§‰ íƒ€ì„ìŠ¤íƒ¬í”„ ì—…ë°ì´íŠ¸
            lastChatTimestamp = Math.max(...serverMessages.map(msg => msg.timestamp));
        }
        

        async function updatePlayerScore() {
            if (!multiplayerState.isMultiplayer || !multiplayerState.roomId) return;
            try {
                // usedWordsëŠ” ë‹¨ì–´ë§Œ ì €ì¥ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ê° ë‹¨ì–´ì˜ ì ìˆ˜ë¥¼ ë‹¤ì‹œ ê³„ì‚°
                const words = gameState.usedWords.map(word => {
                    const chosung = getChosung(word);
                    const scoreInfo = calculateScore(word, chosung);
                    return { 
                        word: word, 
                        score: scoreInfo.total 
                    };
                });
                
                await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${multiplayerState.roomId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ playerId: multiplayerState.playerId, score: gameState.score, words: words })
                });
                multiplayerState.playerWords[multiplayerState.playerId] = words;
            } catch (error) {
                console.error('ì ìˆ˜ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        async function sendGameStart(isNewRound = false) {
            if (!multiplayerState.isMultiplayer || !multiplayerState.roomId) return;
            try {
                const action = isNewRound ? 'new_game' : 'start_game';
                console.log(`ğŸ¯ [ë°©ì¥] ${action} ì‹ í˜¸ ì „ì†¡:`, gameState.currentConsonants);
                
                // ğŸ†• í„´ì œ ëª¨ë“œì¼ ë•Œ players ë°°ì—´ ì „ì†¡
                const players = multiplayerState.players || [];
                
                await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${multiplayerState.roomId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: action, 
                        consonants: gameState.currentConsonants, 
                        startTime: Date.now(),
                        timeLeft: 180,
                        gameMode: multiplayerState.gameMode || 'time', // ğŸ†• ê²Œì„ ëª¨ë“œ ì „ì†¡
                        players: players // ğŸ†• í”Œë ˆì´ì–´ ëª©ë¡ ì „ì†¡
                    })
                });
            } catch (error) {
                console.error('ê²Œì„ ì‹œì‘ ì „ì†¡ ì‹¤íŒ¨:', error);
            }
        }

        async function sendGameEnd() {
            if (!multiplayerState.isMultiplayer || !multiplayerState.roomId) return;
            try {
                await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${multiplayerState.roomId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'end_game' })
                });
            } catch (error) {
                console.error('ê²Œì„ ì¢…ë£Œ ì „ì†¡ ì‹¤íŒ¨:', error);
            }
        }
        
        // ëª¨ë‹¬ ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡
        async function sendModalChatMessage() {
            const input = document.getElementById('modalChatInput');
            if (!input) return;
            
            const message = input.value.trim();
            if (!message) return;
            if (!multiplayerState.isMultiplayer || !multiplayerState.roomId) return;

            try {
                await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/chat?roomId=${multiplayerState.roomId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        playerName: multiplayerState.playerName,
                        message: message
                    })
                });
                input.value = '';
                input.focus();
            } catch (error) {
                console.error('ëª¨ë‹¬ ì±„íŒ… ì „ì†¡ ì‹¤íŒ¨:', error);
            }
        }

        // ğŸ†• finished ì†Œë¦¬ ì¤‘ë³µ ë°©ì§€ í”Œë˜ê·¸ (gameStateì— ì €ì¥í•˜ì—¬ ì „ì—­ ê´€ë¦¬)
        if (!gameState.finishedSoundPlaying) gameState.finishedSoundPlaying = false;
        
        function showFinalResults(roomData) {
            // ğŸ†• ì´ë¯¸ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€!
            if (document.querySelector('.mp-result-modal')) {
                console.log('âš ï¸ ì´ë¯¸ ê²°ê³¼ ëª¨ë‹¬ ì¡´ì¬ - ì¤‘ë³µ ë°©ì§€');
                return;
            }
            
            // ğŸ†• í„´ì œ ëª¨ë“œì™€ ì‹œê°„ì œ ëª¨ë“œ ë¶„ë¦¬
            const isTurnMode = roomData.gameMode === 'turn';
            
            // í„´ì œ ëª¨ë“œ: BGM fade out í›„ finished.mp3 ì¬ìƒ
            if (isTurnMode) {
                if (bgmAudio && gameState.bgmEnabled) {
                    fadeOutBGM();
                }
                // fade out í›„ ì•½ê°„ì˜ ë”œë ˆì´ë¥¼ ë‘ê³  finished.mp3 ì¬ìƒ
                setTimeout(() => {
                    if (gameState.sfxEnabled && !gameState.finishedSoundPlaying) {
                        gameState.finishedSoundPlaying = true;
                        try {
                            const finishedSound = new Audio('./sound/finished.mp3');
                            finishedSound.volume = 0.5;
                            finishedSound.onended = () => {
                                // ì¬ìƒì´ ëë‚˜ë©´ ì¦‰ì‹œ í”Œë˜ê·¸ ë¦¬ì…‹
                                gameState.finishedSoundPlaying = false;
                            };
                            finishedSound.play().catch(e => {
                                console.log('ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', e);
                                gameState.finishedSoundPlaying = false;
                            });
                        } catch (e) {
                            console.log('ì†Œë¦¬ ë¡œë“œ ì‹¤íŒ¨:', e);
                            gameState.finishedSoundPlaying = false;
                        }
                    }
                }, 500); // 0.5ì´ˆ ë”œë ˆì´
            } else {
                // ì‹œê°„ì œ ëª¨ë“œ: ê¸°ì¡´ ë¡œì§ ìœ ì§€
                if (gameState.sfxEnabled && !gameState.finishedSoundPlaying) {
                    gameState.finishedSoundPlaying = true;
                    try {
                        const finishedSound = new Audio('./sound/finished.mp3');
                        finishedSound.volume = 0.5;
                        finishedSound.onended = () => {
                            // ì¬ìƒì´ ëë‚˜ë©´ ì¦‰ì‹œ í”Œë˜ê·¸ ë¦¬ì…‹
                            gameState.finishedSoundPlaying = false;
                        };
                        finishedSound.play().catch(e => {
                            console.log('ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', e);
                            gameState.finishedSoundPlaying = false;
                        });
                    } catch (e) {
                        console.log('ì†Œë¦¬ ë¡œë“œ ì‹¤íŒ¨:', e);
                        gameState.finishedSoundPlaying = false;
                    }
                }
            }
            
            let results;
            if (isTurnMode) {
                // í„´ì œ ëª¨ë“œ: íƒˆë½í•˜ì§€ ì•Šì€ í”Œë ˆì´ì–´ = ìŠ¹ì, íƒˆë½í•œ í”Œë ˆì´ì–´ = íƒˆë½ì
                const activePlayers = (roomData.players || []).filter(p => 
                    !roomData.eliminatedPlayers?.includes(p.id)
                );
                const eliminatedPlayers = (roomData.players || []).filter(p => 
                    roomData.eliminatedPlayers?.includes(p.id)
                );
                
                results = activePlayers.map(player => ({
                    id: player.id,
                    name: player.name,
                    turnCount: roomData.turnCount?.[player.id] || 0,
                    livesUsed: 0, // ì‚¬ìš©í•œ ì—°ì¥ê¶Œ ìˆ˜ëŠ” ê³„ì‚° í•„ìš” (ì´ˆê¸° ì—°ì¥ê¶Œ - í˜„ì¬ ì—°ì¥ê¶Œ)
                    isWinner: true
                }));
                
                // íƒˆë½ì ì¶”ê°€
                eliminatedPlayers.forEach((player, index) => {
                    results.push({
                        id: player.id,
                        name: player.name,
                        turnCount: roomData.turnCount?.[player.id] || 0,
                        livesUsed: 0,
                        isEliminated: true,
                        eliminatedRank: activePlayers.length + index + 1
                    });
                });
            } else {
                // ì‹œê°„ì œ ëª¨ë“œ: ê¸°ì¡´ ë¡œì§
                results = roomData.players
                    .map(player => ({
                        id: player.id,
                        name: player.name,
                        score: roomData.scores?.[player.id] || 0,
                        words: roomData.playerWords?.[player.id] || []
                    }))
                    .sort((a, b) => b.score - a.score);
            }
                
            const modal = document.createElement('div');
            modal.className = 'mp-result-modal';
            
            // ğŸ†• ëœë¤ ë°°ë„ˆ ì„ íƒ (banner1~5.jpg)
            const randomBannerNum = Math.floor(Math.random() * 5) + 1;
            const bannerImage = `./banner/banner${randomBannerNum}.jpg`;
            
            // ğŸ†• ì¸ì›ìˆ˜ì— ë”°ë¥¸ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ ê²°ì •
            let gridClass = 'single-column';
            if (results.length === 4) {
                gridClass = 'two-column';
            } else if (results.length === 5) {
                gridClass = 'hybrid'; // 1ìœ„ ì™¼ìª½ í° ì¹´ë“œ, 2-5ìœ„ ì˜¤ë¥¸ìª½ 2x2
            }
            
            modal.innerHTML = `
                <div class="mp-result-content">
                    <div class="mp-result-title">ğŸ† ê²Œì„ ì¢…ë£Œ!</div>
                    <div class="mp-result-banner" style="text-align: center; margin: 12px 0;">
                        <a href="https://smartstore.naver.com/gemfarm" target="_blank" style="display: inline-block;">
                            <img src="${bannerImage}" alt="ê´‘ê³ " style="width: 300px; height: 200px; object-fit: contain; border-radius: 8px; cursor: pointer; background: #f8f9fa;" />
                        </a>
                    </div>
                    <div class="mp-result-players-grid ${gridClass}">
                    ${isTurnMode ? (
                        // í„´ì œ ëª¨ë“œ: ìŠ¹ì, ìˆœìœ„, íƒˆë½ì í‘œì‹œ
                        (() => {
                            const winners = results.filter(p => p.isWinner);
                            const eliminated = results.filter(p => p.isEliminated);
                            
                            let html = '';
                            
                            // ìŠ¹ì (1ìœ„)
                            if (winners.length > 0) {
                                const winner = winners[0];
                                const winnerWords = roomData.playerTurnWords?.[winner.id] || [];
                                const winnerLives = roomData.playerLives?.[winner.id] || 0;
                                html += `
                                    <div class="mp-result-player rank-1">
                                        <div class="mp-result-player-header">
                                            <div class="mp-result-player-name">
                                                ìŠ¹ì: ${winner.name} ğŸ‘‘
                                            </div>
                                        </div>
                                        <div class="mp-result-player-stats">
                                            ë§ì¶˜ ë‹¨ì–´: ${winner.turnCount}ê°œ<br>
                                            ë‚¨ì€ ìƒëª…ê¶Œ: ${winnerLives}ê°œ
                                        </div>
                                        ${winnerWords.length > 0 ? `<div class="mp-result-player-words" style="font-size: 0.85em; margin-top: 8px; color: #666;">
                                            ${winnerWords.join(', ')}
                                        </div>` : ''}
                                    </div>
                                `;
                            }
                            
                            // 2ìœ„, 3ìœ„ ë“±
                            winners.slice(1).forEach((player, index) => {
                                const playerWords = roomData.playerTurnWords?.[player.id] || [];
                                const playerLives = roomData.playerLives?.[player.id] || 0;
                                html += `
                                    <div class="mp-result-player">
                                        <div class="mp-result-player-header">
                                            <div class="mp-result-player-name">
                                                ${index + 2}ìœ„: ${player.name}
                                            </div>
                                        </div>
                                        <div class="mp-result-player-stats">
                                            ë§ì¶˜ ë‹¨ì–´: ${player.turnCount}ê°œ<br>
                                            ë‚¨ì€ ìƒëª…ê¶Œ: ${playerLives}ê°œ
                                        </div>
                                        ${playerWords.length > 0 ? `<div class="mp-result-player-words" style="font-size: 0.85em; margin-top: 8px; color: #666;">
                                            ${playerWords.join(', ')}
                                        </div>` : ''}
                                    </div>
                                `;
                            });
                            
                            // íƒˆë½ì
                            if (eliminated.length > 0) {
                                eliminated.forEach((player, idx) => {
                                    const playerWords = roomData.playerTurnWords?.[player.id] || [];
                                    const playerLives = roomData.playerLives?.[player.id] || 0;
                                    html += `
                                        <div class="mp-result-player" style="opacity: 0.7;">
                                            <div class="mp-result-player-header">
                                                <div class="mp-result-player-name">
                                                    íƒˆë½: ${player.name}
                                                </div>
                                            </div>
                                            <div class="mp-result-player-stats" style="font-size: 0.9em; margin-top: 8px;">
                                                ë§ì¶˜ ë‹¨ì–´: ${player.turnCount}ê°œ<br>
                                                ë‚¨ì€ ìƒëª…ê¶Œ: ${playerLives}ê°œ
                                            </div>
                                            ${playerWords.length > 0 ? `<div class="mp-result-player-words" style="font-size: 0.85em; margin-top: 8px; color: #666;">
                                                ${playerWords.join(', ')}
                                            </div>` : ''}
                                        </div>
                                    `;
                                });
                            }
                            
                            return html;
                        })()
                    ) : (
                        // ì‹œê°„ì œ ëª¨ë“œ: ê¸°ì¡´ ë¡œì§
                        results.map((player, index) => {
                            const topWords = player.words.sort((a, b) => b.score - a.score).slice(0, 3);
                            const isMe = player.id === multiplayerState.playerId;
                            return `
                                <div class="mp-result-player ${index === 0 ? 'rank-1' : ''}">
                                    <div class="mp-result-player-header">
                                        <div class="mp-result-player-name">
                                            ${index === 0 ? 'ğŸ‘‘' : `${index + 1}ìœ„`} ${player.name}
                                        </div>
                                        <div class="mp-result-player-score">${player.score.toLocaleString()}ì </div>
                                    </div>
                                    <div class="mp-result-player-stats">
                                        ë§ì¶˜ ë‹¨ì–´: ${player.words.length}ê°œ
                                        ${isMe ? `<button onclick="showStudyNote('${player.id}')" style="margin-left:10px;padding:2px 8px;font-size:0.8em;">ğŸ“ í•™ìŠµë…¸íŠ¸</button>` : ''}
                                    </div>
                                    <div class="mp-result-player-words">
                                        TOP3: ${topWords.map(w => `${w.word}(${w.score})`).join(', ') || 'ì—†ìŒ'}
                                    </div>
                                </div>
                            `;
                        }).join('')
                    )}
                    </div>
                    <div class="mp-result-buttons">
                        ${multiplayerState.isHost 
                            ? '<button class="mp-result-btn replay" onclick="restartMultiplayerGame()">ë‹¤ì‹œí•˜ê¸°</button>' 
                            : '<div class="mp-waiting-message">ë°©ì¥ì´ ë‹¤ìŒ ê²Œì„ì„ ì‹œì‘í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>'}
                        <button class="mp-result-btn home" onclick="goToHome()">ë°© ë‚˜ê°€ê¸°</button>
                    </div>
                    <div class="mp-result-chat">
                        <div class="mp-result-chat-input-box">
                            <input 
                                type="text" 
                                id="modalChatInput" 
                                class="mp-result-chat-input" 
                                placeholder="ì±„íŒ… ë©”ì‹œì§€ ì…ë ¥..."
                                maxlength="100"
                                onkeypress="if(event.key==='Enter') sendModalChatMessage()"
                            />
                            <button class="mp-result-chat-send" onclick="sendModalChatMessage()">ì „ì†¡</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // ì˜¤ë¥¸ìª½ ì±„íŒ…ì°½ì€ ê³„ì† ë³´ì´ë„ë¡ ìœ ì§€
            document.getElementById('chatContainer').classList.remove('hidden');
            
            // ëª¨ë‹¬ ì±„íŒ… ì…ë ¥ì°½ í¬ì»¤ìŠ¤
            setTimeout(() => {
                const modalInput = document.getElementById('modalChatInput');
                if (modalInput) modalInput.focus();
            }, 300);
            
            // ğŸ†• roomDataë¥¼ ì „ì—­ì— ì €ì¥ (í•™ìŠµë…¸íŠ¸ìš©)
            window.lastGameResults = roomData;
            
            // ğŸ†• ë©€í‹°í”Œë ˆì´ì–´ ê²Œì„ ì¢…ë£Œ ì‹œ ìµœê³ ê¸°ë¡ ì €ì¥
            const myResult = results.find(p => p.id === multiplayerState.playerId);
            if (myResult && myResult.score > 0) {
                saveBestScore(myResult.score);
            }
        }
        
        // ğŸ†• í•™ìŠµë…¸íŠ¸ í‘œì‹œ í•¨ìˆ˜
        function showStudyNote(playerId) {
            const playerWords = window.lastGameResults?.playerWords?.[playerId] || [];
            if (playerWords.length === 0) {
                showToast('í•™ìŠµí•  ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const noteModal = document.createElement('div');
            noteModal.className = 'study-note-modal';
            noteModal.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 10001;
                background: white;
                padding: 20px;
                border-radius: 15px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2);
                max-width: 600px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
            `;
            
            const sortedWords = playerWords.sort((a, b) => b.score - a.score);
            
            noteModal.innerHTML = `
                <h2 style="margin-bottom:15px;color:#fd79a8;">ğŸ“ ë‚˜ì˜ í•™ìŠµë…¸íŠ¸</h2>
                <div style="margin-bottom:10px;color:#636e72;">ì´ ${playerWords.length}ê°œ ë‹¨ì–´ | ì´ì : ${playerWords.reduce((sum, w) => sum + w.score, 0).toLocaleString()}ì </div>
                <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:20px;">
                    ${sortedWords.map(w => `
                        <span style="
                            padding:5px 10px;
                            background:${w.score >= 100 ? '#ffe066' : '#f8f9fa'};
                            border:2px solid ${w.score >= 100 ? '#ffd43b' : '#dee2e6'};
                            border-radius:10px;
                            font-weight:${w.score >= 100 ? 'bold' : 'normal'};
                        ">${w.word}(${w.score})</span>
                    `).join('')}
                </div>
                <button onclick="this.parentElement.remove()" style="
                    padding:10px 20px;
                    background:#fd79a8;
                    color:white;
                    border:none;
                    border-radius:10px;
                    font-weight:bold;
                    cursor:pointer;
                    width:100%;
                ">ë‹«ê¸°</button>
            `;
            
            document.body.appendChild(noteModal);
        }

        // ğŸ†• ì¬ì‹œì‘ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€ í”Œë˜ê·¸
        let isRestarting = false;
        
        async function restartMultiplayerGame() {
            // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
            if (isRestarting) {
                console.log('âš ï¸ [ì¬ì‹œì‘] ì´ë¯¸ ì¬ì‹œì‘ ì¤‘ì…ë‹ˆë‹¤');
                return;
            }
            
            // ëª¨ë‹¬ ë‹«ì„ ë•Œ ì˜¤ë¥¸ìª½ ì±„íŒ…ì°½ ë‹¤ì‹œ í‘œì‹œ
            document.getElementById('chatContainer').classList.remove('hidden');
            if (!multiplayerState.isHost) {
                // showToast('ë°©ì¥ë§Œ ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤'); // ì œê±°
                return;
            }
            
            isRestarting = true; // ì¬ì‹œì‘ ì‹œì‘
            
            try {
                document.querySelector('.mp-result-modal')?.remove();
                
                // showToast('ìƒˆë¡œìš´ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...'); // ì œê±°
                
                // ğŸ†• ê²Œì„ í™”ë©´ ë¨¼ì € í‘œì‹œ (ì‹œì‘ í™”ë©´ì—ì„œ ê²Œì„ í™”ë©´ìœ¼ë¡œ)
                document.getElementById('gameStartSection').classList.add('hidden');
                document.getElementById('gameScreen').classList.remove('hidden');
                
                // ìŠ¬ë¡¯ + ì±„íŒ… ë‹¤ì‹œ í‘œì‹œ (ë‘ ë²ˆì§¸ íŒë¶€í„° ì•ˆ ë³´ì´ë˜ ë²„ê·¸ ìˆ˜ì •!)
                document.getElementById('playerSlotsLeft').classList.remove('hidden');
                document.getElementById('chatContainer').classList.remove('hidden');
                
                // ğŸ†• ì´ì „ ë¼ìš´ë“œì˜ UI ì”ìƒ ì´ˆê¸°í™”
                gameState.wordDefinitions = {};
                if (!gameState.isMobile) {
                    updateEmoji('ğŸ¤”', 'ë‹¨ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 0);
                    updateDefinition('ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ë©´ ëœ»ì´ í‘œì‹œë©ë‹ˆë‹¤');
                }
                
                // í´ë§ ì¬ì‹œì‘ (ë‹¤ë¥¸ í”Œë ˆì´ì–´ë„ ê²Œì„ ì‹œì‘ ê°ì§€í•˜ë„ë¡)
                startPolling();
                
                // ê²Œì„ ì‹œì‘ (ì„œë²„ì— new_game ì‹ í˜¸ ì „ì†¡)
                // ğŸ†• ë©€í‹°í”Œë ˆì´ì–´ì—ì„œëŠ” sendGameStart ì‚¬ìš©
                gameState.currentConsonants = getRandomConsonants();
                displayConsonants(gameState.currentConsonants);
                await sendGameStart(true);
                
                // ğŸ†• BGM ì¬ìƒ (ê²Œì„ ì‹œì‘ ì‹œ)
                if (gameState.bgmEnabled) {
                    playBGM();
                }
                
                // ğŸ†• ì„œë²„ ìƒíƒœ í™•ì¸ì„ ë” í™•ì‹¤í•˜ê²Œ (ìµœëŒ€ 3ì´ˆ, 150ms ê°„ê²©)
                let attempts = 0;
                const maxAttempts = 20; // 3ì´ˆ (150ms * 20)
                
                const checkGameStart = setInterval(async () => {
                    attempts++;
                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 2000);
                        
                        const response = await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${multiplayerState.roomId}`, {
                            signal: controller.signal
                        });
                        
                        clearTimeout(timeoutId);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const roomData = await response.json();
                        const serverRound = roomData.roundNumber || 0;
                        const clientRound = multiplayerState.currentRound || 0;
                        
                        // ì„œë²„ ë¼ìš´ë“œê°€ ì¦ê°€í–ˆê³  ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìœ¼ë©´
                        if (serverRound > clientRound && roomData.gameStarted && roomData.consonants && roomData.consonants.length > 0) {
                            console.log(`ğŸŸ¢ [ì¬ì‹œì‘] ìƒˆ ë¼ìš´ë“œ ê°ì§€! (${clientRound} â†’ ${serverRound})`);
                            clearInterval(checkGameStart);
                            isRestarting = false; // ì¬ì‹œì‘ ì™„ë£Œ
                            multiplayerState.currentRound = serverRound;
                            joinActiveGame(roomData);
                        } else if (attempts >= maxAttempts) {
                            // íƒ€ì„ì•„ì›ƒ: ê°•ì œë¡œ ê²Œì„ ìƒíƒœ í™•ì¸
                            clearInterval(checkGameStart);
                            console.log('âš ï¸ [ì¬ì‹œì‘] íƒ€ì„ì•„ì›ƒ, ê²Œì„ ìƒíƒœ ì¬í™•ì¸');
                            if (roomData.gameStarted && roomData.consonants && roomData.consonants.length > 0) {
                                multiplayerState.currentRound = serverRound;
                                joinActiveGame(roomData);
                            } else {
                                // ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë‹¤ì‹œ ì‹œë„
                                console.log('âš ï¸ [ì¬ì‹œì‘] ê²Œì„ ì‹œì‘ ì‹¤íŒ¨, ì¬ì‹œë„');
                                // showToast('ê²Œì„ ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'); // ì œê±°
                            }
                            isRestarting = false; // ì¬ì‹œì‘ ì™„ë£Œ
                        }
                    } catch (error) {
                        console.error('ê²Œì„ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
                        if (attempts >= maxAttempts) {
                            clearInterval(checkGameStart);
                            isRestarting = false; // ì¬ì‹œì‘ ì™„ë£Œ
                            // showToast('ê²Œì„ ìƒíƒœ í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'); // ì œê±°
                        }
                    }
                }, 150); // 150msë§ˆë‹¤ í™•ì¸ (ë” ë¹ ë¥¸ ë°˜ì‘)
            } catch (error) {
                console.error('ê²Œì„ ì¬ì‹œì‘ ì‹¤íŒ¨:', error);
                isRestarting = false; // ì¬ì‹œì‘ ì™„ë£Œ
                // showToast('ê²Œì„ ì¬ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); // ì œê±°
            }
        }

        // ê²°ê³¼ ëª¨ë‹¬ì—ì„œ ë‚˜ê°€ê¸° - leaveRoomê³¼ ë™ì¼í•˜ê²Œ ìµœì´ˆ í™”ë©´ìœ¼ë¡œ
        async function goToHome() {
            await leaveRoom();
        }

        const originalStartGame = startGame;
        startGame = async function(isNewRound = false) {
            console.log('[startGame] í˜¸ì¶œë¨, isNewRound:', isNewRound, 'ë©€í‹°:', multiplayerState.isMultiplayer);
            originalStartGame();
            console.log('[startGame] originalStartGame ì™„ë£Œ, gameTimer:', gameState.gameTimer);
            if (multiplayerState.isMultiplayer && multiplayerState.isHost) {
                // ì´ˆì„±ì´ ìƒì„±ë  ë•Œê¹Œì§€ ì ê¹ ëŒ€ê¸°
                setTimeout(async () => {
                    await sendGameStart(isNewRound);
                    // ì„œë²„ì—ì„œ ë¼ìš´ë“œ ë²ˆí˜¸ê°€ ì¦ê°€í•œ í›„ í´ë§ì—ì„œ ê°ì§€í•˜ë„ë¡ í•¨
                    // currentRoundëŠ” í´ë§ì—ì„œ ì„œë²„ roundNumberë¥¼ ë°›ì•„ì˜¬ ë•Œ ì—…ë°ì´íŠ¸ë¨
                }, 100);
            }
        };

        const originalEndGame = endGame;
        endGame = function() {
            console.log('endGame í˜¸ì¶œë¨! ë©€í‹°:', multiplayerState.isMultiplayer);
            
            // ë©€í‹°í”Œë ˆì´ ì¤‘ì´ë©´
            if (multiplayerState.isMultiplayer) {
                // ê²Œì„ ìƒíƒœë§Œ ì •ë¦¬ (í™”ë©´ì€ ì•ˆ ë°”ê¿ˆ)
                clearInterval(gameState.gameTimer);
                gameState.gameRunning = false;
                document.body.classList.remove('time-warning');
                stopTickSound();
                stopBGM();  // ğŸ†• BGM ì¤‘ì§€
                
                console.log('ë°©ì¥ì¸ê°€?', multiplayerState.isHost);
                
                // ë°©ì¥ë§Œ ê²Œì„ ì¢…ë£Œ ì‹ í˜¸ ì „ì†¡
                if (multiplayerState.isHost) {
                    console.log('ê²Œì„ ì¢…ë£Œ ì‹ í˜¸ ì „ì†¡!');
                    sendGameEnd();
                }
                
                // í´ë§ì€ ê³„ì† (ê²°ê³¼ í™”ë©´ ëŒ€ê¸°)
                // showToast('ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ ì§‘ê³„ ì¤‘...'); // ì œê±°
                
                // ğŸ†• 5ì´ˆ í›„ì—ë„ ê²°ê³¼ ëª¨ë‹¬ ì•ˆ ëœ¨ë©´ ê°•ì œë¡œ í‘œì‹œ (ë¬´í•œ ë£¨í”„ ë°©ì§€!)
                setTimeout(async () => {
                    if (!document.querySelector('.mp-result-modal')) {
                        console.log('âš ï¸ íƒ€ì„ì•„ì›ƒ! ê°•ì œë¡œ ê²°ê³¼ í‘œì‹œ');
                        try {
                            const response = await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${multiplayerState.roomId}`);
                            const roomData = await response.json();
                            showFinalResults(roomData);
                        } catch (e) {
                            console.error('ê²°ê³¼ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', e);
                        }
                    }
                }, 5000);
            } else {
                // ì‹±ê¸€í”Œë ˆì´ëŠ” ê¸°ì¡´ ë¡œì§
                originalEndGame();
            }
        };

        const originalCheckWord = checkWord;
        checkWord = function() {
            originalCheckWord();
            if (multiplayerState.isMultiplayer) {
                setTimeout(() => updatePlayerScore(), 100);
            }
        };

        window.addEventListener('DOMContentLoaded', () => {
            // ğŸ†• ì‹œì‘ í™”ë©´ ë²„íŠ¼ ì´ˆê¸°í™”
            updateStartScreenButtons();
            const nameInput = document.getElementById('mpNameInput');
            if (nameInput) {
                nameInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') confirmName();
                });
            }
            
            // ì±„íŒ… ì…ë ¥ì°½ ì—”í„°í‚¤ ì´ë²¤íŠ¸
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        sendChatMessage();
                    }
                });
            }
            
            
            // ì‹œì‘ í™”ë©´ ë²„íŠ¼ ì´ˆê¸°í™”
            updateStartScreenButtons();
        });
        
        // ğŸ†• í˜ì´ì§€ ë– ë‚  ë•Œ ë°© ë‚˜ê°€ê¸° ì²˜ë¦¬
        window.addEventListener('beforeunload', async (e) => {
            if (multiplayerState.isMultiplayer && multiplayerState.roomId && multiplayerState.playerId) {
                // ë¹„ë™ê¸°ë¡œ ì„œë²„ì— ë‚˜ê°€ê¸° ì‹ í˜¸ ì „ì†¡
                navigator.sendBeacon('https://steep-moon-7816.sucksuck1114.workers.dev/api/leave-room', 
                    JSON.stringify({
                        roomId: multiplayerState.roomId,
                        playerId: multiplayerState.playerId
                    })
                );
            }
        });
        
        // ğŸ†• í˜ì´ì§€ visibility ë³€ê²½ ì‹œ ì²˜ë¦¬ (ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € ëŒ€ì‘)
        // ğŸ†• visibilitychange ì´ë²¤íŠ¸ ì œê±° (ë¸Œë¼ìš°ì € ì°½ì„ ê°€ë ¤ë„ ë°©ì„ ë‚˜ê°€ì§€ ì•Šë„ë¡)
        // íƒ­ ì „í™˜ì´ë‚˜ ë¸Œë¼ìš°ì € ìµœì†Œí™”ëŠ” ë°©ì„ ë‚˜ê°€ëŠ” ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ì§€ ì•ŠìŒ
        
        // ğŸ†• í˜ì´ì§€ ë‚˜ê°€ê¸°/ìƒˆë¡œê³ ì¹¨ ê°ì§€ (ì‹¤ì œë¡œ í˜ì´ì§€ë¥¼ ë– ë‚  ë•Œë§Œ)
        window.addEventListener('beforeunload', async (e) => {
            if (multiplayerState.isMultiplayer && multiplayerState.roomId && multiplayerState.playerId) {
                // ë‚˜ê°€ê¸° ì‹ í˜¸ ì¦‰ì‹œ ì „ì†¡ (ë™ê¸°ì ìœ¼ë¡œ)
                const data = JSON.stringify({
                    roomId: multiplayerState.roomId,
                    playerId: multiplayerState.playerId
                });
                
                // sendBeaconì„ ì‚¬ìš©í•˜ë©´ í˜ì´ì§€ ë‚˜ê°€ê¸° ì „ì— í™•ì‹¤íˆ ì „ì†¡ë¨
                navigator.sendBeacon('https://steep-moon-7816.sucksuck1114.workers.dev/api/leave-room', data);
            }
        });
        
        // ğŸ†• visibilitychange ì´ë²¤íŠ¸ ì œê±° (ë¸Œë¼ìš°ì € ì°½ì„ ê°€ë ¤ë„ ë°©ì„ ë‚˜ê°€ì§€ ì•Šë„ë¡)
        // íƒ­ ì „í™˜ì´ë‚˜ ë¸Œë¼ìš°ì € ìµœì†Œí™”ëŠ” ë°©ì„ ë‚˜ê°€ëŠ” ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ì§€ ì•ŠìŒ
        
        // ğŸ†• í„´ì œ ëª¨ë“œ: ë¹¨ê°„ í•˜íŠ¸ë¥¼ ì—°ë‘ìƒ‰ í•˜íŠ¸ë¡œ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜
        function replaceHeartsWithGreen() {
            // ëª¨ë“  í•˜íŠ¸ ì´ëª¨ì§€ê°€ í¬í•¨ëœ ìš”ì†Œ ì°¾ê¸°
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            let node;
            while (node = walker.nextNode()) {
                if (node.textContent.includes('â¤ï¸')) {
                    const parent = node.parentElement;
                    if (parent) {
                        parent.style.color = '#6bff6b';
                        parent.style.filter = 'hue-rotate(120deg) saturate(1.5) brightness(1.2)';
                    }
                }
            }
            
            // ìŠ¬ë¡¯ì˜ í•˜íŠ¸ ì•„ì´ì½˜
            const slotIcons = document.querySelectorAll('.slot-info-row .icon');
            slotIcons.forEach(icon => {
                if (icon.textContent && icon.textContent.includes('â¤ï¸')) {
                    icon.style.color = '#6bff6b';
                    icon.style.filter = 'hue-rotate(120deg) saturate(1.5) brightness(1.2)';
                }
            });
        }
        
        // ì´ë¦„ ë³€ê²½ í•¨ìˆ˜ (ì–¸ì œë“ ì§€ ë³€ê²½ ê°€ëŠ¥, ë°© ì…ì¥ ì „ì—ë§Œ)
        function changePlayerName() {
            // ë°© ì…ì¥ ì¤‘ì´ë©´ ë³€ê²½ ë¶ˆê°€
            if (multiplayerState.isMultiplayer && multiplayerState.roomId) {
                showToast('ë°©ì— ì…ì¥í•œ í›„ì—ëŠ” ì´ë¦„ì„ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            // ğŸ†• 24ì‹œê°„ ì œí•œ ì œê±° - ì–¸ì œë“ ì§€ ë³€ê²½ ê°€ëŠ¥
            // íŒíŠ¸ ìˆ¨ê¸°ê¸°
            const hintElement = document.getElementById('changeNameHint');
            if (hintElement) {
                hintElement.style.display = 'none';
            }
            
            // ì´ë¦„ ì…ë ¥ ëª¨ë‹¬ í‘œì‹œ
            multiplayerState.pendingRoomId = 'CHANGE_NAME';
            showNameModal();
        }
        
        // ì‹œì‘ í™”ë©´ í…ìŠ¤íŠ¸/ê°€ì´ë“œ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›
        function resetStartScreenToDefault() {
            const startInstruction = document.querySelector('.start-instruction');
            const scoreGuide = document.querySelector('.score-guide');
            
            if (startInstruction) {
                startInstruction.innerHTML = 'ê¸´ ë‹¨ì–´ì¼ìˆ˜ë¡ ëŒ€ë°•!<br>íŠ¹ë³„ì´ˆì„±ì€ ë³´ë„ˆìŠ¤!<br>ì¤€ë¹„ë˜ì…¨ìŠµë‹ˆê¹Œ?';
            }
            
            if (scoreGuide) {
                // ë‚´ìš©ì€ ì´ˆê¸° HTMLê³¼ ë™ì¼í•˜ê²Œ ë§ì¶”ê³ , ê¸°ë³¸ì€ ìˆ¨ê¹€
                scoreGuide.innerHTML = `
                    <div class="score-guide-compact">
                        <div class="score-item">2ê¸€ì: 10ì </div>
                        <div class="score-item">3ê¸€ì: 100ì </div>
                        <div class="score-item">4ê¸€ì: 400ì </div>
                        <div class="score-item">5ê¸€ì: 900ì </div>
                        <div class="special-score">âœ¨ íŠ¹ë³„ì´ˆì„±(ã„²ã„¸ã…ƒã…†ã…‰ã…Šã…‹ã…Œã…) ê° +20ì </div>
                        <div class="special-score-detail">ìƒˆ í”Œë ˆì´ì–´ ì…ì¥ ì‹œ ìë™ í•©ë¥˜</div>
                    </div>
                `;
                scoreGuide.style.display = 'none';
            }
        }

        // ì‹œì‘ í™”ë©´ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateStartScreenButtons() {
            const buttonsContainer = document.getElementById('gameModeButtons');
            if (!buttonsContainer) {
                console.error('[ë²„íŠ¼] gameModeButtons ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            // ì´ë¦„ ë³€ê²½ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
            const changeNameContainer = document.getElementById('changeNameContainer');
            if (changeNameContainer) {
                // ë°© ì…ì¥ ì „ì—ë§Œ í‘œì‹œ
                if (multiplayerState.isMultiplayer && multiplayerState.roomId) {
                    changeNameContainer.style.display = 'none';
                } else {
                    changeNameContainer.style.display = 'flex';
                }
            }
            
            // ë©€í‹°í”Œë ˆì´ ì¤‘ì´ë©´ (ì‹œê°„ì œ/í„´ì œ ê³µí†µ): ì¤‘ì•™ ì˜ì—­ì— ëŒ€ê¸°ì‹¤ ì±„íŒ… ì…ë ¥ì°½ í‘œì‹œ
            if (multiplayerState.isMultiplayer && multiplayerState.roomId) {
                const mpWaitingChat = document.getElementById('mpWaitingChat');
                if (mpWaitingChat) {
                    // ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ì€ ìˆ¨ê¸°ê³ , ì…ë ¥ì°½ë§Œ ìœ ì§€ (ë©”ì‹œì§€ëŠ” ì˜¤ë¥¸ìª½ ì±„íŒ… ì˜ì—­ì—ë§Œ í‘œì‹œ)
                    const mpChatMessages = document.getElementById('mpChatMessages');
                    if (mpChatMessages) {
                        mpChatMessages.style.display = 'none';
                    }
                    mpWaitingChat.classList.remove('hidden');
                }
                
                let buttonsHTML = '';
                
                // ë°©ì¥ì´ë©´ ê²Œì„ ì‹œì‘ ë²„íŠ¼
                if (multiplayerState.isHost) {
                    // ğŸ†• í„´ì œ ëª¨ë“œ: í”Œë ˆì´ì–´ ìˆ˜ ì²´í¬
                    const isTurnMode = multiplayerState.gameMode === 'turn';
                    let canStartGame = true;
                    
                    if (isTurnMode) {
                        // í”Œë ˆì´ì–´ ìˆ˜ í™•ì¸ (ìŠ¬ë¡¯ì—ì„œ)
                        const slotsContainer = document.getElementById('playerSlotsLeft');
                        if (slotsContainer) {
                            const activePlayers = slotsContainer.querySelectorAll('.player-slot:not(.empty)');
                            canStartGame = activePlayers.length >= 2; // ë°©ì¥ í¬í•¨ ìµœì†Œ 2ëª…
                        }
                    }
                    
                    buttonsHTML += `
                        <button class="mode-start-btn solo" onclick="startMultiplayerRound()" ${!canStartGame ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ''}>
                            ğŸ® ê²Œì„ ì‹œì‘
                        </button>
                    `;
                }
                
                // ë‚˜ê°€ê¸° ë²„íŠ¼
                buttonsHTML += `
                    <button class="mode-start-btn together" onclick="leaveRoom()">
                        ğŸšª ë‚˜ê°€ê¸°
                    </button>
                `;
                
                buttonsContainer.innerHTML = buttonsHTML;
            } else {
                // ì‹±ê¸€ ëª¨ë“œ ë²„íŠ¼
                let buttonsHTML = `
                    <button class="mode-start-btn solo" onclick="startGame()">
                        ğŸ® í˜¼ìí•˜ê¸°
                    </button>
                `;
                
                // ê¸°ê¸° ê´€ê³„ì—†ì´ í•¨ê»˜í•˜ê¸° ë²„íŠ¼ ë…¸ì¶œ
                buttonsHTML += `
                    <button class="mode-start-btn together" onclick="showRoomList()">
                        ğŸ‘¥ í•¨ê»˜í•˜ê¸°
                    </button>
                `;

                buttonsContainer.innerHTML = buttonsHTML;
            }
        }
        
        // ğŸ†• í„´ì œ ëª¨ë“œ: ì‚¬ìš©ëœ ë‹¨ì–´ ì˜ì—­ ì—…ë°ì´íŠ¸
        function updateTurnModeUsedWords(usedWords) {
            const usedWordsEl = document.getElementById('turnModeUsedWords');
            if (!usedWordsEl) return;
            
            if (usedWords.length === 0) {
                usedWordsEl.innerHTML = '<div style="color: #999; text-align: center; padding: 10px; font-size: 0.9em;">ì•„ì§ ì‚¬ìš©ëœ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            // ì—­ìˆœìœ¼ë¡œ í‘œì‹œ (ìµœê·¼ ë‹¨ì–´ê°€ ë§¨ ìœ„)
            const reversedWords = [...usedWords].reverse();
            const lastWord = reversedWords[0]; // ê°€ì¥ ìµœê·¼ ë‹¨ì–´
            
            usedWordsEl.innerHTML = reversedWords.map((word, index) => {
                const isRecent = index === 0; // ê°€ì¥ ìµœê·¼ ë‹¨ì–´
                return `<span class="word-item ${isRecent ? 'recent' : ''}">${word}</span>`;
            }).join('');
            
            // ìŠ¤í¬ë¡¤ì„ ë§¨ ìœ„ë¡œ (ìµœê·¼ ë‹¨ì–´ê°€ ë³´ì´ë„ë¡)
            usedWordsEl.scrollTop = 0;
        }
        
        // ğŸ†• í„´ì œ ëª¨ë“œ: 5ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸ ì‹œì‘
        function startTurnModeTimer(roomData) {
            // ğŸ†• ë°°í¬ ë²„ì „ í™•ì¸ìš© ë¡œê·¸
            console.log('[í„´ì œ íƒ€ì´ë¨¸ v5] í”Œë˜ê·¸ í•´ì œ ë²„ê·¸ ìˆ˜ì • ë°°í¬ í™•ì¸ - ' + new Date().toISOString());
            
            // ğŸ†• ì´ì „ íƒ€ì´ë¨¸ ì™„ì „íˆ ì •ë¦¬
            if (gameState.turnTimer) {
                clearInterval(gameState.turnTimer);
                gameState.turnTimer = null;
            }
            
            // ğŸ†• ë‹¨ì–´ ì œì¶œ í”Œë˜ê·¸ ë¦¬ì…‹ (ìƒˆ í„´ ì‹œì‘) - ìœ„ì—ì„œ ì´ë¯¸ ì²˜ë¦¬ë¨
            
            if (!roomData || !roomData.currentTurnPlayerId || !roomData.turnStartTime) {
                console.log('[í„´ì œ] í„´ ì •ë³´ ì—†ìŒ, í´ë§ì—ì„œ ì—…ë°ì´íŠ¸ ëŒ€ê¸°');
                return;
            }
            
            const isMyTurn = roomData.currentTurnPlayerId === multiplayerState.playerId;
            const isFirstTurn = roomData.isFirstTurn === true;
            const turnTimeLimit = isFirstTurn ? 9 : 6; // ì²« í„´ 9ì´ˆ, ì´í›„ 6ì´ˆ
            
            // ğŸ†• íƒˆë½ ì—¬ë¶€ í™•ì¸
            const isEliminated = roomData.eliminatedPlayers?.includes(multiplayerState.playerId) || false;
            
            // ğŸ†• ë‹¨ì–´ ì…ë ¥ì°½: íƒˆë½ìëŠ” ì±„íŒ… ì…ë ¥ ê°€ëŠ¥, ìƒì¡´ìëŠ” ìì‹ ì˜ í„´ì¼ ë•Œë§Œ ë‹¨ì–´ ì…ë ¥ ê°€ëŠ¥
            const wordInput = document.getElementById('wordInput');
            if (wordInput) {
                if (isMyTurn && !isEliminated) {
                    wordInput.classList.add('my-turn');
                } else {
                    wordInput.classList.remove('my-turn');
                }
                // ğŸš€ íƒˆë½ìëŠ” ì…ë ¥ì°½ í™œì„±í™” (ì±„íŒ…ìš©), ìƒì¡´ìëŠ” í•­ìƒ í™œì„±í™” (ìì‹ ì˜ í„´ì´ ì•„ë‹ˆì–´ë„ "/"ë¡œ ì±„íŒ… ê°€ëŠ¥)
                wordInput.disabled = false; // íƒˆë½ìë„ ì…ë ¥ì°½ í™œì„±í™” (ì±„íŒ… ê°€ëŠ¥)
                if (isEliminated) {
                    wordInput.placeholder = 'ì±„íŒ…ì„ ì…ë ¥í•˜ì„¸ìš” (íƒˆë½ì)'; // íƒˆë½ìëŠ” ì±„íŒ… ì…ë ¥
                } else {
                    wordInput.placeholder = isMyTurn ? 'ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”' : 'ë‹¤ë¥¸ í”Œë ˆì´ì–´ì˜ í„´ì…ë‹ˆë‹¤';
                }
            }
            
            // ğŸ†• íƒˆë½ì UI: ë‚˜ê°€ê¸° ë²„íŠ¼ í‘œì‹œ (ì˜¤ë¥¸ìª½ ì±„íŒ… ì°½ ì•„ë˜)
            const turnModeLeaveBtn = document.getElementById('turnModeLeaveBtn');
            const chatContainer = document.getElementById('chatContainer');
            
            if (isEliminated) {
                // íƒˆë½ì: ë‚˜ê°€ê¸° ë²„íŠ¼ í‘œì‹œ (ì˜¤ë¥¸ìª½ ì±„íŒ… ì°½ ì•„ë˜)
                if (turnModeLeaveBtn) {
                    turnModeLeaveBtn.classList.remove('hidden');
                    turnModeLeaveBtn.style.display = 'block';
                }
                // chatContainer í‘œì‹œ (ì±„íŒ… ë³´ê¸°ìš©)
                if (chatContainer) {
                    chatContainer.classList.remove('hidden');
                }
            } else {
                // í™œì„± í”Œë ˆì´ì–´: ë‚˜ê°€ê¸° ë²„íŠ¼ ìˆ¨ê¹€
                if (turnModeLeaveBtn) {
                    turnModeLeaveBtn.classList.add('hidden');
                    turnModeLeaveBtn.style.display = 'none';
                }
            }
            
            // í„´ íƒ€ì´ë¨¸ í‘œì‹œ
            const turnTimerEl = document.getElementById('turnModeTimer');
            if (turnTimerEl) {
                // ğŸ†• ë‚´ë¶€ ì‹œê°„ì€ 6ì´ˆ ê·¸ëŒ€ë¡œì§€ë§Œ, í™”ë©´ì—ëŠ” 6 ëŒ€ì‹  5ë¶€í„° ë³´ì´ê²Œ ì²˜ë¦¬
                // ì²« í„´(9ì´ˆ)ì€ ê·¸ëŒ€ë¡œ 9ë¶€í„°, ì´í›„ í„´(6ì´ˆ)ì€ 5ë¶€í„° ì‹œì‘
                const initialDisplay = (!isFirstTurn && turnTimeLimit === 6)
                    ? 5
                    : turnTimeLimit;
                turnTimerEl.textContent = initialDisplay;
            }
            
            // íƒ€ì´ë¨¸ ì‹œì‘ (ì„œë²„ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ì •í™•í•œ ê³„ì‚°)
            const serverStartTime = roomData.turnStartTime || Date.now();
            const clientNow = Date.now(); // í´ë¼ì´ì–¸íŠ¸ í˜„ì¬ ì‹œê°„ (ì„œë²„ ì‹œê°„ê³¼ì˜ ì°¨ì´ ê³„ì‚°ìš©)
            let lastPlayedSecond = -1; // íš¨ê³¼ìŒ ì¤‘ë³µ ì¬ìƒ ë°©ì§€
            let timeoutSent = false; // ì¤‘ë³µ ì „ì†¡ ë°©ì§€
            let lastDisplayedSecond = -1; // ë§ˆì§€ë§‰ í‘œì‹œëœ ì´ˆ (ì¤‘ë³µ ì—…ë°ì´íŠ¸ ë°©ì§€)
            
            // ğŸ†• ë‹¨ì–´ ì œì¶œ í”Œë˜ê·¸ (turn_timeout ì¤‘ë³µ ë°©ì§€) - í•¨ìˆ˜ ìŠ¤ì½”í”„ì—ì„œ ê´€ë¦¬
            if (typeof gameState.wordSubmitted === 'undefined') {
                gameState.wordSubmitted = false;
            }
            gameState.wordSubmitted = false; // ìƒˆ í„´ ì‹œì‘ ì‹œ ë¦¬ì…‹
            
            gameState.turnTimer = setInterval(() => {
                if (!gameState.gameRunning) {
                    clearInterval(gameState.turnTimer);
                    return;
                }
                
                // ğŸš€ ê²Œì„ ì¢…ë£Œ ì‹œ íƒ€ì´ë¨¸ ì •ì§€ (endTimeì´ ì„¤ì •ë˜ë©´)
                const currentRoomData = multiplayerState.lastRoomData;
                if (currentRoomData && currentRoomData.endTime) {
                    clearInterval(gameState.turnTimer);
                    gameState.turnTimer = null;
                    return;
                }
                
                // ğŸ†• ì„œë²„ turnStartTime ê¸°ì¤€ìœ¼ë¡œ ì •í™•í•œ ë‚¨ì€ ì‹œê°„ ê³„ì‚°
                const now = Date.now();
                const elapsedMs = now - serverStartTime; // ì„œë²„ ì‹œì‘ ì‹œê°„ë¶€í„° ê²½ê³¼í•œ ì‹œê°„
                const elapsed = Math.max(0, elapsedMs / 1000); // ì´ˆ ë‹¨ìœ„ (ì†Œìˆ˜ì  í¬í•¨)
                timeLeft = Math.max(0, turnTimeLimit - elapsed);
                const timeLeftDisplay = Math.ceil(timeLeft); // í‘œì‹œìš© (ì˜¬ë¦¼ - ê° ì´ˆê°€ ì •í™•íˆ 1ì´ˆì”© í‘œì‹œ)
                
                // ì¤‘ë³µ ì—…ë°ì´íŠ¸ ë°©ì§€ (ê°™ì€ ì´ˆë¥¼ ì—¬ëŸ¬ ë²ˆ í‘œì‹œí•˜ì§€ ì•ŠìŒ)
                if (timeLeftDisplay === lastDisplayedSecond) {
                    return;
                }
                lastDisplayedSecond = timeLeftDisplay;
                
                // íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
                if (turnTimerEl) {
                    // ğŸ†• ë‚´ë¶€ ì‹œê°„ì€ 6ì´ˆ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë˜, í™”ë©´ì—ëŠ” 6 ëŒ€ì‹  5ë¶€í„° ë³´ì´ë„ë¡ ì²˜ë¦¬
                    // (ì‚¬ìš©ì ì²´ê°: 5-4-3-2-1-0, ì‹¤ì œ ì‹œê°„: 6ì´ˆ ìœ ì§€)
                    let displayValue = timeLeftDisplay;
                    // ì²« í„´(isFirstTurn) ë§ê³ , ì´í›„ í„´(6ì´ˆ íƒ€ì´ë¨¸)ì—ì„œë§Œ 6ì„ 5ë¡œ ë³´ì´ê²Œ í•¨
                    if (!isFirstTurn && displayValue === 6) {
                        displayValue = 5;
                    }
                    turnTimerEl.textContent = displayValue;
                }
                
                // íš¨ê³¼ìŒ ì¬ìƒ (2ì´ˆ, 1ì´ˆ ë‚¨ì•˜ì„ ë•Œ)
                if (isMyTurn && (timeLeftDisplay === 2 || timeLeftDisplay === 1) && timeLeftDisplay !== lastPlayedSecond) {
                    lastPlayedSecond = timeLeftDisplay;
                    try {
                        const turnSecondsSound = new Audio('./sound/turn_seconds.mp3');
                        turnSecondsSound.volume = gameState.sfxEnabled ? 1 : 0;
                        turnSecondsSound.play().catch(err => console.log('[í„´ì œ] íš¨ê³¼ìŒ ì¬ìƒ ì‹¤íŒ¨:', err));
                    } catch (err) {
                        console.log('[í„´ì œ] íš¨ê³¼ìŒ ë¡œë“œ ì‹¤íŒ¨:', err);
                    }
                }
                
                // ì‹œê°„ ì´ˆê³¼ ì²˜ë¦¬ (ì„œë²„ turnStartTime ê¸°ì¤€ìœ¼ë¡œ ì •í™•íˆ ì‹œê°„ì´ ì§€ë‚¬ì„ ë•Œ)
                // ğŸ†• ë‹¨ì–´ ì œì¶œì´ ì„±ê³µí–ˆìœ¼ë©´ turn_timeout ì „ì†¡í•˜ì§€ ì•ŠìŒ (ì¤‘ë³µ í„´ ì „í™˜ ë°©ì§€)
                if (isMyTurn && elapsed >= turnTimeLimit && !timeoutSent && !gameState.wordSubmitted) {
                    timeoutSent = true;
                    clearInterval(gameState.turnTimer);
                    
                    // ì„œë²„ì— ì‹œê°„ ì´ˆê³¼ ì‹ í˜¸ ì „ì†¡
                    fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${multiplayerState.roomId}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'turn_timeout',
                            playerId: multiplayerState.playerId
                            // ğŸ†• playersëŠ” ì„œë²„ state.playersë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì „ì†¡í•˜ì§€ ì•ŠìŒ
                        })
                    }).catch(err => console.error('í„´ íƒ€ì„ì•„ì›ƒ ì „ì†¡ ì‹¤íŒ¨:', err));
                }
            }, 100); // 100msë§ˆë‹¤ ì—…ë°ì´íŠ¸ (ì •í™•í•œ íƒ€ì´ë°, ë¶€í•˜ ê°ì†Œ)
        }
        
        // ğŸ†• ê²Œì„ ëª¨ë“œì— ë”°ë¼ UI ì „í™˜
        function updateGameModeUI(gameMode) {
            const isTurnMode = gameMode === 'turn';
            
            // ğŸ†• í„´ì œ ëª¨ë“œì¼ ë•Œ bodyì— í´ë˜ìŠ¤ ì¶”ê°€
            if (isTurnMode) {
                document.body.classList.add('turn-mode');
                // ğŸ†• í„´ì œ ëª¨ë“œ: ëª¨ë“  ë¹¨ê°„ í•˜íŠ¸ë¥¼ ì—°ë‘ìƒ‰ í•˜íŠ¸ë¡œ ë³€ê²½
                replaceHeartsWithGreen();
            } else {
                document.body.classList.remove('turn-mode');
            }
            
            // ì‹œê°„ì œ ëª¨ë“œ UI
            const timeModeInfo = document.getElementById('timeModeInfo');
            const timeModeGuide = document.getElementById('timeModeGuide');
            const emojiDisplay = document.getElementById('emojiDisplay');
            const timeModeDefinition = document.getElementById('timeModeDefinition');
            
            // í„´ì œ ëª¨ë“œ UI
            const turnModeTimer = document.getElementById('turnModeTimer');
            const turnModeGuide = document.getElementById('turnModeGuide');
            const turnModeUsedWords = document.getElementById('turnModeUsedWords');
            const turnModeWaitMessage = document.getElementById('turnModeWaitMessage');
            
            if (isTurnMode) {
                // í„´ì œ ëª¨ë“œ: ì‹œê°„ì œ UI ìˆ¨ê¸°ê¸°
                if (timeModeInfo) timeModeInfo.classList.add('hidden');
                if (timeModeGuide) timeModeGuide.classList.add('hidden');
                if (emojiDisplay) emojiDisplay.classList.add('hidden');
                // í„´ì œ ëª¨ë“œì—ì„œë„ ë‹¨ì–´ ëœ»ì€ í‘œì‹œ
                if (timeModeDefinition) timeModeDefinition.classList.remove('hidden');
                
                // í„´ì œ ëª¨ë“œ: í„´ì œ UI í‘œì‹œ
                if (turnModeTimer) turnModeTimer.classList.remove('hidden');
                if (turnModeGuide) turnModeGuide.classList.add('hidden'); // ğŸ†• ì„¤ëª… ì¹¸ ì™„ì „íˆ ìˆ¨ê¸°ê¸°
                if (turnModeUsedWords) turnModeUsedWords.classList.remove('hidden');
                
                // ğŸ†• í„´ì œ ëª¨ë“œ: í”Œë ˆì´ì–´ ìˆ˜ ì²´í¬í•˜ì—¬ ì•ˆë‚´ ë¬¸êµ¬ í‘œì‹œ
                if (turnModeWaitMessage && multiplayerState.isHost) {
                    const slotsContainer = document.getElementById('playerSlotsLeft');
                    if (slotsContainer) {
                        const activePlayers = slotsContainer.querySelectorAll('.player-slot:not(.empty)');
                        if (activePlayers.length < 2) {
                            turnModeWaitMessage.style.display = 'block';
                        } else {
                            turnModeWaitMessage.style.display = 'none';
                        }
                    }
                }
            } else {
                // ì‹œê°„ì œ ëª¨ë“œ: í„´ì œ UI ìˆ¨ê¸°ê¸°
                if (turnModeTimer) turnModeTimer.classList.add('hidden');
                if (turnModeGuide) turnModeGuide.classList.add('hidden');
                if (turnModeUsedWords) turnModeUsedWords.classList.add('hidden');
                if (turnModeWaitMessage) turnModeWaitMessage.style.display = 'none';
                
                // ì‹œê°„ì œ ëª¨ë“œ: ì‹œê°„ì œ UI í‘œì‹œ
                if (timeModeInfo) timeModeInfo.classList.remove('hidden');
                if (timeModeGuide) timeModeGuide.classList.remove('hidden');
                if (emojiDisplay) emojiDisplay.classList.remove('hidden');
                if (timeModeDefinition) timeModeDefinition.classList.remove('hidden');
            }
        }
        
        // ë©€í‹°í”Œë ˆì´ ë¼ìš´ë“œ ì‹œì‘
        function startMultiplayerRound() {
            if (!multiplayerState.isHost) return;
            
            // ğŸ†• í„´ì œ ëª¨ë“œ: 2ì¸ ì´ìƒ ì²´í¬
            if (multiplayerState.gameMode === 'turn') {
                // í”Œë ˆì´ì–´ ìˆ˜ í™•ì¸
                const slotsContainer = document.getElementById('playerSlotsLeft');
                const activePlayers = slotsContainer.querySelectorAll('.player-slot:not(.empty)');
                if (activePlayers.length < 2) {
                    showToast('í„´ì œ ëª¨ë“œëŠ” ìµœì†Œ 2ëª… ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤');
                    return;
                }
            }
            
            startGame();
        }
        // ğŸ†• window ê°ì²´ì— ë…¸ì¶œ
        window.startMultiplayerRound = startMultiplayerRound;
        
        // ë°© ë‚˜ê°€ê¸° - ìµœì´ˆ í™”ë©´ìœ¼ë¡œ ì™„ì „íˆ ëŒì•„ê°€ê¸°
        async function leaveRoom() {
            // ğŸ†• ì„œë²„ì— ë‚˜ê°€ê¸° ì‹ í˜¸ ì „ì†¡
            if (multiplayerState.roomId && multiplayerState.playerId) {
                try {
                    // ğŸ†• ë‚˜ê°„ ë°© ì •ë³´ ì €ì¥ (5ë¶„ê°„ ì¬ì…ì¥ ë¶ˆê°€)
                    const roomData = await fetch(`https://steep-moon-7816.sucksuck1114.workers.dev/api/game-state?roomId=${multiplayerState.roomId}`).then(r => r.json()).catch(() => null);
                    if (roomData) {
                        const leftRoomInfo = {
                            roomId: multiplayerState.roomId,
                            roundNumber: roomData.roundNumber || 0,
                            leftTime: Date.now()
                        };
                        localStorage.setItem(`leftRoom_${multiplayerState.roomId}`, JSON.stringify(leftRoomInfo));
                        
                        // ğŸ†• íƒˆë½ì ì¬ì…ì¥ì„ ìœ„í•œ playerId ì €ì¥
                        const isEliminated = roomData.eliminatedPlayers?.includes(multiplayerState.playerId) || false;
                        if (isEliminated) {
                            localStorage.setItem(`lastPlayerId_${multiplayerState.roomId}`, multiplayerState.playerId);
                        }
                    }
                    
                    await fetch('https://steep-moon-7816.sucksuck1114.workers.dev/api/leave-room', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            roomId: multiplayerState.roomId,
                            playerId: multiplayerState.playerId
                        })
                    });
                } catch (error) {
                    console.error('ë°© ë‚˜ê°€ê¸° ì „ì†¡ ì‹¤íŒ¨:', error);
                }
            }
            
            // í´ë§ ì¤‘ì§€
            stopPolling();
            
            // ğŸš€ ìŠ¬ë¡¯ ì¦‰ì‹œ ìˆ¨ê¹€ (isMultiplayer=false ì „ì—)
            document.getElementById('playerSlotsLeft')?.classList.add('hidden');
            document.getElementById('chatContainer')?.classList.add('hidden');
            
            // ë©€í‹°í”Œë ˆì´ ìƒíƒœ ì™„ì „ ì´ˆê¸°í™”
            multiplayerState.isMultiplayer = false;
            multiplayerState.roomId = null;
            multiplayerState.playerId = null;
            multiplayerState.playerName = null;
            multiplayerState.isHost = false;
            multiplayerState.currentRound = 0;
            multiplayerState.previousWordCounts = {};
            multiplayerState.gameMode = null;
            multiplayerState.players = [];
            multiplayerState.lastPlayerCount = 0;
            
            // ëª¨ë“  ëª¨ë‹¬ ë‹«ê¸°
            document.querySelector('.mp-result-modal')?.remove();
            document.getElementById('mpRoomModal')?.classList.add('hidden');
            document.getElementById('mpNameModal')?.classList.add('hidden');
            document.getElementById('mpRoomTitleModal')?.classList.add('hidden');
            
            // ğŸš€ ìŠ¬ë¡¯ + ì±„íŒ… ìˆ¨ê¸°ê¸° (ì¤‘ë³µì´ì§€ë§Œ í™•ì‹¤í•˜ê²Œ)
            document.getElementById('playerSlotsLeft')?.classList.add('hidden');
            document.getElementById('chatContainer')?.classList.add('hidden');
            
            // ëŒ€ê¸°ì‹¤ ì±„íŒ…ë„ ìˆ¨ê¸°ê¸° (ë©€í‹°í”Œë ˆì´ ëŒ€ê¸° ì¤‘ì¼ ë•Œ í‘œì‹œë˜ëŠ” ê²ƒ)
            document.getElementById('mpWaitingChat')?.classList.add('hidden');
            
            // ê²Œì„ í™”ë©´ ìˆ¨ê¸°ê³  ì‹œì‘ í™”ë©´ í‘œì‹œ
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('gameStartSection').classList.remove('hidden');
            
            // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
            resetGame();
            
            // ì‹±ê¸€í”Œë ˆì´ë¡œ ëŒì•„ê°€ë‹ˆ ìƒˆê²Œì„ ë²„íŠ¼ ë³µì›
            const resetBtn = document.querySelector('.reset-btn');
            if (resetBtn) resetBtn.style.display = 'block';
            
            // í„´ì œ ëª¨ë“œ í´ë˜ìŠ¤ ì œê±°
            document.body.classList.remove('turn-mode');
            
            // ì‹œì‘ í™”ë©´ í…ìŠ¤íŠ¸/ê°€ì´ë“œë¥¼ ì™„ì „íˆ ìµœì´ˆ ìƒíƒœë¡œ ë³µì›
            resetStartScreenToDefault();

            // ì‹œì‘ í™”ë©´ ë²„íŠ¼ ì—…ë°ì´íŠ¸ (í˜¼ìí•˜ê¸°/í•¨ê»˜í•˜ê¸°) - ìµœì´ˆ ì‹œì‘ í™”ë©´ìœ¼ë¡œ
            updateStartScreenButtons();
        }

        function leaveGameRoom() {
            // ğŸš€ ê²Œì„ ì¢…ë£Œ ëª¨ë‹¬ì´ í‘œì‹œë˜ë©´ ëª¨ë“  ìœ ì €ê°€ ë‚˜ê°ˆ ìˆ˜ ìˆìŒ
            const resultModal = document.querySelector('.mp-result-modal');
            if (resultModal) {
                // ê²Œì„ ì¢…ë£Œ ëª¨ë‹¬ì´ í‘œì‹œë˜ë©´ ë‚˜ê°€ê¸° ê°€ëŠ¥
                leaveRoom();
                return;
            }
            
            // ğŸ†• íƒˆë½ìëŠ” ê²Œì„ ì¤‘ì—ë„ ë‚˜ê°ˆ ìˆ˜ ìˆìŒ
            if (gameState.gameRunning && multiplayerState.isMultiplayer && multiplayerState.gameMode === 'turn') {
                // í„´ì œ ëª¨ë“œì—ì„œ íƒˆë½ìì¸ì§€ í™•ì¸
                const lastRoomData = multiplayerState.lastRoomData;
                const isEliminated = lastRoomData && lastRoomData.eliminatedPlayers?.includes(multiplayerState.playerId);
                
                if (!isEliminated) {
                    // íƒˆë½ìê°€ ì•„ë‹ˆë©´ ë‚˜ê°ˆ ìˆ˜ ì—†ìŒ
                    showToast('ê²Œì„ ì¤‘ì—ëŠ” ë‚˜ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                // íƒˆë½ìëŠ” ë‚˜ê°ˆ ìˆ˜ ìˆìŒ
            } else if (gameState.gameRunning) {
                // ì‹œê°„ì œ ëª¨ë“œë‚˜ ë‹¤ë¥¸ ëª¨ë“œì—ì„œëŠ” ê²Œì„ ì¤‘ ë‚˜ê°ˆ ìˆ˜ ì—†ìŒ
                showToast('ê²Œì„ ì¤‘ì—ëŠ” ë‚˜ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            leaveRoom();
        }
        
        // ğŸ†• ëª¨ë“  í•¨ìˆ˜ë¥¼ window ê°ì²´ì— ëª…ì‹œì ìœ¼ë¡œ ë…¸ì¶œ (HTML onclickì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡)
        window.startGame = startGame;
        window.showRoomList = showRoomList;
        window.changePlayerName = changePlayerName;
        window.startMultiplayerRound = startMultiplayerRound;
        window.leaveRoom = leaveRoom;
    </script>
</body>
</html>

